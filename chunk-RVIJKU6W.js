import{a as fe,b as ve}from"./chunk-KHSO7ZIV.js";import{a as be}from"./chunk-Z5ETMUR3.js";import{a as xe}from"./chunk-LCGV56PL.js";import{a as ee,d as he,g as ue,q as ye}from"./chunk-2ABDYA72.js";import{Bb as pe,Da as H,F as K,G as oe,Ha as _,K as re,Lb as j,Mb as X,Na as u,Oa as s,Pa as o,Q as L,Qa as x,R as B,Rb as z,S as E,T as N,Wa as J,Wb as ge,Xa as w,Y as G,Z as le,Za as v,ea as ce,eb as O,fb as k,gb as m,ha as de,hb as Q,ib as S,jb as Z,kb as V,lb as $,mb as U,nb as q,qa as me,ra as l,za as F}from"./chunk-N2NO2H5W.js";import{a as A,b as R}from"./chunk-VOSPIT4N.js";function Se(r,e){if(r&1&&(s(0,"label",11),m(1),o()),r&2){let t=v();l(),S(" ",t.label," ")}}function Me(r,e){if(r&1&&(s(0,"span",12),m(1),o()),r&2){let t=v();l(),S(" ",t.placeholder," ")}}function Oe(r,e){if(r&1&&x(0,"span",20),r&2){let t=v().$implicit;O("background",t.color)}}function Ie(r,e){if(r&1){let t=J();s(0,"span",15),_(1,Oe,1,2,"span",16),m(2),s(3,"button",17),w("click",function(i){let a=L(t).$implicit,c=v(2);return B(c.removeOption(a.id,i))}),E(),s(4,"svg",18),x(5,"path",19),o()()()}if(r&2){let t=e.$implicit;O("color",t.color||"#e2e8f0"),l(),u("ngIf",t.color),l(),S(" ",t.name," ")}}function Ee(r,e){if(r&1&&(s(0,"span",13),_(1,Ie,6,4,"span",14),o()),r&2){let t=v();l(),u("ngForOf",t.getSelectedOptions())}}function ke(r,e){if(r&1&&(s(0,"span",21),m(1),o()),r&2){let t=v();l(),S(" ",t.selectedIds.length," selected ")}}function Te(r,e){if(r&1&&x(0,"span",30),r&2){let t=v().$implicit;O("background",t.color)}}function Pe(r,e){if(r&1){let t=J();s(0,"div",26),w("click",function(){let i=L(t).$implicit,a=v(2);return B(a.toggleOption(i.id))}),s(1,"input",27),w("change",function(){let i=L(t).$implicit,a=v(2);return B(a.toggleOption(i.id))})("click",function(i){return L(t),B(i.stopPropagation())}),o(),s(2,"span",28),_(3,Te,1,2,"span",29),s(4,"span",21),m(5),o()()()}if(r&2){let t=e.$implicit,n=v(2);l(),k("bg-brand",n.isSelected(t.id)),u("checked",n.isSelected(t.id)),l(2),u("ngIf",t.color),l(),O("color",t.color||"#e2e8f0"),l(),S(" ",t.name," ")}}function Fe(r,e){r&1&&(s(0,"div",31),m(1," No options available "),o())}function Ae(r,e){if(r&1){let t=J();s(0,"div",22),w("click",function(i){return L(t),B(i.stopPropagation())}),s(1,"div",23),_(2,Pe,6,7,"div",24)(3,Fe,2,0,"div",25),o()()}if(r&2){let t=v();l(2),u("ngForOf",t.options),l(),u("ngIf",t.options.length===0)}}var te=class r{constructor(e){this.elementRef=e}options=[];placeholder="Select options...";label="";selectionChange=new G;selectedIds=[];isOpen=!1;onChange=e=>{};onTouched=()=>{};ngOnInit(){this.selectedIds||(this.selectedIds=[])}writeValue(e){this.selectedIds=e?[...e]:[]}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}toggleOption(e){this.selectedIds.indexOf(e)>-1?this.selectedIds=this.selectedIds.filter(n=>n!==e):this.selectedIds=[...this.selectedIds,e],this.onChange([...this.selectedIds]),this.onTouched(),this.selectionChange.emit([...this.selectedIds])}isSelected(e){return this.selectedIds.includes(e)}getSelectedOptions(){return this.options.filter(e=>this.selectedIds.includes(e.id))}toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&this.onTouched()}onDocumentClick(e){this.isOpen&&!this.elementRef.nativeElement.contains(e.target)&&(this.isOpen=!1)}closeDropdown(){this.isOpen=!1}removeOption(e,t){t.stopPropagation(),this.toggleOption(e)}getDisplayText(){return this.selectedIds.length===0?this.placeholder:this.selectedIds.length===1?this.options.find(t=>t.id===this.selectedIds[0])?.name||this.placeholder:`${this.selectedIds.length} selected`}static \u0275fac=function(t){return new(t||r)(F(de))};static \u0275cmp=H({type:r,selectors:[["app-multiselect"]],hostBindings:function(t,n){t&1&&w("click",function(a){return n.onDocumentClick(a)},me)},inputs:{options:"options",placeholder:"placeholder",label:"label"},outputs:{selectionChange:"selectionChange"},features:[q([{provide:ee,useExisting:K(()=>r),multi:!0}])],decls:11,vars:7,consts:[[1,"relative","w-full"],["class","block text-sm font-medium text-slate-300 mb-2",4,"ngIf"],[1,"relative"],["type","button",1,"w-full","bg-dark-blue","border","border-sidebar-border","text-white","text-sm","rounded-md","px-3","py-2","focus:outline-none","focus:ring-2","focus:ring-brand","flex","items-center","justify-between","min-h-[42px]","hover:border-sidebar-border/80","transition-colors",3,"click"],[1,"flex","items-center","gap-2","flex-wrap","flex-1"],["class","text-slate-400",4,"ngIf"],["class","flex items-center gap-2 flex-wrap",4,"ngIf"],["class","text-slate-200",4,"ngIf"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4","text-slate-400","flex-shrink-0","ml-2","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","d","M19 9l-7 7-7-7"],["class","absolute z-50 w-full mt-1 bg-dark-blue border border-sidebar-border rounded-md shadow-lg max-h-60 overflow-auto",3,"click",4,"ngIf"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],[1,"text-slate-400"],[1,"flex","items-center","gap-2","flex-wrap"],["class","inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium bg-slate-800 border border-sidebar-border",3,"color",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-1.5","px-2","py-1","rounded-md","text-xs","font-medium","bg-slate-800","border","border-sidebar-border"],["class","inline-block h-2 w-2 rounded-full",3,"background",4,"ngIf"],["type","button",1,"ml-1","hover:text-red-400","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-3","w-3"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"inline-block","h-2","w-2","rounded-full"],[1,"text-slate-200"],[1,"absolute","z-50","w-full","mt-1","bg-dark-blue","border","border-sidebar-border","rounded-md","shadow-lg","max-h-60","overflow-auto",3,"click"],[1,"p-1"],["class","flex items-center space-x-2 px-3 py-2 rounded-md cursor-pointer hover:bg-brand-hover transition-colors text-sm",3,"click",4,"ngFor","ngForOf"],["class","px-3 py-2 text-sm text-slate-400 text-center",4,"ngIf"],[1,"flex","items-center","space-x-2","px-3","py-2","rounded-md","cursor-pointer","hover:bg-brand-hover","transition-colors","text-sm",3,"click"],["type","checkbox",1,"rounded","border-sidebar-border","bg-slate-900","text-brand","focus:ring-brand","focus:ring-offset-0","focus:ring-offset-slate-900",3,"change","click","checked"],[1,"flex","items-center","space-x-2","flex-1"],["class","inline-block h-3 w-3 rounded-full flex-shrink-0",3,"background",4,"ngIf"],[1,"inline-block","h-3","w-3","rounded-full","flex-shrink-0"],[1,"px-3","py-2","text-sm","text-slate-400","text-center"]],template:function(t,n){t&1&&(s(0,"div",0),_(1,Se,2,1,"label",1),s(2,"div",2)(3,"button",3),w("click",function(){return n.toggleDropdown()}),s(4,"div",4),_(5,Me,2,1,"span",5)(6,Ee,2,1,"span",6)(7,ke,2,1,"span",7),o(),E(),s(8,"svg",8),x(9,"path",9),o()(),_(10,Ae,4,2,"div",10),o()()),t&2&&(l(),u("ngIf",n.label),l(4),u("ngIf",n.selectedIds.length===0),l(),u("ngIf",n.selectedIds.length>0&&n.selectedIds.length<=2),l(),u("ngIf",n.selectedIds.length>2),l(),k("rotate-180",n.isOpen),l(2),u("ngIf",n.isOpen))},dependencies:[z,j,X],styles:["[_nghost-%COMP%]{display:block}div[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}div[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1e293b;border-radius:3px}div[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}div[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#64748b}"]})};function Re(r,e){if(r&1&&(s(0,"div",15),x(1,"div",16),s(2,"div",17),m(3),o()()),r&2){let t=e.$implicit;O("left",t.position,"%"),l(3),Q(t.year)}}var ne=class r{minDate="2022-01-01";maxDate=new Date().toISOString().split("T")[0];rangeChange=new G;startPosition=0;endPosition=100;_startDate="";_endDate="";totalDays=0;minDateMs=0;maxDateMs=0;yearMarkers=[];isDraggingStart=!1;isDraggingEnd=!1;trackElement=null;onChange=e=>{};onTouched=()=>{};ngOnInit(){this.initializeTimeline()}ngOnChanges(e){(e.minDate||e.maxDate)&&this.initializeTimeline()}initializeTimeline(){this.minDateMs=new Date(this.minDate).getTime(),this.maxDateMs=new Date(this.maxDate).getTime(),this.totalDays=Math.floor((this.maxDateMs-this.minDateMs)/(1e3*60*60*24)),this.calculateYearMarkers(),(!this._startDate||!this._endDate)&&(this._startDate=this.minDate,this._endDate=this.maxDate,this.startPosition=0,this.endPosition=100)}calculateYearMarkers(){let e=[],t=new Date(this.minDate).getFullYear(),n=new Date(this.maxDate).getFullYear();for(let i=t;i<=n;i++){let c=new Date(i,0,1).getTime();if(c>=this.minDateMs&&c<=this.maxDateMs){let p=(c-this.minDateMs)/(this.maxDateMs-this.minDateMs)*100;e.push({position:p,year:i})}}this.yearMarkers=e}writeValue(e){e&&e.startDate&&e.endDate&&(this._startDate=e.startDate,this._endDate=e.endDate,this.updatePositionsFromDates())}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}updatePositionsFromDates(){let e=new Date(this._startDate).getTime(),t=new Date(this._endDate).getTime();this.startPosition=(e-this.minDateMs)/(this.maxDateMs-this.minDateMs)*100,this.endPosition=(t-this.minDateMs)/(this.maxDateMs-this.minDateMs)*100,this.startPosition=Math.max(0,Math.min(100,this.startPosition)),this.endPosition=Math.max(0,Math.min(100,this.endPosition))}updateDatesFromPositions(){let e=this.minDateMs+this.startPosition/100*(this.maxDateMs-this.minDateMs),t=this.minDateMs+this.endPosition/100*(this.maxDateMs-this.minDateMs);this._startDate=this.formatDate(new Date(e)),this._endDate=this.formatDate(new Date(t))}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}onStartThumbMouseDown(e){e.preventDefault(),this.isDraggingStart=!0,this.trackElement=e.target.closest(".timeline-container"),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}onEndThumbMouseDown(e){e.preventDefault(),this.isDraggingEnd=!0,this.trackElement=e.target.closest(".timeline-container"),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}onMouseMove=e=>{if(!this.isDraggingStart&&!this.isDraggingEnd||!this.trackElement)return;let t=this.trackElement.querySelector(".timeline-track");if(!t)return;let n=t.getBoundingClientRect(),i=e.clientX-n.left,a=Math.max(0,Math.min(100,i/n.width*100));this.isDraggingStart?(this.startPosition=Math.min(a,this.endPosition),this.updateDatesFromPositions(),this.emitChange()):this.isDraggingEnd&&(this.endPosition=Math.max(a,this.startPosition),this.updateDatesFromPositions(),this.emitChange())};onMouseUp=()=>{this.isDraggingStart=!1,this.isDraggingEnd=!1,this.trackElement=null,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)};onTrackClick(e){if(this.isDraggingStart||this.isDraggingEnd)return;let n=e.currentTarget.getBoundingClientRect(),i=e.clientX-n.left,a=Math.max(0,Math.min(100,i/n.width*100)),c=Math.abs(a-this.startPosition),p=Math.abs(a-this.endPosition);c<p?this.startPosition=Math.min(a,this.endPosition):this.endPosition=Math.max(a,this.startPosition),this.updateDatesFromPositions(),this.emitChange()}ngOnDestroy(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}emitChange(){let e={startDate:this._startDate,endDate:this._endDate};this.onChange(e),this.rangeChange.emit(e),this.onTouched()}get startDate(){return this._startDate}get endDate(){return this._endDate}get selectedRangeWidth(){return this.endPosition-this.startPosition}get selectedRangeLeft(){return this.startPosition}formatDisplayDate(e){if(!e)return"";let t=new Date(e),n={year:"numeric",month:"short",day:"numeric"};return t.toLocaleDateString("en-US",n)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=H({type:r,selectors:[["app-date-range-timeline"]],inputs:{minDate:"minDate",maxDate:"maxDate"},outputs:{rangeChange:"rangeChange"},features:[q([{provide:ee,useExisting:K(()=>r),multi:!0}]),ce],decls:20,vars:11,consts:[[1,"date-range-timeline"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-xs","text-zinc-400"],[1,"text-brand","font-medium"],[1,"text-xs","text-zinc-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-3","h-3","inline-block"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"],[1,"timeline-container"],[1,"year-markers"],["class","year-marker",3,"left",4,"ngFor","ngForOf"],[1,"timeline-track",3,"click"],[1,"selected-range"],[1,"timeline-thumb","start-thumb",3,"mousedown"],[1,"thumb-circle"],[1,"timeline-thumb","end-thumb",3,"mousedown"],[1,"year-marker"],[1,"year-tick"],[1,"year-label"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),m(4),o()(),s(5,"div",4),E(),s(6,"svg",5),x(7,"path",6),o()(),N(),s(8,"div",2)(9,"span",3),m(10),o()()(),s(11,"div",7)(12,"div",8),_(13,Re,4,3,"div",9),o(),s(14,"div",10),w("click",function(a){return n.onTrackClick(a)}),x(15,"div",11),s(16,"div",12),w("mousedown",function(a){return n.onStartThumbMouseDown(a)}),x(17,"div",13),o(),s(18,"div",14),w("mousedown",function(a){return n.onEndThumbMouseDown(a)}),x(19,"div",13),o()()()()),t&2&&(l(4),Q(n.formatDisplayDate(n.startDate)),l(6),Q(n.formatDisplayDate(n.endDate)),l(3),u("ngForOf",n.yearMarkers),l(2),O("left",n.selectedRangeLeft,"%")("width",n.selectedRangeWidth,"%"),l(),O("left",n.startPosition,"%"),l(2),O("left",n.endPosition,"%"))},dependencies:[z,j],styles:[".date-range-timeline[_ngcontent-%COMP%]{width:100%;padding:8px 0}.timeline-container[_ngcontent-%COMP%]{position:relative;height:50px;padding:8px 0}.year-markers[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:20px;pointer-events:none}.year-marker[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%)}.year-tick[_ngcontent-%COMP%]{width:1px;height:8px;background-color:#52525b;margin:0 auto}.year-label[_ngcontent-%COMP%]{font-size:10px;color:#71717a;text-align:center;margin-top:2px;white-space:nowrap}.timeline-track[_ngcontent-%COMP%]{position:absolute;top:24px;left:0;right:0;height:6px;background-color:#27272a;border-radius:3px;overflow:visible;cursor:pointer}.selected-range[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;background:linear-gradient(90deg,#3ecf8e,#2ea06d);border-radius:3px;transition:all .1s ease}.timeline-thumb[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translate(-50%,-50%);z-index:3;pointer-events:auto;cursor:grab}.timeline-thumb[_ngcontent-%COMP%]:active{cursor:grabbing}.thumb-circle[_ngcontent-%COMP%]{width:18px;height:18px;background:linear-gradient(135deg,#3ecf8e,#2ea06d);border:3px solid #18181b;border-radius:50%;box-shadow:0 2px 8px #3ecf8e66,0 0 #3ecf8e66;transition:all .2s ease;pointer-events:none}.timeline-thumb[_ngcontent-%COMP%]:hover   .thumb-circle[_ngcontent-%COMP%]{transform:scale(1.15);box-shadow:0 4px 12px #3ecf8e99,0 0 0 4px #3ecf8e1a}.timeline-thumb[_ngcontent-%COMP%]:active   .thumb-circle[_ngcontent-%COMP%]{transform:scale(1.1)}"]})};var ae=class r{constructor(e){this.supabase=e}async getDashboardStats(e){let t=new Date,n=t.getFullYear(),i=e?.startDate||`${n}-01-01`,a=e?.endDate||t.toISOString().slice(0,10);try{let c=this.supabase.client.from("incomes").select("amount").gte("date",i).lte("date",a);e?.paymentTypeIds?.length&&(c=c.in("paymentType_id",e.paymentTypeIds)),e?.incomeCategoryIds?.length&&(c=c.in("category_id",e.incomeCategoryIds));let{data:p}=await c,h=this.supabase.client.from("expenses").select("amount").gte("date",i).lte("date",a);e?.paymentTypeIds?.length&&(h=h.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(h=h.in("category_id",e.expenseCategoryIds));let{data:g}=await h,d=p?.reduce((y,b)=>y+(b.amount||0),0)||0,f=g?.reduce((y,b)=>y+(b.amount||0),0)||0,D="";if(i&&a){let y=new Date(i),b=new Date(a),M=y.toLocaleDateString("en-US",{month:"short",year:"numeric"}),T=b.toLocaleDateString("en-US",{month:"short",year:"numeric"});D=`${M} - ${T}`}else D=`Year ${n}`;let I=d>0?(d-f)/d*100:0;return{totalIncomes:d,totalExpenses:f,balance:d-f,savingsPercentage:I,period:D}}catch(c){return console.error("Error fetching dashboard stats:",c),{totalIncomes:0,totalExpenses:0,balance:0,savingsPercentage:0,period:""}}}async getIncomesVsExpenses(e){let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return[];try{let a=this.supabase.client.from("incomes").select("date, amount").gte("date",n).lt("date",i).order("date",{ascending:!0});e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.incomeCategoryIds?.length&&(a=a.in("category_id",e.incomeCategoryIds));let c=this.supabase.client.from("expenses").select("date, amount").gte("date",n).lt("date",i).order("date",{ascending:!0});e?.paymentTypeIds?.length&&(c=c.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(c=c.in("category_id",e.expenseCategoryIds));let[p,h]=await Promise.all([a,c]),g={},d=new Date(n),f=new Date(i),D=new Date(d.getFullYear(),d.getMonth(),1),I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(;D<=f;){let y=`${I[D.getMonth()]} ${String(D.getFullYear()).slice(2)}`;g[y]||(g[y]={month:y,incomes:0,expenses:0}),D.setMonth(D.getMonth()+1)}return p.data?.forEach(y=>{let b=new Date(y.date),M=`${I[b.getMonth()]} ${String(b.getFullYear()).slice(2)}`;g[M]&&(g[M].incomes+=y.amount||0)}),h.data?.forEach(y=>{let b=new Date(y.date),M=`${I[b.getMonth()]} ${String(b.getFullYear()).slice(2)}`;g[M]&&(g[M].expenses+=y.amount||0)}),Object.keys(g).sort((y,b)=>{let M=this.parseMonthKey(y),T=this.parseMonthKey(b);return M.getTime()-T.getTime()}).map(y=>g[y])}catch(a){return console.error("Error fetching incomes vs expenses:",a),[]}}parseMonthKey(e){let[t,n]=e.split(" "),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(t),c=2e3+parseInt(n,10);return new Date(c,a,1)}async getExpensesByCategory(e){let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return[];try{let a=this.supabase.client.from("expenses").select("amount, category_id, expense_categories(name, color)").gte("date",n).lt("date",i);e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(a=a.in("category_id",e.expenseCategoryIds));let{data:c,error:p}=await a;if(p)throw p;let h={};return c?.forEach(g=>{let d=g.expense_categories;if(d){let f=d.name;h[f]||(h[f]={value:0,color:d.color||"#71717a"}),h[f].value+=g.amount||0}}),Object.entries(h).map(([g,d])=>({name:g,value:d.value,color:d.color}))}catch(a){return console.error("Error fetching expenses by category:",a),[]}}async getExpensesByAccount(e){let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return[];try{let a=this.supabase.client.from("expenses").select("amount, paymentType_id, payment_types(name, color)").gte("date",n).lt("date",i);e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(a=a.in("category_id",e.expenseCategoryIds));let{data:c,error:p}=await a;if(p)throw p;let h={};return c?.forEach(g=>{let d=g.payment_types;if(d){let f=d.name;h[f]||(h[f]={value:0,color:d.color||"#71717a"}),h[f].value+=g.amount||0}}),Object.entries(h).map(([g,d])=>({name:g,value:d.value,color:d.color}))}catch(a){return console.error("Error fetching expenses by account:",a),[]}}async getIncomesByAccount(e){let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return[];try{let a=this.supabase.client.from("incomes").select("amount, paymentType_id, payment_types(name, color)").gte("date",n).lt("date",i);e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.incomeCategoryIds?.length&&(a=a.in("category_id",e.incomeCategoryIds));let{data:c,error:p}=await a;if(p)throw p;let h={};return c?.forEach(g=>{let d=g.payment_types;if(d){let f=d.name;h[f]||(h[f]={value:0,color:d.color||"#71717a"}),h[f].value+=g.amount||0}}),Object.entries(h).map(([g,d])=>({name:g,value:d.value,color:d.color}))}catch(a){return console.error("Error fetching incomes by account:",a),[]}}async getExpensesByCategoryPerMonth(e){let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return{categories:[],series:[],months:[]};try{let a=this.supabase.client.from("expenses").select("amount, date, category_id, expense_categories(name, color)").gte("date",n).lt("date",i);e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(a=a.in("category_id",e.expenseCategoryIds));let{data:c,error:p}=await a;if(p)throw p;let h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g={},d=new Date(n),f=new Date(i),D=new Date(d.getFullYear(),d.getMonth(),1),I=0;for(;D<=f;){let C=`${h[D.getMonth()]} ${String(D.getFullYear()).slice(2)}`;g[C]=I++,D.setMonth(D.getMonth()+1)}let y=Object.keys(g).sort((C,P)=>{let Y=this.parseMonthKey(C),W=this.parseMonthKey(P);return Y.getTime()-W.getTime()}),b={};c?.forEach(C=>{let P=C.expense_categories;if(P){let Y=P.name,W=new Date(C.date),we=`${h[W.getMonth()]} ${String(W.getFullYear()).slice(2)}`,se=g[we];se!==void 0&&(b[Y]||(b[Y]={values:new Array(y.length).fill(0),color:P.color||"#71717a"}),b[Y].values[se]+=C.amount||0)}});let M=Object.keys(b),T=M.map(C=>({name:C,data:b[C].values,color:b[C].color}));return{categories:M,series:T,months:y}}catch(a){return console.error("Error fetching expenses by category per month:",a),{categories:[],series:[],months:[]}}}async getFirstTransactionDate(){try{let[e,t]=await Promise.all([this.supabase.client.from("expenses").select("date").order("date",{ascending:!0}).limit(1).maybeSingle(),this.supabase.client.from("incomes").select("date").order("date",{ascending:!0}).limit(1).maybeSingle()]),n=e.data?.date,i=t.data?.date;return!n&&!i?null:n?i?n<i?n:i:n:i}catch(e){return console.error("Error getting first transaction date:",e),null}}async getTopExpenses(e){try{let t=new Date,n=e?.startDate,i=e?.endDate||t.toISOString().slice(0,10);if(!n||!i)return[];let a=this.supabase.client.from("expenses").select("id, name, amount, date, category_id, expense_categories(name, color)").gte("date",n).lt("date",i).order("amount",{ascending:!1}).limit(5);e?.paymentTypeIds?.length&&(a=a.in("paymentType_id",e.paymentTypeIds)),e?.expenseCategoryIds?.length&&(a=a.in("category_id",e.expenseCategoryIds));let{data:c}=await a;return(c||[]).map(p=>R(A({},p),{type:"expense",category:p.expense_categories?.name,color:p.expense_categories?.color}))}catch(t){return console.error("Error fetching top expenses:",t),[]}}async getRecentTransactions(e){try{let t=this.supabase.client.from("incomes").select("id, name, amount, date, category_id, income_categories(name)").order("date",{ascending:!1}).limit(3),n=this.supabase.client.from("expenses").select("id, name, amount, date, category_id, expense_categories(name)").order("date",{ascending:!1}).limit(3);e?.startDate&&(t=t.gte("date",e.startDate),n=n.gte("date",e.startDate)),e?.endDate&&(t=t.lt("date",e.endDate),n=n.lt("date",e.endDate)),e?.paymentTypeIds?.length&&(t=t.in("paymentType_id",e.paymentTypeIds),n=n.in("paymentType_id",e.paymentTypeIds)),e?.incomeCategoryIds?.length&&(t=t.in("category_id",e.incomeCategoryIds)),e?.expenseCategoryIds?.length&&(n=n.in("category_id",e.expenseCategoryIds));let[i,a]=await Promise.all([t,n]),c=(i.data||[]).map(g=>R(A({},g),{type:"income",category:g.income_categories?.name})),p=(a.data||[]).map(g=>R(A({},g),{type:"expense",category:g.expense_categories?.name})),h=[...c,...p];return h.sort((g,d)=>new Date(d.date).getTime()-new Date(g.date).getTime()),h.slice(0,5)}catch(t){return console.error("Error fetching recent transactions:",t),[]}}static \u0275fac=function(t){return new(t||r)(re(ge))};static \u0275prov=oe({token:r,factory:r.\u0275fac,providedIn:"root"})};function Be(r,e){r&1&&(s(0,"div",12)(1,"div",13),x(2,"div",14),s(3,"p",15),m(4,"Loading dashboard..."),o()()())}function Ne(r,e){if(r&1&&(s(0,"div",50)(1,"div",51),m(2),x(3,"div",52),o()()),r&2){let t=e.$implicit,n=v(2);O("background",t.color||"#71717a")("width",n.stats.totalIncomes>0?t.value/n.stats.totalIncomes*100:0,"%"),l(2),Z(" ",t.name,": ",n.formatCurrency(t.value)," ")}}function He(r,e){if(r&1&&(s(0,"div",50)(1,"div",51),m(2),x(3,"div",52),o()()),r&2){let t=e.$implicit,n=v(2);O("background",t.color||"#71717a")("width",n.stats.totalExpenses>0?t.value/n.stats.totalExpenses*100:0,"%"),l(2),Z(" ",t.name,": ",n.formatCurrency(t.value)," ")}}function Ve(r,e){if(r&1&&x(0,"span",65),r&2){let t=v().$implicit;O("background",t.color)}}function $e(r,e){if(r&1&&(s(0,"tr",60)(1,"td",61),m(2),o(),s(3,"td",62),_(4,Ve,1,2,"span",63),m(5),o(),s(6,"td",62),m(7),o(),s(8,"td",64),m(9),o()()),r&2){let t=e.$implicit,n=v(3);l(2),S(" ",t.name," "),l(2),u("ngIf",t.color),l(),S(" ",t.category||"-"," "),l(2),S(" ",n.formatDate(t.date)," "),l(2),S(" -",n.formatCurrency(t.amount)," ")}}function Ue(r,e){if(r&1&&(s(0,"div",41)(1,"div",42)(2,"h4",43),m(3,"Top 5 Highest Expenses"),o()(),s(4,"div",53)(5,"table",54)(6,"thead",55)(7,"tr")(8,"th",56),m(9," Description "),o(),s(10,"th",56),m(11," Category "),o(),s(12,"th",56),m(13," Date "),o(),s(14,"th",57),m(15," Amount "),o()()(),s(16,"tbody",58),_(17,$e,10,5,"tr",59),o()()()()),r&2){let t=v(2);l(17),u("ngForOf",t.topExpenses)}}function je(r,e){if(r&1&&(s(0,"div")(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20),E(),s(6,"svg",21),x(7,"path",22),o()(),N(),s(8,"div",23)(9,"dl")(10,"dt",24),m(11,"Total Incomes"),o(),s(12,"dd")(13,"div",25),m(14),o()()()()(),s(15,"div",8)(16,"div",26)(17,"span"),m(18,"Accounts"),o(),s(19,"span"),m(20),o()(),s(21,"div",27),_(22,Ne,4,6,"div",28),o()()()(),s(23,"div",17)(24,"div",18)(25,"div",19)(26,"div",20),E(),s(27,"svg",29),x(28,"path",30),o()(),N(),s(29,"div",23)(30,"dl")(31,"dt",24),m(32,"Total Expenses"),o(),s(33,"dd")(34,"div",31),m(35),o()()()()(),s(36,"div",8)(37,"div",26)(38,"span"),m(39,"Accounts"),o(),s(40,"span"),m(41),o()(),s(42,"div",27),_(43,He,4,6,"div",28),o()()()(),s(44,"div",17)(45,"div",18)(46,"div",19)(47,"div",20),E(),s(48,"svg",32),x(49,"path",33),o()(),N(),s(50,"div",23)(51,"dl")(52,"dt",24),m(53,"Balance"),o(),s(54,"dd")(55,"div",34),m(56),o()()()()(),s(57,"div",8)(58,"div",35)(59,"div",36),m(60,"Savings Rate"),o(),s(61,"div",37),m(62),o()(),s(63,"div",38),x(64,"div",39),o()()()()(),_(65,Ue,18,1,"div",40),s(66,"div",41)(67,"div",42)(68,"h4",43),m(69,"Incomes vs Expenses"),o()(),s(70,"div",18),x(71,"apx-chart",44),o()(),s(72,"div",41)(73,"div",42)(74,"h4",43),m(75,"Expenses by category"),o()(),s(76,"div",45),x(77,"apx-chart",46),o()(),s(78,"div",47)(79,"div",17)(80,"div",42)(81,"h4",48),m(82,"Expenses by category"),o()(),s(83,"div",18),x(84,"apx-chart",49),o()(),s(85,"div",17)(86,"div",42)(87,"h4",48),m(88,"Expenses by account"),o()(),s(89,"div",18),x(90,"apx-chart",49),o()(),s(91,"div",17)(92,"div",42)(93,"h4",48),m(94,"Incomes by account"),o()(),s(95,"div",18),x(96,"apx-chart",49),o()()()()),r&2){let t=v();l(14),S(" ",t.formatCurrency(t.stats.totalIncomes)," "),l(6),S("",t.incomesPaymentTypes.length," accounts"),l(2),u("ngForOf",t.incomesPaymentTypes),l(13),S(" ",t.formatCurrency(t.stats.totalExpenses)," "),l(6),S("",t.expensesPaymentTypes.length," accounts"),l(2),u("ngForOf",t.expensesPaymentTypes),l(5),k("text-brand",t.stats.balance>=0)("text-red-500",t.stats.balance<0),l(7),k("text-brand",t.stats.balance>=0)("text-red-500",t.stats.balance<0),l(),S(" ",t.formatCurrency(t.stats.balance)," "),l(5),k("text-brand",t.stats.savingsPercentage>=0)("text-red-500",t.stats.savingsPercentage<0),l(),Z(" ",t.stats.savingsPercentage>=0?"+":"","",t.stats.savingsPercentage.toFixed(1),"% "),l(2),O("width",t.Math.max(0,t.Math.min(100,t.stats.savingsPercentage)),"%"),k("bg-brand",t.stats.savingsPercentage>=0)("bg-red-500",t.stats.savingsPercentage<0),l(),u("ngIf",t.topExpenses.length>0),l(6),u("series",t.lineChartOptions.series)("chart",t.lineChartOptions.chart)("dataLabels",t.lineChartOptions.dataLabels)("stroke",t.lineChartOptions.stroke)("fill",t.lineChartOptions.fill)("xaxis",t.lineChartOptions.xaxis)("yaxis",t.lineChartOptions.yaxis)("grid",t.lineChartOptions.grid)("legend",t.lineChartOptions.legend)("tooltip",t.lineChartOptions.tooltip)("theme",t.lineChartOptions.theme),l(6),u("series",t.stackedBarChartOptions.series)("chart",t.stackedBarChartOptions.chart)("plotOptions",t.stackedBarChartOptions.plotOptions)("dataLabels",t.stackedBarChartOptions.dataLabels)("xaxis",t.stackedBarChartOptions.xaxis)("yaxis",t.stackedBarChartOptions.yaxis)("grid",t.stackedBarChartOptions.grid)("legend",t.stackedBarChartOptions.legend)("fill",t.stackedBarChartOptions.fill)("tooltip",t.stackedBarChartOptions.tooltip)("theme",t.stackedBarChartOptions.theme),l(7),u("series",t.expensesCategoryChartOptions.series)("chart",t.expensesCategoryChartOptions.chart)("labels",t.expensesCategoryChartOptions.labels)("colors",t.expensesCategoryChartOptions.colors)("dataLabels",t.expensesCategoryChartOptions.dataLabels)("plotOptions",t.expensesCategoryChartOptions.plotOptions)("legend",t.expensesCategoryChartOptions.legend)("tooltip",t.expensesCategoryChartOptions.tooltip)("theme",t.expensesCategoryChartOptions.theme)("states",t.expensesCategoryChartOptions.states)("stroke",t.expensesCategoryChartOptions.stroke),l(6),u("series",t.expensesAccountChartOptions.series)("chart",t.expensesAccountChartOptions.chart)("labels",t.expensesAccountChartOptions.labels)("colors",t.expensesAccountChartOptions.colors)("dataLabels",t.expensesAccountChartOptions.dataLabels)("plotOptions",t.expensesAccountChartOptions.plotOptions)("legend",t.expensesAccountChartOptions.legend)("tooltip",t.expensesAccountChartOptions.tooltip)("theme",t.expensesAccountChartOptions.theme)("states",t.expensesAccountChartOptions.states)("stroke",t.expensesCategoryChartOptions.stroke),l(6),u("series",t.incomesAccountChartOptions.series)("chart",t.incomesAccountChartOptions.chart)("labels",t.incomesAccountChartOptions.labels)("colors",t.incomesAccountChartOptions.colors)("dataLabels",t.incomesAccountChartOptions.dataLabels)("plotOptions",t.incomesAccountChartOptions.plotOptions)("legend",t.incomesAccountChartOptions.legend)("tooltip",t.incomesAccountChartOptions.tooltip)("theme",t.incomesAccountChartOptions.theme)("states",t.incomesAccountChartOptions.states)("stroke",t.expensesCategoryChartOptions.stroke)}}var _e=class r{constructor(e,t,n,i){this.dashboardService=e;this.financeService=t;this.ngZone=n;this.cdr=i;this.initializeChartDefaults()}isLoading=!0;stats={totalIncomes:0,totalExpenses:0,balance:0,savingsPercentage:0,period:""};topExpenses=[];incomesPaymentTypes=[];expensesPaymentTypes=[];lineChartOptions;stackedBarChartOptions;expensesCategoryChartOptions;expensesAccountChartOptions;incomesAccountChartOptions;selectedPeriod="current-month";selectedPaymentTypes=[];selectedExpenseCategories=[];selectedIncomeCategories=[];paymentTypes=[];expenseCategories=[];incomeCategories=[];periodOptions=[{value:"current-month",label:"Current Month"},{value:"last-30-days",label:"Last 30 days"},{value:"last-6-months",label:"Last 6 months"},{value:"last-12-months",label:"Last 12 months"},{value:"all",label:"All"},{value:"custom",label:"Custom"}];timelineMinDate="2022-01-01";timelineMaxDate=new Date().toISOString().split("T")[0];customDateRange=null;Math=Math;instanceId=Math.random().toString(16).slice(2,8);timelineDebounceTimer=null;TIMELINE_DEBOUNCE_MS=500;async ngOnInit(){await this.loadFilterOptions(),await this.updateTimelineFromPeriod(),await this.loadDashboardData()}async loadFilterOptions(){try{let[e,t,n]=await Promise.all([this.financeService.getPaymentTypes(),this.financeService.getCategories(),this.financeService.getIncomeCategories()]);this.paymentTypes=e||[],this.expenseCategories=t||[],this.incomeCategories=n||[]}catch(e){console.error("Error loading filter options",e)}}async calculateDateRange(){let e=new Date,t=e.toISOString().slice(0,10),i=new Date(e.getFullYear(),e.getMonth()+1,1).toISOString().slice(0,10);switch(this.selectedPeriod){case"current-month":{let a=e.getFullYear(),c=e.getMonth()+1,p=new Date(a,e.getMonth()+1,0).getDate();return{startDate:`${a}-${String(c).padStart(2,"0")}-01`,endDate:`${a}-${String(c).padStart(2,"0")}-${String(p).padStart(2,"0")}`}}case"last-30-days":{let a=new Date(e);return a.setDate(a.getDate()-30),{startDate:a.toISOString().slice(0,10),endDate:t}}case"last-6-months":return{startDate:new Date(e.getFullYear(),e.getMonth()-5,1).toISOString().slice(0,10),endDate:i};case"last-12-months":return{startDate:new Date(e.getFullYear(),e.getMonth()-11,1).toISOString().slice(0,10),endDate:i};case"custom":{if(this.customDateRange)return{startDate:this.customDateRange.startDate,endDate:this.customDateRange.endDate};let a=new Date(e.getFullYear(),e.getMonth(),1),c=new Date(e.getFullYear(),e.getMonth()+1,0);return{startDate:a.toISOString().slice(0,10),endDate:c.toISOString().slice(0,10)}}case"all":default:return{startDate:await this.getFirstTransactionDate()||void 0,endDate:i}}}async getFirstTransactionDate(){return await this.dashboardService.getFirstTransactionDate()}async buildFilters(){let e,t;if(this.customDateRange)e=this.customDateRange.startDate,t=this.customDateRange.endDate;else{let n=await this.calculateDateRange();e=n.startDate,t=n.endDate}return{startDate:e,endDate:t,paymentTypeIds:this.selectedPaymentTypes,expenseCategoryIds:this.selectedExpenseCategories,incomeCategoryIds:this.selectedIncomeCategories}}async onPeriodChange(e){this.selectedPeriod=e,this.selectedPeriod!=="custom"&&(this.customDateRange=null,await this.updateTimelineFromPeriod()),await this.loadDashboardData()}async onPaymentTypesChange(e){this.selectedPaymentTypes=e.map(t=>Number(t)),await this.loadDashboardData()}async onExpenseCategoriesChange(e){this.selectedExpenseCategories=e.map(t=>Number(t)),await this.loadDashboardData()}async onIncomeCategoriesChange(e){this.selectedIncomeCategories=e.map(t=>Number(t)),await this.loadDashboardData()}initializeChartDefaults(){this.lineChartOptions=this.createLineChartOptions([],[]),this.stackedBarChartOptions=this.createStackedBarOptions([],[]),this.expensesCategoryChartOptions=this.createPieChartOptions([],"Expenses by category"),this.expensesAccountChartOptions=this.createPieChartOptions([],"Expenses by account"),this.incomesAccountChartOptions=this.createPieChartOptions([],"Incomes by account")}async loadDashboardData(){this.isLoading=!0,console.info("[HomeComponent] loadDashboardData: start");try{let e=await this.buildFilters(),t=await Promise.allSettled([this.dashboardService.getDashboardStats(e),this.dashboardService.getIncomesVsExpenses(e),this.dashboardService.getExpensesByCategory(e),this.dashboardService.getExpensesByCategoryPerMonth(e),this.dashboardService.getExpensesByAccount(e),this.dashboardService.getIncomesByAccount(e),this.dashboardService.getTopExpenses(e)]),[n,i,a,c,p,h,g]=t,d=(C,P)=>C.status==="fulfilled"?C.value:(console.warn("[HomeComponent] dashboard load item failed",C.reason),P),f=d(n,{totalIncomes:0,totalExpenses:0,balance:0,savingsPercentage:0,period:""}),D=d(i,[]),I=d(a,[]),y=d(c,{categories:[],series:[],months:[]}),b=d(p,[]),M=d(h,[]),T=d(g,[]);this.ngZone.run(()=>{this.stats=f,this.topExpenses=T,this.expensesPaymentTypes=b,this.incomesPaymentTypes=M,this.lineChartOptions=this.createLineChartOptions(D,D.map(C=>C.month)),this.stackedBarChartOptions=this.createStackedBarOptions(y.series,y.months),this.expensesCategoryChartOptions=this.createPieChartOptions(I,"Expenses by category"),this.expensesAccountChartOptions=this.createPieChartOptions(b,"Expenses by account"),this.incomesAccountChartOptions=this.createPieChartOptions(M,"Incomes by account"),this.cdr.detectChanges()})}catch(e){console.error("Error loading dashboard data:",e)}finally{this.ngZone.run(()=>{this.isLoading=!1,this.cdr.detectChanges()}),console.info("[HomeComponent] loadDashboardData: end")}}createLineChartOptions(e,t){let n=e.map(a=>a.incomes||0),i=e.map(a=>a.expenses||0);return{series:[{name:"Incomes",data:n,color:"#3ECF8E"},{name:"Expenses",data:i,color:"#ef4444"}],chart:{type:"area",height:350,background:"transparent",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.4,opacityTo:.1,stops:[0,90,100]}},xaxis:{categories:t,labels:{style:{colors:"#a1a1aa",fontSize:"12px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:"#a1a1aa",fontSize:"12px"},formatter:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}},grid:{borderColor:"#2a2a2a",strokeDashArray:4,xaxis:{lines:{show:!1}}},legend:{position:"top",horizontalAlign:"right",labels:{colors:"#e4e4e7"},markers:{size:6,strokeWidth:0}},tooltip:{theme:"dark",y:{formatter:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(a)}},theme:{mode:"dark"}}}createStackedBarOptions(e,t){return{series:e.map(i=>R(A({},i),{data:i.data.map(a=>a),color:i.color})),chart:{type:"bar",height:400,stacked:!0,background:"transparent",toolbar:{show:!1},foreColor:"#a1a1aa"},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,dataLabels:{position:"top"}}},fill:{opacity:.5},dataLabels:{enabled:!1},xaxis:{categories:t,labels:{style:{colors:"#a1a1aa",fontSize:"12px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:"#a1a1aa",fontSize:"12px"},formatter:i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i)}},grid:{borderColor:"#2a2a2a",strokeDashArray:4,xaxis:{lines:{show:!1}}},legend:{position:"top",horizontalAlign:"left",labels:{colors:"#e4e4e7"},markers:{width:10,height:10,radius:5,shape:"circle",strokeWidth:0}},tooltip:{theme:"dark",y:{formatter:i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(i)}},theme:{mode:"dark"}}}hexToRgba(e,t){let n=e.replace("#",""),i=parseInt(n.substring(0,2),16),a=parseInt(n.substring(2,4),16),c=parseInt(n.substring(4,6),16);return`rgba(${i}, ${a}, ${c}, ${t})`}createPieChartOptions(e,t){let n=e.map(p=>p.value),i=e.map(p=>p.name),a=e.map(p=>p.color),c=a.length>0?a.map(p=>this.hexToRgba(p,.5)):[this.hexToRgba("#71717a",.5)];return{series:n.length>0?n:[1],chart:{type:"donut",height:320,background:"transparent"},labels:i.length>0?i:["No data"],colors:c,dataLabels:{enabled:!1},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,total:{show:!0,label:"Total",fontSize:"14px",color:"#a1a1aa",formatter:p=>{let h=p.globals.seriesTotals.reduce((g,d)=>g+d,0);return new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(h)}},value:{show:!0,fontSize:"20px",color:"#e4e4e7",fontWeight:600}}}}},stroke:{show:!1,width:0,colors:["transparent"]},legend:{position:"bottom",labels:{colors:"#e4e4e7"},markers:{size:6,strokeWidth:0}},tooltip:{theme:"dark",y:{formatter:p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(p)}},theme:{mode:"dark"},states:{hover:{filter:{type:"lighten",value:.1}}}}}formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(e)}formatDate(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}async onDateRangeChange(e){this.customDateRange=e,console.log("Custom date range selected:",e),e&&this.selectedPeriod!=="custom"&&(this.selectedPeriod="custom"),this.timelineDebounceTimer&&clearTimeout(this.timelineDebounceTimer),this.timelineDebounceTimer=setTimeout(async()=>{await this.loadDashboardData(),this.timelineDebounceTimer=null},this.TIMELINE_DEBOUNCE_MS)}async updateTimelineFromPeriod(){let{startDate:e,endDate:t}=await this.calculateDateRange();e&&t&&(this.customDateRange={startDate:e,endDate:t})}static \u0275fac=function(t){return new(t||r)(F(ae),F(be),F(le),F(pe))};static \u0275cmp=H({type:r,selectors:[["app-home"]],decls:20,vars:22,consts:[[1,"space-y-6","p-6"],[1,"border-b","border-sidebar-border","pb-5"],[1,"text-2xl","font-semibold","leading-6","text-white"],[1,"mt-2","max-w-4xl","text-sm","text-slate-400"],[1,"bg-background-card","border","border-sidebar-border","rounded-lg","p-4","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],["bgColor","bg-dark-blue",3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],[3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],[1,"mt-4","pt-4","border-t","border-sidebar-border"],[3,"ngModelChange","rangeChange","minDate","maxDate","ngModel"],["class","flex items-center justify-center py-12",4,"ngIf"],[4,"ngIf"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"mt-2","text-sm","text-slate-400"],[1,"grid","grid-cols-1","gap-5","sm:grid-cols-2","lg:grid-cols-3","mb-6"],[1,"overflow-hidden","rounded-lg","bg-background-card","shadow","border","border-sidebar-border"],[1,"p-5"],[1,"flex","items-center"],[1,"flex-shrink-0"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-brand"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 11l5-5m0 0l5 5m-5-5v12"],[1,"ml-5","w-0","flex-1"],[1,"truncate","text-sm","font-medium","text-slate-400"],[1,"text-lg","font-semibold","text-brand"],[1,"flex","items-center","justify-between","text-sm","text-slate-400","mb-2"],[1,"flex","items-center","space-x-1","relative"],["class","flex-1 h-2 rounded-full relative group",3,"background","width",4,"ngFor","ngForOf"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 13l-5 5m0 0l-5-5m5 5V6"],[1,"text-lg","font-semibold","text-red-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-semibold"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-slate-400"],[1,"text-sm","font-semibold"],[1,"mt-2","w-full","bg-slate-700","rounded-full","h-2"],[1,"h-2","rounded-full"],["class","mb-6 overflow-hidden rounded-lg bg-background-card shadow border border-sidebar-border",4,"ngIf"],[1,"mb-6","overflow-hidden","rounded-lg","bg-background-card","shadow","border","border-sidebar-border"],[1,"px-5","py-4","border-b","border-sidebar-border"],[1,"text-base","font-semibold","text-white"],[3,"series","chart","dataLabels","stroke","fill","xaxis","yaxis","grid","legend","tooltip","theme"],[1,"p-5","stacked-bar-chart-container"],[3,"series","chart","plotOptions","dataLabels","xaxis","yaxis","grid","legend","fill","tooltip","theme"],[1,"grid","grid-cols-1","gap-5","lg:grid-cols-3"],[1,"text-sm","font-semibold","text-white"],[3,"series","chart","labels","colors","dataLabels","plotOptions","legend","tooltip","theme","states","stroke"],[1,"flex-1","h-2","rounded-full","relative","group"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-2","py-1","bg-slate-800","text-white","text-xs","rounded","opacity-0","group-hover:opacity-100","transition-opacity","whitespace-nowrap","z-10"],[1,"absolute","top-full","left-1/2","transform","-translate-x-1/2","w-0","h-0","border-l-4","border-r-4","border-t-4","border-transparent","border-t-slate-800"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-sidebar-border"],[1,""],["scope","col",1,"px-5","py-3","text-left","text-xs","font-medium","text-slate-400","uppercase","tracking-wider"],["scope","col",1,"px-5","py-3","text-right","text-xs","font-medium","text-slate-400","uppercase","tracking-wider"],[1,"divide-y","divide-sidebar-border"],["class","hover:bg-slate-900/30",4,"ngFor","ngForOf"],[1,"hover:bg-slate-900/30"],[1,"px-5","py-4","whitespace-nowrap","text-sm","font-medium","text-white"],[1,"px-5","py-4","whitespace-nowrap","text-sm","text-slate-400"],["class","inline-block h-3 w-3 rounded-full mr-2",3,"background",4,"ngIf"],[1,"px-5","py-4","whitespace-nowrap","text-sm","text-right","font-semibold","text-red-500"],[1,"inline-block","h-3","w-3","rounded-full","mr-2"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"h3",2),m(3,"Dashboard"),o(),s(4,"p",3),m(5),o()(),s(6,"div",4)(7,"div",5)(8,"div")(9,"app-select",6),U("ngModelChange",function(a){return $(n.selectedPeriod,a)||(n.selectedPeriod=a),a}),w("selectionChange",function(a){return n.onPeriodChange(a)}),o()(),s(10,"div")(11,"app-multiselect",7),U("ngModelChange",function(a){return $(n.selectedPaymentTypes,a)||(n.selectedPaymentTypes=a),a}),w("selectionChange",function(a){return n.onPaymentTypesChange(a)}),o()(),s(12,"div")(13,"app-multiselect",7),U("ngModelChange",function(a){return $(n.selectedExpenseCategories,a)||(n.selectedExpenseCategories=a),a}),w("selectionChange",function(a){return n.onExpenseCategoriesChange(a)}),o()(),s(14,"div")(15,"app-multiselect",7),U("ngModelChange",function(a){return $(n.selectedIncomeCategories,a)||(n.selectedIncomeCategories=a),a}),w("selectionChange",function(a){return n.onIncomeCategoriesChange(a)}),o()()(),s(16,"div",8)(17,"app-date-range-timeline",9),U("ngModelChange",function(a){return $(n.customDateRange,a)||(n.customDateRange=a),a}),w("rangeChange",function(a){return n.onDateRangeChange(a)}),o()()(),_(18,Be,5,0,"div",10)(19,je,97,83,"div",11),o()),t&2&&(l(5),S("Financial overview for ",n.stats.period),l(4),u("options",n.periodOptions)("label","Period")("placeholder","Select period..."),V("ngModel",n.selectedPeriod),l(2),u("options",n.paymentTypes)("label","Accounts")("placeholder","Select accounts..."),V("ngModel",n.selectedPaymentTypes),l(2),u("options",n.expenseCategories)("label","Expense categories")("placeholder","Select categories..."),V("ngModel",n.selectedExpenseCategories),l(2),u("options",n.incomeCategories)("label","Income categories")("placeholder","Select income categories..."),V("ngModel",n.selectedIncomeCategories),l(2),u("minDate",n.timelineMinDate)("maxDate",n.timelineMaxDate),V("ngModel",n.customDateRange),l(),u("ngIf",n.isLoading),l(),u("ngIf",!n.isLoading))},dependencies:[z,j,X,ve,fe,te,xe,ye,he,ue,ne],styles:["[_nghost-%COMP%]{display:block}"]})};export{_e as HomeComponent};
