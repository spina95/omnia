import{a as B}from"./chunk-5RPC6D7M.js";import{a as F}from"./chunk-NOX2NNDY.js";import{a as W}from"./chunk-A7WDRQMW.js";import{b as U,d as N,e as ae,f as se,g as O,h as le,q as j}from"./chunk-FK4TPJ32.js";import{$a as d,Ab as ie,Ba as S,Fa as I,G as J,Ja as _,Jb as ne,K as Q,Pa as m,Qa as o,R as p,Ra as r,S as g,Sa as f,T as x,U as w,Vb as P,Wa as Y,Wb as T,Xa as Z,Ya as D,Z as E,Za as u,Zb as oe,ac as V,fc as re,kb as $,mb as s,nb as h,ob as z,pb as ee,qa as X,rb as b,sb as C,ta as c,tb as v,yb as te}from"./chunk-VED3HVHJ.js";import{a as G,b as A}from"./chunk-VOSPIT4N.js";var k=class l{constructor(n){this.supabaseService=n}bucket="documents";async getCurrentUserId(){let{data:n}=await this.supabaseService.client.auth.getUser();return n?.user?.id??null}async listCategories(){let n=await this.getCurrentUserId(),e=this.supabaseService.client.from("document_categories").select("*").order("created_at",{ascending:!1});n&&(e=e.eq("user_id",n));let{data:i,error:t}=await e;if(t)throw t;return i??[]}async createCategory(n){let e=await this.getCurrentUserId(),i=A(G({},n),{user_id:e}),{data:t,error:a}=await this.supabaseService.client.from("document_categories").insert([i]).select().single();if(a)throw a;return t}async deleteCategory(n){let e=await this.getCurrentUserId(),i=this.supabaseService.client.from("document_categories").delete().eq("id",n);e&&(i=i.eq("user_id",e));let{error:t}=await i;if(t)throw t}async createDocumentMetadata(n){let e=await this.getCurrentUserId(),i=A(G({},n),{user_id:e});i.category_id!==null&&i.category_id!==void 0?i.category_id=Number(i.category_id):i.category_id=null,console.debug("DocumentsService.createDocumentMetadata: toInsert =",i);let{data:t,error:a}=await this.supabaseService.client.from("documents").insert([i]).select().single();if(a)throw a;return t}async listDocuments(n={}){let e=await this.getCurrentUserId(),i=n.page??1,t=n.pageSize??12,a=n.search??"",y=(i-1)*t,ue=y+t-1,M=this.supabaseService.client.from("documents").select("*, document_categories(id, name)",{count:"exact"}).order("created_at",{ascending:!1});n.categoryId&&(M=M.eq("category_id",Number(n.categoryId))),e&&(M=M.eq("user_id",e)),a&&(M=M.ilike("name",`%${a}%`));let{data:fe,error:K,count:_e}=await M.range(y,ue);if(K)throw K;return{data:fe??[],count:_e??0}}async uploadFile(n,e){let{data:i,error:t}=await this.supabaseService.client.storage.from(this.bucket).upload(e,n,{cacheControl:"3600",upsert:!1});if(t)throw t;return i}async generateSignedDownloadUrl(n,e=300){let{data:i,error:t}=await this.supabaseService.client.storage.from(this.bucket).createSignedUrl(n,e);if(t)throw t;return i}async deleteFileFromStorage(n){let{data:e,error:i}=await this.supabaseService.client.storage.from(this.bucket).remove([n]);if(i)throw i;return e}async deleteDocument(n){let e=await this.getCurrentUserId(),i=this.supabaseService.client.from("documents").delete().eq("id",n);e&&(i=i.eq("user_id",e));let{data:t,error:a}=await i;if(a)throw a;return t}async updateDocument(n,e){let i=await this.getCurrentUserId(),t=this.supabaseService.client.from("documents").update(e).eq("id",n);i&&(t=t.eq("user_id",i));let{data:a,error:y}=await t.select().single();if(y)throw y;return a}static \u0275fac=function(e){return new(e||l)(Q(re))};static \u0275prov=J({token:l,factory:l.\u0275fac,providedIn:"root"})};function xe(l,n){l&1&&(x(),o(0,"svg",23),f(1,"circle",24)(2,"path",25),r())}function he(l,n){l&1&&(o(0,"div",26),s(1," No categories yet. Create your first category above. "),r())}function be(l,n){if(l&1&&(o(0,"p",37),s(1),r()),l&2){let e=d().$implicit;c(),z(" ",e.description," ")}}function Ce(l,n){if(l&1){let e=D();o(0,"div",29)(1,"div",30)(2,"div",31)(3,"h5",32),s(4),r(),_(5,be,2,1,"p",33),r(),o(6,"button",34),u("click",function(){let t=p(e).$implicit,a=d(3);return g(a.confirmDelete(t))}),x(),o(7,"svg",35),f(8,"path",36),r()()()()}if(l&2){let e=n.$implicit;c(4),h(e.name),c(),m("ngIf",e.description)}}function ve(l,n){if(l&1&&(o(0,"div",27),_(1,Ce,9,2,"div",28),r()),l&2){let e=d(2);c(),m("ngForOf",e.categories)}}function ye(l,n){if(l&1){let e=D();o(0,"div",2),u("click",function(){p(e);let t=d();return g(t.close())}),o(1,"div",3),u("click",function(t){return p(e),g(t.stopPropagation())}),o(2,"div",4)(3,"h3",5),s(4,"Manage Categories"),r(),o(5,"button",6),u("click",function(){p(e);let t=d();return g(t.close())}),x(),o(6,"svg",7),f(7,"path",8),r()()(),w(),o(8,"div",9)(9,"div",10)(10,"h4",11),s(11,"Create New Category"),r(),o(12,"div",12)(13,"div")(14,"label",13),s(15," Category Name "),o(16,"span",14),s(17,"*"),r()(),o(18,"input",15),v("ngModelChange",function(t){p(e);let a=d();return C(a.newCategoryName,t)||(a.newCategoryName=t),g(t)}),r()(),o(19,"div")(20,"label",13),s(21,"Description (Optional)"),r(),o(22,"textarea",16),v("ngModelChange",function(t){p(e);let a=d();return C(a.newCategoryDescription,t)||(a.newCategoryDescription=t),g(t)}),r()(),o(23,"button",17),u("click",function(){p(e);let t=d();return g(t.createCategory())}),_(24,xe,3,0,"svg",18),s(25),r()()(),o(26,"div")(27,"h4",11),s(28,"Existing Categories"),r(),_(29,he,2,0,"div",19)(30,ve,2,1,"div",20),r()(),o(31,"div",21)(32,"button",22),u("click",function(){p(e);let t=d();return g(t.close())}),s(33," Close "),r()()()()}if(l&2){let e=d();c(18),b("ngModel",e.newCategoryName),m("disabled",e.isCreating),c(4),b("ngModel",e.newCategoryDescription),m("disabled",e.isCreating),c(),m("disabled",e.isCreating||!e.newCategoryName.trim()),c(),m("ngIf",e.isCreating),c(),z(" ",e.isCreating?"Creating...":"Create Category"," "),c(4),m("ngIf",e.categories.length===0),c(),m("ngIf",e.categories.length>0)}}var L=class l{constructor(n,e){this.documentsService=n;this.notificationService=e}isOpen=!1;closeDialog=new E;updated=new E;categories=[];newCategoryName="";newCategoryDescription="";isCreating=!1;showDeleteConfirm=!1;categoryToDelete=null;ngOnInit(){this.loadCategories()}async loadCategories(){try{this.categories=await this.documentsService.listCategories()}catch(n){this.notificationService.error(n.message||"Failed to load categories")}}async createCategory(){if(!this.newCategoryName.trim()){this.notificationService.error("Category name is required");return}this.isCreating=!0;try{await this.documentsService.createCategory({name:this.newCategoryName.trim(),description:this.newCategoryDescription.trim()||void 0}),this.notificationService.success("Category created"),this.newCategoryName="",this.newCategoryDescription="",await this.loadCategories(),this.updated.emit()}catch(n){this.notificationService.error(n.message||"Failed to create category")}finally{this.isCreating=!1}}confirmDelete(n){this.categoryToDelete=n,this.showDeleteConfirm=!0}async deleteCategory(){if(this.categoryToDelete)try{await this.documentsService.deleteCategory(this.categoryToDelete.id),this.notificationService.success("Category deleted"),this.showDeleteConfirm=!1,this.categoryToDelete=null,await this.loadCategories(),this.updated.emit()}catch(n){this.notificationService.error(n.message||"Failed to delete category")}}close(){this.closeDialog.emit()}getDeleteMessage(){return this.categoryToDelete?`Are you sure you want to delete the category "${this.categoryToDelete.name}"? Documents in this category will not be deleted, but will become uncategorized.`:""}static \u0275fac=function(e){return new(e||l)(S(k),S(F))};static \u0275cmp=I({type:l,selectors:[["app-manage-categories-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",updated:"updated"},decls:2,vars:4,consts:[["class","fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",3,"click",4,"ngIf"],["title","Delete Category","confirmText","Delete","cancelText","Cancel",3,"confirmed","cancelled","isOpen","message","iconType"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","p-4","backdrop-blur-sm",3,"click"],[1,"bg-zinc-900","rounded-lg","shadow-2xl","border","border-zinc-800","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","flex","flex-col",3,"click"],[1,"flex","items-center","justify-between","px-6","py-4","border-b","border-zinc-800"],[1,"text-xl","font-semibold","text-white"],["title","Close",1,"text-zinc-400","hover:text-white","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","px-6","py-4","space-y-6"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4"],[1,"text-sm","font-semibold","text-white","mb-3"],[1,"space-y-3"],[1,"block","text-xs","font-medium","text-zinc-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","e.g., Contracts, Invoices",1,"w-full","px-3","py-2","bg-zinc-900","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm",3,"ngModelChange","ngModel","disabled"],["placeholder","Brief description of this category","rows","2",1,"w-full","px-3","py-2","bg-zinc-900","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","resize-none",3,"ngModelChange","ngModel","disabled"],[1,"w-full","bg-brand","text-black","px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","text-sm","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center",3,"click","disabled"],["class","animate-spin h-4 w-4 mr-2","fill","none","viewBox","0 0 24 24",4,"ngIf"],["class","text-center py-8 text-zinc-500 text-sm",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"px-6","py-4","border-t","border-zinc-800","flex","justify-end"],[1,"bg-zinc-800","text-white","px-4","py-2","rounded","font-medium","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","py-8","text-zinc-500","text-sm"],[1,"space-y-2"],["class","bg-zinc-950 border border-zinc-800 rounded-lg p-4 hover:border-zinc-700 transition-colors",4,"ngFor","ngForOf"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4","hover:border-zinc-700","transition-colors"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","text-sm"],["class","text-zinc-400 text-xs mt-1",4,"ngIf"],["title","Delete category",1,"ml-3","text-zinc-400","hover:text-red-400","transition-colors","flex-shrink-0",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-zinc-400","text-xs","mt-1"]],template:function(e,i){e&1&&(_(0,ye,34,9,"div",0),o(1,"app-confirmation-dialog",1),u("confirmed",function(){return i.deleteCategory()})("cancelled",function(){return i.showDeleteConfirm=!1}),r()),e&2&&(m("ngIf",i.isOpen),c(),m("isOpen",i.showDeleteConfirm)("message",i.getDeleteMessage())("iconType","warning"))},dependencies:[V,P,T,j,U,N,O,B],encapsulation:2})};function we(l,n){l&1&&f(0,"span",20)}function De(l,n){if(l&1){let e=D();o(0,"div",1),u("click",function(){p(e);let t=d();return g(t.close())}),o(1,"div",2),u("click",function(t){return p(e),g(t.stopPropagation())}),o(2,"div",3)(3,"h2",4),s(4,"Upload Document"),r(),o(5,"button",5),u("click",function(){p(e);let t=d();return g(t.close())}),x(),o(6,"svg",6),f(7,"path",7),r()()(),w(),o(8,"div",8)(9,"form",9)(10,"div")(11,"label",10),s(12,"File "),o(13,"span",11),s(14,"*"),r()(),o(15,"input",12),u("change",function(t){p(e);let a=d();return g(a.onFileChange(t))}),r()(),o(16,"div")(17,"label",10),s(18,"Category"),r(),o(19,"app-select",13),v("ngModelChange",function(t){p(e);let a=d();return C(a.selectedCategory,t)||(a.selectedCategory=t),g(t)}),u("ngModelChange",function(t){p(e);let a=d();return g(a.onCategoryModelChange(t))}),r()(),o(20,"div")(21,"label",10),s(22,"Name"),r(),o(23,"input",14),v("ngModelChange",function(t){p(e);let a=d();return C(a.name,t)||(a.name=t),g(t)}),r()(),o(24,"div")(25,"label",10),s(26,"Description"),r(),o(27,"textarea",15),v("ngModelChange",function(t){p(e);let a=d();return C(a.description,t)||(a.description=t),g(t)}),r()()()(),o(28,"div",16)(29,"button",17),u("click",function(){p(e);let t=d();return g(t.close())}),s(30,"Cancel"),r(),o(31,"button",18),u("click",function(){p(e);let t=d();return g(t.submit())}),_(32,we,1,0,"span",19),s(33),r()()()()}if(l&2){let e=d();c(19),b("ngModel",e.selectedCategory),m("options",e.categoriesOptions),c(4),b("ngModel",e.name),c(4),b("ngModel",e.description),c(2),m("disabled",e.uploading),c(2),m("disabled",e.uploading||!e.file),c(),m("ngIf",e.uploading),c(),z(" ",e.uploading?"Uploading...":"Upload"," ")}}var q=class l{constructor(n,e){this.documentsService=n;this.notificationService=e;this.loadCategories()}isOpen=!1;closeDialog=new E;uploaded=new E;categories=[];categoriesOptions=[];selectedCategory=null;description="";name="";file=null;uploading=!1;async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"Uncategorized"},...this.categories.map(n=>({value:Number(n.id),label:n.name}))]}onCategoryModelChange(n){console.debug("UploadDocumentDialog: ngModelChange selectedCategory =>",n),this.selectedCategory=n!=null?Number(n):null}onFileChange(n){this.file=n.target.files?.[0]??null,this.file&&!this.name&&(this.name=this.file.name)}async submit(){if(this.file){this.uploading=!0;try{let n=`${Date.now()}_${this.file.name}`;await this.documentsService.uploadFile(this.file,n),console.debug("UploadDocumentDialog: selectedCategory (raw) =",this.selectedCategory);let e=this.selectedCategory!==null&&this.selectedCategory!==void 0?Number(this.selectedCategory):null;console.debug("UploadDocumentDialog: categoryId (coerced) =",e);let i=await this.documentsService.createDocumentMetadata({name:this.name,description:this.description,storage_path:n,storage_bucket:"documents",content_type:this.file.type,size:this.file.size,category_id:e});if(i&&i.id)try{await this.documentsService.updateDocument(i.id,{category_id:e})}catch(t){console.debug("UploadDocumentDialog: updateDocument failed",t?.message||t)}this.notificationService.success("Document uploaded"),window.dispatchEvent(new CustomEvent("documentsUpdated")),this.uploaded.emit(),this.closeDialog.emit()}finally{this.uploading=!1}}}close(){this.closeDialog.emit()}static \u0275fac=function(e){return new(e||l)(S(k),S(F))};static \u0275cmp=I({type:l,selectors:[["app-upload-document-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",uploaded:"uploaded"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-zinc-900","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-lg","w-full","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-zinc-900/50"],[1,"text-xl","font-semibold","text-white"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6"],[1,"space-y-5"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","file",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"change"],["placeholder","Uncategorized","bgColor","bg-zinc-950","name","category",3,"ngModelChange","ngModel","options"],["name","name",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],[1,"px-6","py-4","border-t","border-zinc-800","bg-zinc-900/50","flex","items-center","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-medium","text-zinc-300","hover:text-white","bg-transparent","border","border-zinc-700","rounded-md","hover:bg-zinc-800","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","text-sm","font-medium","text-black","bg-brand","rounded-md","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"]],template:function(e,i){e&1&&_(0,De,34,8,"div",0),e&2&&m("ngIf",i.isOpen)},dependencies:[V,T,j,le,U,N,ae,O,se,W],styles:[".bg-background-card[_ngcontent-%COMP%]{background-color:var(--bg-card, #0b1220)}.border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};function Se(l,n){l&1&&(o(0,"div",27),f(1,"div",28),r())}function ke(l,n){if(l&1&&(o(0,"p",48),s(1),r()),l&2){let e=d().$implicit;c(),h(e.description)}}function Me(l,n){if(l&1){let e=D();o(0,"div",29),u("click",function(){let t=p(e).$implicit,a=d();return g(a.editDocument(t))}),o(1,"div",30)(2,"div",31)(3,"div",32)(4,"h3",33),s(5),r(),o(6,"p",34),s(7),r(),_(8,ke,2,1,"p",35),r(),o(9,"div",36)(10,"button",37),u("click",function(t){let a=p(e).$implicit;return d().download(a),g(t.stopPropagation())}),x(),o(11,"svg",38),f(12,"path",39),r()(),w(),o(13,"button",40),u("click",function(t){let a=p(e).$implicit;return d().delete(a),g(t.stopPropagation())}),x(),o(14,"svg",38),f(15,"path",41),r()()()(),w(),o(16,"div",42)(17,"div",43)(18,"span",44),s(19,"Category"),r(),o(20,"span",45),s(21),r()(),o(22,"div",46)(23,"span",44),s(24,"Size"),r(),o(25,"span",47),s(26),r()(),o(27,"div",46)(28,"span",44),s(29,"Uploaded"),r(),o(30,"span",47),s(31),te(32,"date"),r()()()()()}if(l&2){let e=n.$implicit,i=d();m("title",e.description||""),c(5),h(e.name),c(2),h(e.content_type),c(),m("ngIf",e.description),c(13),h((e.document_categories==null?null:e.document_categories.name)||"Uncategorized"),c(5),h(i.formatFileSize(e.size)),c(5),h(ie(32,7,e.created_at,"short"))}}function ze(l,n){if(l&1){let e=D();o(0,"div",49)(1,"div",50)(2,"div",51)(3,"button",52),u("click",function(){p(e);let t=d();return g(t.previewUrl=null)}),s(4,"Close"),r()(),o(5,"div",53),f(6,"iframe",54),r()()()}if(l&2){let e=d();c(6),m("src",e.previewUrl,X)}}function Ee(l,n){if(l&1){let e=D();Y(0),o(1,"button",64),u("click",function(){let t=p(e).$implicit,a=d(2);return g(a.onPageChange(t))}),s(2),r(),Z()}if(l&2){let e=n.$implicit,i=d(2);c(),$("bg-brand",i.page===e)("text-black",i.page===e)("border-brand",i.page===e)("font-semibold",i.page===e)("bg-transparent",i.page!==e)("text-zinc-400",i.page!==e)("border-transparent",i.page!==e)("hover:bg-zinc-800",i.page!==e),c(),z(" ",e," ")}}function Ie(l,n){if(l&1){let e=D();o(0,"div",55)(1,"div",56)(2,"span",14),s(3," Showing "),o(4,"span",45),s(5),r(),s(6," to "),o(7,"span",45),s(8),r(),s(9," of "),o(10,"span",45),s(11),r(),s(12," documents "),r(),o(13,"span",15)(14,"span",45),s(15),r(),s(16," of "),o(17,"span",45),s(18),r()()(),o(19,"div",57)(20,"button",58),u("click",function(){p(e);let t=d();return g(t.onPageChange(t.page-1))}),x(),o(21,"svg",59),f(22,"path",60),r()(),w(),o(23,"div",57),_(24,Ee,3,17,"ng-container",61),r(),o(25,"button",62),u("click",function(){p(e);let t=d();return g(t.onPageChange(t.page+1))}),x(),o(26,"svg",59),f(27,"path",63),r()()()()}if(l&2){let e=d();c(5),h((e.page-1)*e.pageSize+1),c(3),h(e.Math.min(e.page*e.pageSize,e.total)),c(3),h(e.total),c(4),ee("",(e.page-1)*e.pageSize+1,"-",e.Math.min(e.page*e.pageSize,e.total)),c(3),h(e.total),c(2),m("disabled",e.page<=1),c(4),m("ngForOf",e.getVisiblePages()),c(),m("disabled",e.page*e.pageSize>=e.total)}}function Te(l,n){if(l&1){let e=D();o(0,"div",65)(1,"div",66)(2,"h2",67),s(3,"Edit Document"),r(),o(4,"div",68)(5,"div")(6,"label",69),s(7,"Name"),r(),o(8,"input",70),v("ngModelChange",function(t){p(e);let a=d();return C(a.editName,t)||(a.editName=t),g(t)}),r()(),o(9,"div")(10,"label",69),s(11,"Description"),r(),o(12,"textarea",71),v("ngModelChange",function(t){p(e);let a=d();return C(a.editDescription,t)||(a.editDescription=t),g(t)}),r()(),o(13,"div")(14,"label",69),s(15,"Category"),r(),o(16,"app-select",72),v("ngModelChange",function(t){p(e);let a=d();return C(a.editCategoryId,t)||(a.editCategoryId=t),g(t)}),r()()(),o(17,"div",73)(18,"button",74),u("click",function(){p(e);let t=d();return g(t.closeEditDialog())}),s(19," Cancel "),r(),o(20,"button",75),u("click",function(){p(e);let t=d();return g(t.saveDocumentChanges())}),s(21," Save Changes "),r()()()()}if(l&2){let e=d();c(8),b("ngModel",e.editName),c(4),b("ngModel",e.editDescription),c(4),b("ngModel",e.editCategoryId),m("options",e.categoriesOptions)}}var ge=class l{constructor(n,e,i){this.documentsService=n;this.notificationService=e;this.cd=i}categories=[];categoriesOptions=[];documents=[];selectedCategory=null;uploading=!1;sub=null;page=1;pageSize=12;total=0;search="";previewUrl=null;Math=Math;isConfirmDialogOpen=!1;confirmDialogTitle="";confirmDialogMessage="";pendingDeleteDoc=null;showManageCategoriesDialog=!1;showUploadDialog=!1;showEditDialog=!1;editingDocument=null;editName="";editDescription="";editCategoryId=null;ngOnInit(){this.loadCategories(),this.loadDocuments(),window.addEventListener("documentsUpdated",this.handleDocumentsUpdated)}ngOnDestroy(){this.sub?.unsubscribe(),window.removeEventListener("documentsUpdated",this.handleDocumentsUpdated)}async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"All categories"},...this.categories.map(n=>({value:Number(n.id),label:n.name}))],this.cd.detectChanges()}onCategoryChange(){this.loadDocuments()}async openUpload(){this.showUploadDialog=!0}async download(n){let{signedUrl:e}=await this.documentsService.generateSignedDownloadUrl(n.storage_path,300);window.open(e,"_blank")}async delete(n){this.pendingDeleteDoc=n,this.confirmDialogTitle="Delete Document",this.confirmDialogMessage=`Are you sure you want to delete "${n.name}"? This action cannot be undone.`,this.isConfirmDialogOpen=!0}async confirmDelete(){if(!this.pendingDeleteDoc)return;let n=this.pendingDeleteDoc;this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null;try{await this.documentsService.deleteFileFromStorage(n.storage_path),await this.documentsService.deleteDocument(n.id),this.notificationService.success("Document deleted"),await this.loadDocuments()}catch(e){this.notificationService.error(e.message||"Failed to delete document")}}cancelDelete(){this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null}async loadDocuments(){let n=await this.documentsService.listDocuments({categoryId:this.selectedCategory??void 0,page:this.page,pageSize:this.pageSize,search:this.search});this.documents=n.data,this.total=n.count,this.cd.detectChanges()}handleDocumentsUpdated=async()=>{await this.loadDocuments()};async onSearch(){this.page=1,await this.loadDocuments()}async onPageChange(n){this.page=n,await this.loadDocuments()}getVisiblePages(){let n=Math.ceil(this.total/this.pageSize),e=5,i=[];if(n<=e)for(let t=1;t<=n;t++)i.push(t);else{let t=Math.max(1,this.page-Math.floor(e/2)),a=Math.min(n,t+e-1);for(let y=t;y<=a;y++)i.push(y)}return i}formatFileSize(n){if(!n)return"0 B";let e=1024,i=["B","KB","MB","GB"],t=Math.floor(Math.log(n)/Math.log(e));return Math.round(n/Math.pow(e,t)*100)/100+" "+i[t]}openManageCategories(){this.showManageCategoriesDialog=!0}closeManageCategories(){this.showManageCategoriesDialog=!1}async onCategoriesUpdated(){await this.loadCategories(),await this.loadDocuments()}closeUploadDialog(){this.showUploadDialog=!1}async onDocumentUploaded(){await this.loadDocuments()}editDocument(n){this.editingDocument=n,this.editName=n.name,this.editDescription=n.description||"",this.editCategoryId=n.category_id,this.showEditDialog=!0}closeEditDialog(){this.showEditDialog=!1,this.editingDocument=null}async saveDocumentChanges(){if(this.editingDocument)try{await this.documentsService.updateDocument(this.editingDocument.id,{name:this.editName,description:this.editDescription,category_id:this.editCategoryId}),this.notificationService.success("Document updated successfully"),await this.loadDocuments()}catch(n){this.notificationService.error(n.message||"Failed to update document")}finally{this.closeEditDialog()}}static \u0275fac=function(e){return new(e||l)(S(k),S(F),S(ne))};static \u0275cmp=I({type:l,selectors:[["app-documents"]],decls:35,vars:17,consts:[[1,"p-4","sm:p-6","space-y-4","sm:space-y-6"],[1,"flex","flex-col","space-y-4","sm:flex-row","sm:items-center","sm:justify-between","sm:space-y-0"],[1,"text-xl","sm:text-2xl","font-semibold","text-white","tracking-tight"],[1,"flex","flex-col","space-y-2","sm:flex-row","sm:items-center","sm:space-x-3","sm:space-y-0"],[1,"relative","w-full","sm:w-auto"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-zinc-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Search documents...",1,"block","w-full","sm:w-64","pl-10","pr-3","py-2","border","border-zinc-700","rounded-md","leading-5","bg-zinc-950","text-zinc-300","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","transition-colors",3,"ngModelChange","keyup.enter","ngModel"],["placeholder","All categories","bgColor","bg-zinc-950",1,"w-full","sm:w-48",3,"ngModelChange","selectionChange","ngModel","options"],[1,"flex","space-x-2"],[1,"flex-1","sm:flex-none","bg-zinc-800","text-white","px-3","sm:px-4","py-2","rounded","font-medium","hover:bg-zinc-700","transition-colors","flex","items-center","justify-center","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","sm:mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"hidden","sm:inline"],[1,"sm:hidden"],[1,"flex-1","sm:flex-none","bg-brand","text-black","px-3","sm:px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","flex","items-center","justify-center","text-sm",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["class","flex items-center justify-center py-6",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],["class","overflow-hidden rounded-lg bg-zinc-900 shadow border border-zinc-800 hover:border-zinc-700 transition-all cursor-pointer group",3,"title","click",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",4,"ngIf"],["class","flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-0 mt-4 sm:mt-6 px-3 sm:px-4 py-3 bg-zinc-900/50 rounded-lg border border-zinc-800",4,"ngIf"],[3,"confirmed","cancelled","isOpen","title","message","confirmText","cancelText","isDangerous","iconType"],[3,"closeDialog","updated","isOpen"],[3,"closeDialog","uploaded","isOpen"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",4,"ngIf"],[1,"flex","items-center","justify-center","py-6"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"overflow-hidden","rounded-lg","bg-zinc-900","shadow","border","border-zinc-800","hover:border-zinc-700","transition-all","cursor-pointer","group",3,"click","title"],[1,"p-5"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-lg","font-semibold","text-white","truncate","group-hover:text-brand","transition-colors"],[1,"text-xs","text-zinc-500","mt-1"],["class","text-xs text-zinc-400 mt-2 line-clamp-2",4,"ngIf"],[1,"ml-4","flex","space-x-2"],["title","Download",1,"text-zinc-400","hover:text-brand","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["title","Delete",1,"text-zinc-400","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mt-4","pt-4","border-t","border-zinc-800"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mb-2"],[1,"text-zinc-500"],[1,"text-zinc-300","font-medium"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mt-2"],[1,"text-zinc-300"],[1,"text-xs","text-zinc-400","mt-2","line-clamp-2"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/70","backdrop-blur-sm"],[1,"bg-zinc-900","border","border-zinc-800","rounded-lg","p-4","max-w-4xl","w-full","shadow-2xl"],[1,"flex","justify-end","mb-2"],[1,"text-zinc-400","hover:text-white","transition-colors","px-3","py-1","rounded","hover:bg-zinc-800",3,"click"],[1,"h-[80vh]"],["frameborder","0",1,"w-full","h-full","rounded",3,"src"],[1,"flex","flex-col","sm:flex-row","items-center","justify-between","gap-3","sm:gap-0","mt-4","sm:mt-6","px-3","sm:px-4","py-3","bg-zinc-900/50","rounded-lg","border","border-zinc-800"],[1,"text-xs","sm:text-sm","text-zinc-400","text-center","sm:text-left"],[1,"flex","items-center","space-x-1"],["title","Previous Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[4,"ngFor","ngForOf"],["title","Next Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"px-2","sm:px-3","py-1","text-xs","rounded-md","border","transition-all","min-w-[28px]","sm:min-w-[32px]",3,"click"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm","p-4"],[1,"bg-zinc-900","border","border-zinc-800","rounded-lg","p-4","sm:p-6","w-full","max-w-lg","shadow-2xl","max-h-[90vh]","overflow-y-auto"],[1,"text-lg","sm:text-xl","font-semibold","text-white","mb-4"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],["type","text",1,"w-full","px-3","py-2","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-300","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","sm:text-base",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-3","py-2","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-300","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","resize-none","text-sm","sm:text-base",3,"ngModelChange","ngModel"],["placeholder","Select category","bgColor","bg-zinc-950",3,"ngModelChange","ngModel","options"],[1,"flex","flex-col-reverse","sm:flex-row","items-center","justify-end","gap-2","sm:space-x-3","sm:gap-0","mt-6"],[1,"w-full","sm:w-auto","px-4","py-2","bg-zinc-800","text-white","rounded-md","hover:bg-zinc-700","transition-colors","text-sm","sm:text-base",3,"click"],[1,"w-full","sm:w-auto","px-4","py-2","bg-brand","text-black","rounded-md","hover:bg-brand/90","transition-colors","font-medium","text-sm","sm:text-base",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Documents"),r(),o(4,"div",3)(5,"div",4)(6,"div",5),x(),o(7,"svg",6),f(8,"path",7),r()(),w(),o(9,"input",8),v("ngModelChange",function(a){return C(i.search,a)||(i.search=a),a}),u("keyup.enter",function(){return i.onSearch()}),r()(),o(10,"app-select",9),v("ngModelChange",function(a){return C(i.selectedCategory,a)||(i.selectedCategory=a),a}),u("selectionChange",function(){return i.onCategoryChange()}),r(),o(11,"div",10)(12,"button",11),u("click",function(){return i.openManageCategories()}),x(),o(13,"svg",12),f(14,"path",13),r(),w(),o(15,"span",14),s(16,"Manage Categories"),r(),o(17,"span",15),s(18,"Categories"),r()(),o(19,"button",16),u("click",function(){return i.openUpload()}),x(),o(20,"svg",12),f(21,"path",17),r(),w(),o(22,"span",14),s(23,"Upload"),r(),o(24,"span",15),s(25,"Upload"),r()()()()(),_(26,Se,2,0,"div",18),o(27,"div",19),_(28,Me,33,10,"div",20),r(),_(29,ze,7,1,"div",21)(30,Ie,28,9,"div",22),r(),o(31,"app-confirmation-dialog",23),u("confirmed",function(){return i.confirmDelete()})("cancelled",function(){return i.cancelDelete()}),r(),o(32,"app-manage-categories-dialog",24),u("closeDialog",function(){return i.closeManageCategories()})("updated",function(){return i.onCategoriesUpdated()}),r(),o(33,"app-upload-document-dialog",25),u("closeDialog",function(){return i.closeUploadDialog()})("uploaded",function(){return i.onDocumentUploaded()}),r(),_(34,Te,22,4,"div",26)),e&2&&(c(9),b("ngModel",i.search),c(),b("ngModel",i.selectedCategory),m("options",i.categoriesOptions),c(16),m("ngIf",i.uploading),c(2),m("ngForOf",i.documents),c(),m("ngIf",i.previewUrl),c(),m("ngIf",i.total>i.pageSize),c(),m("isOpen",i.isConfirmDialogOpen)("title",i.confirmDialogTitle)("message",i.confirmDialogMessage)("confirmText","Delete")("cancelText","Cancel")("isDangerous",!0)("iconType","error"),c(),m("isOpen",i.showManageCategoriesDialog),c(),m("isOpen",i.showUploadDialog),c(),m("ngIf",i.showEditDialog))},dependencies:[V,P,T,j,U,N,O,W,B,L,q,oe],styles:[".border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};export{ge as DocumentsComponent};
