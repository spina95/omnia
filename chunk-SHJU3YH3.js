import{a as u,b as F}from"./chunk-L7GRNWJG.js";import{b as E,d as V}from"./chunk-JIVE73B3.js";import"./chunk-UTADPVO5.js";import{a as N}from"./chunk-ERIPXJJI.js";import{a as A}from"./chunk-D3455EOI.js";import{a as j}from"./chunk-SWEM3K6L.js";import{r as I}from"./chunk-XYDAMM6N.js";import{Kb as S,La as x,Mb as C,Pa as f,Q as r,Rb as J,Va as d,W as m,Wa as o,X as p,Xa as l,Ya as _,db as h,dc as k,eb as v,gb as g,ha as n,kb as b,kc as M,lb as T,mb as D,ub as y,ya as c}from"./chunk-TKY7A7V6.js";import"./chunk-VOSPIT4N.js";var P=["headerActions"];function z(a,e){if(a&1){let t=h();o(0,"button",4),v("click",function(){m(t);let s=g();return p(s.goBack())}),y(1," \u2190 Back to planner "),l()}}function H(a,e){a&1&&(o(0,"div",5),_(1,"div",6),l())}function R(a,e){a&1&&(o(0,"span",11),y(1,"Saving..."),l())}function G(a,e){if(a&1){let t=h();o(0,"div",7)(1,"div",8),f(2,R,2,0,"span",9),l(),o(3,"textarea",10),v("input",function(s){m(t);let w=g();return w.freeText.set(s.target.value),p(w.onJournalChange())}),l()()}if(a&2){let t=g();c(2),d("ngIf",t.savingJournal()),c(),d("value",t.freeText())}}var O=class a{plannerService=r(F);notificationService=r(N);pageHeaderService=r(j);pageHeaderActionsService=r(A);route=r(E);router=r(V);cdr=r(J);headerActionsTemplate;currentDate=n(u.getToday());dayEntry=n(null);loading=n(!1);savingJournal=n(!1);freeText=n("");wentWell=n("");challenges=n("");takeaway=n("");tagInput=n("");currentTags=n([]);showGuidedJournal=n(!1);formattedDate=C(()=>u.parseDate(this.currentDate()).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));autoSaveTimeout=null;async ngOnInit(){this.route.paramMap.subscribe(e=>{let t=e.get("date");t&&u.isValidDateString(t)?this.currentDate.set(t):this.currentDate.set(u.getToday()),this.loadDayEntry()}),this.pageHeaderService.setHeader(this.formattedDate())}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions(),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout)}async loadDayEntry(){this.loading.set(!0);let e=await this.plannerService.getDayEntry(this.currentDate());e&&(this.dayEntry.set(e),e.journal?(this.freeText.set(e.journal.free_text||""),this.wentWell.set(e.journal.went_well||""),this.challenges.set(e.journal.challenges||""),this.takeaway.set(e.journal.takeaway||""),this.currentTags.set(e.journal.tags||[])):this.resetJournalFields()),this.loading.set(!1)}goBack(){this.router.navigate(["/planner/day",this.currentDate()])}onSearchJournals(){this.notificationService.info("Search journals clicked")}onJournalChange(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveJournal()},1e3)}async saveJournal(){if(!this.dayEntry()||this.savingJournal())return;this.savingJournal.set(!0);let e=await this.plannerService.updateJournal(this.dayEntry().id,{free_text:this.freeText()||null,went_well:this.wentWell()||null,challenges:this.challenges()||null,takeaway:this.takeaway()||null,tags:this.currentTags()});this.savingJournal.set(!1),e||this.notificationService.error("Error saving journal")}addTag(){let e=this.tagInput().trim();if(!e)return;let t=u.normalizeTag(e);this.currentTags().includes(t)?this.tagInput.set(""):(this.currentTags.update(i=>[...i,t]),this.tagInput.set(""),this.saveJournal())}removeTag(e){this.currentTags.update(t=>t.filter(i=>i!==e)),this.saveJournal()}onTagKeyDown(e){e.key==="Enter"&&(e.preventDefault(),this.addTag())}resetJournalFields(){this.freeText.set(""),this.wentWell.set(""),this.challenges.set(""),this.takeaway.set(""),this.currentTags.set([])}toggleGuidedJournal(){this.showGuidedJournal.update(e=>!e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=x({type:a,selectors:[["app-journal-full-view"]],viewQuery:function(t,i){if(t&1&&b(P,5),t&2){let s;T(s=D())&&(i.headerActionsTemplate=s.first)}},decls:5,vars:2,consts:[["headerActions",""],[1,"min-h-screen","bg-background","p-4","md:p-8"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","max-w-5xl mx-auto h-[calc(100vh-8rem)]",4,"ngIf"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-brand"],[1,"max-w-5xl","mx-auto","h-[calc(100vh-8rem)]"],[1,"mb-4","flex","items-center","justify-between"],["class","text-xs text-zinc-500",4,"ngIf"],["placeholder","Start writing...","autofocus","",1,"w-full","h-full","bg-background","border-none","rounded-lg","px-6","py-4","text-white","placeholder-zinc-600","focus:outline-none","resize-none","text-lg","leading-relaxed",3,"input","value"],[1,"text-xs","text-zinc-500"]],template:function(t,i){t&1&&(o(0,"div",1),f(1,z,2,0,"ng-template",null,0,S)(3,H,2,0,"div",2)(4,G,4,2,"div",3),l()),t&2&&(c(3),d("ngIf",i.loading()),c(),d("ngIf",!i.loading()&&i.dayEntry()))},dependencies:[M,k,I],styles:["textarea[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:3px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#52525b}textarea[_ngcontent-%COMP%]{font-family:Georgia,Times New Roman,serif;line-height:1.8;letter-spacing:.01em}textarea[_ngcontent-%COMP%]::placeholder{font-style:italic;opacity:.3}"]})};export{O as JournalFullViewComponent};
