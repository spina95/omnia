import{a as oe}from"./chunk-NC6HXIBM.js";import{a as de}from"./chunk-NALR7RZ4.js";import{a as ce}from"./chunk-5QKVE76O.js";import{a as re,b as se}from"./chunk-J6DKN3XH.js";import{a as V}from"./chunk-U6YCUQMX.js";import{a as ae}from"./chunk-2KKLJ4PY.js";import{a as le}from"./chunk-M7IKQJGJ.js";import{b as J,d as K,e as X,f as Z,g as $,h as ee,i as te,o as ne,q as ie}from"./chunk-KJ536UH3.js";import{$b as G,Ab as L,Ba as b,Bb as B,Cb as j,Db as H,Fa as E,Ja as f,Kb as T,L as z,Pa as g,Qa as a,R as c,Ra as r,S as p,Sa as S,T as w,U as D,Wb as Y,Xb as q,Z as I,Za as C,_a as h,_b as Q,ab as u,bc as U,cc as O,eb as A,fa as F,fb as N,gb as R,kb as P,nb as l,ob as W,pb as y,sb as x,ta as d,tb as _,ub as v,zb as M}from"./chunk-XVI4XSAG.js";import"./chunk-VOSPIT4N.js";function he(s,t){if(s&1&&(a(0,"div",15),l(1),r()),s&2){let e=u(2);d(),y(" ",e.errorMessage," ")}}function _e(s,t){s&1&&(a(0,"div",16),S(1,"div",17),r())}function fe(s,t){if(s&1&&(a(0,"div",15),l(1),r()),s&2){let e=u(3);d(),y(" ",e.formErrorMessage," ")}}function ye(s,t){if(s&1){let e=C();a(0,"button",48),h("click",function(){c(e);let i=u(3);return p(i.cancelEdit())}),l(1," Cancel Edit "),r()}}function xe(s,t){s&1&&S(0,"span",49)}function ve(s,t){if(s&1&&(a(0,"span",60),l(1),r()),s&2){let e=u().$implicit,n=u(3);P("background-color",n.getCategoryColor(e.expense_categories.id)+"33")("color",n.getCategoryColor(e.expense_categories.id))("border-color",n.getCategoryColor(e.expense_categories.id)+"4d"),d(),y(" ",e.expense_categories.name," ")}}function Ce(s,t){s&1&&(a(0,"span",61),l(1,"No category"),r())}function be(s,t){if(s&1&&(a(0,"span",60),l(1),r()),s&2){let e=u().$implicit,n=u(3);P("background-color",n.getPaymentTypeColor(e.payment_types.id)+"33")("color",n.getPaymentTypeColor(e.payment_types.id))("border-color",n.getPaymentTypeColor(e.payment_types.id)+"4d"),d(),y(" ",e.payment_types.name," ")}}function Se(s,t){s&1&&(a(0,"span",61),l(1,"No account"),r())}function we(s,t){if(s&1){let e=C();a(0,"tr",50)(1,"td",51),l(2),r(),a(3,"td",52),l(4),M(5,"currency"),r(),a(6,"td",52),l(7),M(8,"date"),r(),a(9,"td",52)(10,"span",53),l(11),M(12,"titlecase"),r()(),a(13,"td",54),f(14,ve,2,7,"span",55)(15,Ce,2,0,"span",56),r(),a(16,"td",54),f(17,be,2,7,"span",55)(18,Se,2,0,"span",56),r(),a(19,"td",57)(20,"button",58),h("click",function(){let i=c(e).$implicit,o=u(3);return p(o.editScheduledExpense(i))}),l(21," Edit "),r(),a(22,"button",59),h("click",function(){let i=c(e).$implicit,o=u(3);return p(o.deleteScheduledExpense(i))}),l(23," Delete "),r()()()}if(s&2){let e=t.$implicit;d(2),W(e.name),d(2),y(" ",j(5,8,e.amount,"EUR","symbol","1.2-2")," "),d(3),y(" ",B(8,13,e.date,"dd/MM/yyyy")," "),d(4),y(" ",L(12,16,e.repeat_interval)," "),d(3),g("ngIf",e.expense_categories),d(),g("ngIf",!e.expense_categories),d(2),g("ngIf",e.payment_types),d(),g("ngIf",!e.payment_types)}}function De(s,t){s&1&&(a(0,"tr")(1,"td",62)(2,"div",63),l(3,"No scheduled expenses found."),r(),a(4,"div",64),l(5,"Create your first scheduled expense above."),r()()())}function Ee(s,t){if(s&1){let e=C();a(0,"div",18)(1,"div",19)(2,"h3",20),l(3),r(),f(4,fe,2,1,"div",12),a(5,"form",21)(6,"div",22)(7,"label",23),l(8," Name "),a(9,"span",24),l(10,"*"),r()(),a(11,"input",25),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.name,i)||(o.formData.name=i),p(i)}),r()(),a(12,"div")(13,"label",23),l(14," Amount (\u20AC) "),a(15,"span",24),l(16,"*"),r()(),a(17,"div",26)(18,"span",27),l(19,"\u20AC"),r(),a(20,"input",28),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.amount,i)||(o.formData.amount=i),p(i)}),r()()(),a(21,"div")(22,"label",23),l(23," Start Date "),a(24,"span",24),l(25,"*"),r()(),a(26,"input",29),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.date,i)||(o.formData.date=i),p(i)}),r()(),a(27,"div")(28,"label",23),l(29," Frequency "),a(30,"span",24),l(31,"*"),r()(),a(32,"app-select",30),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.repeat_interval,i)||(o.formData.repeat_interval=i),p(i)}),r()(),a(33,"div")(34,"app-select",31),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.category_id,i)||(o.formData.category_id=i),p(i)}),h("selectionChange",function(){c(e);let i=u(2);return p(i.onCategoryChange())}),r()(),a(35,"div")(36,"app-select",32),v("ngModelChange",function(i){c(e);let o=u(2);return _(o.formData.paymenttype_id,i)||(o.formData.paymenttype_id=i),p(i)}),h("selectionChange",function(){c(e);let i=u(2);return p(i.onPaymentTypeChange())}),r()(),a(37,"div",33),f(38,ye,2,0,"button",34),a(39,"button",35),h("click",function(){c(e);let i=u(2);return p(i.save())}),f(40,xe,1,0,"span",36),l(41),r()()()(),a(42,"div",37)(43,"div",38)(44,"h3",39),l(45,"Existing Scheduled Expenses"),r(),a(46,"span",40),l(47),r()(),a(48,"div",41)(49,"table",42)(50,"thead",43)(51,"tr")(52,"th",44),l(53,"Name"),r(),a(54,"th",44),l(55,"Amount"),r(),a(56,"th",44),l(57,"Start Date"),r(),a(58,"th",44),l(59,"Frequency"),r(),a(60,"th",44),l(61,"Category"),r(),a(62,"th",44),l(63,"Account"),r(),a(64,"th",44),l(65,"Actions"),r()()(),a(66,"tbody",45),f(67,we,24,18,"tr",46)(68,De,6,0,"tr",47),r()()()()()}if(s&2){let e=u(2);d(3),y(" ",e.isEditing?"Edit Scheduled Expense":"Add New Scheduled Expense"," "),d(),g("ngIf",e.formErrorMessage),d(7),x("ngModel",e.formData.name),d(9),x("ngModel",e.formData.amount),d(6),x("ngModel",e.formData.date),d(6),x("ngModel",e.formData.repeat_interval),g("options",e.frequencyOptions)("placeholder","Select frequency...")("bgColor","bg-zinc-900"),d(2),g("options",e.categoriesOptions)("label","Category")("placeholder","Select a category..."),x("ngModel",e.formData.category_id),d(2),g("options",e.paymentTypesOptions)("label","Account")("placeholder","Select an account..."),x("ngModel",e.formData.paymenttype_id),d(2),g("ngIf",e.isEditing),d(),g("disabled",e.isSaving),d(),g("ngIf",e.isSaving),d(),y(" ",e.isSaving?"Saving...":e.isEditing?"Update Scheduled Expense":"Create Scheduled Expense"," "),d(6),y("",e.scheduledExpenses.length," total"),d(20),g("ngForOf",e.scheduledExpenses),d(),g("ngIf",e.scheduledExpenses.length===0)}}function Me(s,t){if(s&1){let e=C();a(0,"div",2),h("click",function(){c(e);let i=u();return p(i.close())}),a(1,"div",3),h("click",function(i){return c(e),p(i.stopPropagation())}),a(2,"div",4)(3,"h2",5),l(4,"Manage Scheduled Expenses"),r(),a(5,"div",6)(6,"button",7),h("click",function(){c(e);let i=u();return p(i.refreshScheduledExpenses())}),l(7," Refresh "),r(),a(8,"button",8),h("click",function(){c(e);let i=u();return p(i.close())}),w(),a(9,"svg",9),S(10,"path",10),r()()()(),D(),a(11,"div",11),f(12,he,2,1,"div",12)(13,_e,2,0,"div",13)(14,Ee,69,24,"div",14),r()()()}if(s&2){let e=u();d(6),g("disabled",e.isLoading),d(6),g("ngIf",e.errorMessage),d(),g("ngIf",e.isLoading),d(),g("ngIf",!e.isLoading)}}var k=class s{constructor(t,e){this.financeService=t;this.cdr=e}expense=null;isOpen=!1;closeDialog=new I;scheduledExpenseSaved=new I;formData={name:"",amount:0,date:"",category_id:null,paymenttype_id:null,repeat_interval:null};categories=[];paymentTypes=[];categoriesOptions=[];paymentTypesOptions=[];frequencyOptions=[];isLoading=!1;isSaving=!1;errorMessage=null;formErrorMessage=null;isEditing=!1;scheduledExpenses=[];isConfirmDialogOpen=!1;confirmDialogTitle="";confirmDialogMessage="";pendingDeleteExpense=null;ngOnInit(){this.loadMetadata(),this.frequencyOptions=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]}ngOnChanges(){this.isOpen&&(this.refreshScheduledExpenses(),this.expense?this.formData={name:this.expense.name||"",amount:this.expense.amount||0,date:this.expense.date?new Date(this.expense.date).toISOString().split("T")[0]:"",category_id:this.expense.expense_categories?.id||null,paymenttype_id:this.expense.payment_types?.id||null,repeat_interval:this.expense.repeat_interval||null}:this.formData={name:"",amount:0,date:new Date().toISOString().split("T")[0],category_id:null,paymenttype_id:null,repeat_interval:"monthly"})}async loadMetadata(){this.isLoading=!0;try{let[t,e]=await Promise.all([this.financeService.getCategories(),this.financeService.getPaymentTypes()]);this.categories=t||[],this.paymentTypes=e||[],this.categoriesOptions=this.categories.map(n=>({value:n.id,label:n.name})),this.paymentTypesOptions=this.paymentTypes.map(n=>({value:n.id,label:n.name}))}catch(t){console.error("Failed to load metadata",t),this.errorMessage="Failed to load categories and payment types"}finally{this.isLoading=!1}}close(){this.closeDialog.emit(),this.resetForm()}async save(){if(this.validateForm()){this.isSaving=!0,this.errorMessage=null;try{if(this.expense){let t=await this.financeService.updateScheduledExpense(this.expense.id,{name:this.formData.name,amount:parseFloat(this.formData.amount),date:this.formData.date,category_id:this.formData.category_id,paymenttype_id:this.formData.paymenttype_id,repeat_interval:this.formData.repeat_interval});this.scheduledExpenseSaved.emit(t)}else{let t=await this.financeService.createScheduledExpense({name:this.formData.name,amount:parseFloat(this.formData.amount),date:this.formData.date,category_id:this.formData.category_id,paymenttype_id:this.formData.paymenttype_id,repeat_interval:this.formData.repeat_interval});this.scheduledExpenseSaved.emit(t)}this.close()}catch(t){console.error("Failed to save scheduled expense",t),this.errorMessage=t.message||"Failed to save scheduled expense"}finally{this.isSaving=!1}}}validateForm(){return!this.formData.name||this.formData.name.trim()===""?(this.errorMessage="Name is required",!1):!this.formData.amount||this.formData.amount<=0?(this.errorMessage="Amount must be greater than 0",!1):this.formData.date?this.formData.repeat_interval?!0:(this.errorMessage="Frequency is required",!1):(this.errorMessage="Start date is required",!1)}resetForm(){this.formData={name:"",amount:0,date:"",category_id:null,paymenttype_id:null,repeat_interval:null},this.errorMessage=null}getCategoryColor(t){return t&&this.categories.find(n=>n.id===t)?.color||"#71717a"}getPaymentTypeColor(t){return t&&this.paymentTypes.find(n=>n.id===t)?.color||"#71717a"}getCategoryName(t){return t&&this.categories.find(n=>n.id===t)?.name||""}getPaymentTypeName(t){return t&&this.paymentTypes.find(n=>n.id===t)?.name||""}onCategoryChange(){console.log("Category changed:",this.formData.category_id)}onPaymentTypeChange(){console.log("Payment type changed:",this.formData.paymenttype_id)}async refreshScheduledExpenses(){this.isLoading=!0,this.errorMessage=null;try{this.scheduledExpenses=await this.financeService.getScheduledExpenses()}catch(t){console.error("Failed to load scheduled expenses",t),this.errorMessage="Failed to load scheduled expenses"}finally{this.isLoading=!1,this.cdr.detectChanges()}}editScheduledExpense(t){this.isEditing=!0,this.formData={name:t.name||"",amount:t.amount||0,date:t.date?new Date(t.date).toISOString().split("T")[0]:"",category_id:t.expense_categories?.id||null,paymenttype_id:t.payment_types?.id||null,repeat_interval:t.repeat_interval||null}}cancelEdit(){this.isEditing=!1,this.formData={name:"",amount:0,date:new Date().toISOString().split("T")[0],category_id:null,paymenttype_id:null,repeat_interval:"monthly"}}async deleteScheduledExpense(t){this.pendingDeleteExpense=t,this.confirmDialogTitle="Delete Scheduled Expense",this.confirmDialogMessage=`Are you sure you want to delete "${t.name}"?`,this.isConfirmDialogOpen=!0}async confirmDelete(){if(!this.pendingDeleteExpense)return;let t=this.pendingDeleteExpense;this.isConfirmDialogOpen=!1,this.pendingDeleteExpense=null;try{await this.financeService.deleteScheduledExpense(t.id),this.scheduledExpenses=this.scheduledExpenses.filter(e=>e.id!==t.id)}catch(e){console.error("Failed to delete scheduled expense",e),this.errorMessage="Failed to delete scheduled expense"}}cancelDelete(){this.isConfirmDialogOpen=!1,this.pendingDeleteExpense=null}static \u0275fac=function(e){return new(e||s)(b(V),b(T))};static \u0275cmp=E({type:s,selectors:[["app-scheduled-expense-dialog"]],inputs:{expense:"expense",isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",scheduledExpenseSaved:"scheduledExpenseSaved"},features:[F],decls:2,vars:7,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[3,"confirmed","cancelled","isOpen","title","message","confirmText","cancelText","isDangerous"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-zinc-900","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-6xl","w-full","max-h-[90vh]","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-zinc-900/50"],[1,"text-xl","font-semibold","text-white"],[1,"flex","items-center","gap-3"],[1,"px-3","py-1.5","text-sm","font-medium","text-zinc-300","hover:text-white","bg-zinc-800","rounded-md","hover:bg-zinc-700","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6","overflow-y-auto","max-h-[calc(90vh-140px)]"],["class","mb-4 p-3 bg-red-900/20 border border-red-900 rounded-md text-red-400 text-sm",4,"ngIf"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"mb-4","p-3","bg-red-900/20","border","border-red-900","rounded-md","text-red-400","text-sm"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","h-8","w-8","border-2","border-brand","border-t-transparent","rounded-full"],[1,"space-y-6"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"md:col-span-2"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","text","name","name","placeholder","e.g., Monthly Rent",1,"w-full","px-4","py-2.5","bg-zinc-900","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],[1,"relative"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-zinc-400"],["type","number","name","amount","step","0.01","min","0","placeholder","0.00",1,"w-full","pl-10","pr-4","py-2.5","bg-zinc-900","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],["type","date","name","date",1,"w-full","px-2","py-1.5","md:px-3","md:py-2","bg-zinc-900","border","border-zinc-700","rounded-md","text-zinc-200","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors","text-xs","md:text-sm",3,"ngModelChange","ngModel"],["name","repeat_interval",3,"ngModelChange","ngModel","options","placeholder","bgColor"],["name","category_id","bgColor","bg-zinc-900",3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],["name","paymenttype_id","bgColor","bg-zinc-900",3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],[1,"md:col-span-3","flex","items-center","justify-end","gap-3","pt-2"],["type","button","class","px-4 py-2 text-sm font-medium text-zinc-300 hover:text-white bg-transparent border border-zinc-700 rounded-md hover:bg-zinc-800 transition-colors",3,"click",4,"ngIf"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-black","bg-brand","rounded-md","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","overflow-hidden"],[1,"px-4","py-3","border-b","border-zinc-800","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-white"],[1,"text-sm","text-zinc-400"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-zinc-900"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-zinc-400","uppercase","tracking-wider"],[1,"divide-y","divide-zinc-800"],["class","hover:bg-zinc-900/50 transition-colors",4,"ngFor","ngForOf"],[4,"ngIf"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-zinc-300","hover:text-white","bg-transparent","border","border-zinc-700","rounded-md","hover:bg-zinc-800","transition-colors",3,"click"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"],[1,"hover:bg-zinc-900/50","transition-colors"],[1,"px-4","py-3","whitespace-nowrap","text-sm","font-medium","text-white"],[1,"px-4","py-3","whitespace-nowrap","text-sm","text-zinc-300"],[1,"px-2","py-1","bg-zinc-800","text-zinc-200","rounded-full","text-xs","font-medium"],[1,"px-4","py-3","whitespace-nowrap","text-sm"],["class","px-2.5 py-1 rounded-full border text-xs font-medium inline-flex items-center",3,"background-color","color","border-color",4,"ngIf"],["class","text-zinc-500 text-xs",4,"ngIf"],[1,"px-4","py-3","whitespace-nowrap","text-sm","font-medium","space-x-2"],[1,"text-blue-400","hover:text-blue-300","transition-colors",3,"click"],[1,"text-red-400","hover:text-red-300","transition-colors",3,"click"],[1,"px-2.5","py-1","rounded-full","border","text-xs","font-medium","inline-flex","items-center"],[1,"text-zinc-500","text-xs"],["colspan","7",1,"px-4","py-8","text-center","text-zinc-400"],[1,"text-sm"],[1,"text-xs","text-zinc-500","mt-1"]],template:function(e,n){e&1&&(f(0,Me,15,4,"div",0),a(1,"app-confirmation-dialog",1),h("confirmed",function(){return n.confirmDelete()})("cancelled",function(){return n.cancelDelete()}),r()),e&2&&(g("ngIf",n.isOpen),d(),g("isOpen",n.isConfirmDialogOpen)("title",n.confirmDialogTitle)("message",n.confirmDialogMessage)("confirmText","Delete")("cancelText","Cancel")("isDangerous",!0))},dependencies:[O,Y,q,ie,ee,J,te,K,X,ne,$,Z,ae,ce,Q,U,G],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .2s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar{width:8px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-track{background:#18181b;border-radius:4px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:4px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-thumb:hover{background:#52525b}"]})};var Te=["headerActions"];function Oe(s,t){if(s&1){let e=C();a(0,"button",4),h("click",function(){c(e);let i=u();return p(i.onManageScheduledExpenses())}),w(),a(1,"svg",5),S(2,"path",6),r(),D(),a(3,"span",7),l(4,"Scheduled Expenses"),r()(),a(5,"button",8),h("click",function(){c(e);let i=u();return p(i.onAddOutcome())}),w(),a(6,"svg",5),S(7,"path",9),r(),l(8," New Outcome "),r()}}var pe=class s{constructor(t,e,n){this.financeService=t;this.cdr=e;this.notificationService=n;let i=new Date().getFullYear();for(let o=0;o<5;o++)this.years.push(i-o)}headerActionsTemplate;pageHeaderService=z(le);pageHeaderActionsService=z(se);rowData=[];isLoading=!1;errorMessage=null;currentPage=1;pageSize=20;totalRecords=0;get totalAmount(){return this.rowData.reduce((t,e)=>t+(e.amount||0),0)}currentSort="date";currentOrder="desc";searchQuery="";selectedMonth=null;selectedYear=new Date().getFullYear();selectedCategory=null;selectedPaymentType=null;isDialogOpen=!1;selectedExpense=null;isScheduledDialogOpen=!1;categories=[];paymentTypes=[];months=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}];years=[];columnDefs=[{field:"id",headerName:"ID",width:80,hide:!0},{field:"name",headerName:"Description",flex:1.5,minWidth:200,cellStyle:{fontWeight:"500",display:"flex",alignItems:"center"}},{field:"amount",headerName:"Amount",width:140,type:"rightAligned",valueFormatter:t=>t.value?new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(t.value):"-",cellStyle:{fontWeight:"600",color:"#fff",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"flex-end"}},{field:"date",headerName:"Date",width:130,valueFormatter:t=>t.value?new Date(t.value).toLocaleDateString():"-",cellStyle:{color:"#a1a1aa",display:"flex",alignItems:"center"}},{headerName:"Category",width:150,valueGetter:t=>t.data.expense_categories,cellRenderer:t=>{let e=t.value;if(!e)return"-";let n=e.color||"#71717a";return`
          <span style="background-color: ${n+"33"}; color: ${n}; border-color: ${n}4d;" 
                class="px-2.5 py-0.5 rounded-full border text-xs font-medium inline-flex items-center">
            ${e.name}
          </span>`},cellStyle:{display:"flex",alignItems:"center"}},{headerName:"Account",width:160,valueGetter:t=>t.data.payment_types,cellRenderer:t=>{let e=t.value;if(!e)return"-";let n=e.color||"#71717a";return`
          <span style="background-color: ${n+"33"}; color: ${n}; border-color: ${n}4d;" 
                class="px-2.5 py-0.5 rounded-full border text-xs font-medium inline-flex items-center">
            ${e.name}
          </span>`},cellStyle:{display:"flex",alignItems:"center"}},{headerName:"",width:60,pinned:"right",cellRenderer:t=>`
          <button 
            class="delete-btn p-1.5 rounded hover:bg-red-900/20 text-zinc-500 hover:text-red-400 transition-colors"
            data-action="delete"
            data-id="${t.data.id}"
            title="Delete expense">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>`,cellStyle:{display:"flex",alignItems:"center",justifyContent:"center"},suppressHeaderMenuButton:!0,sortable:!1}];defaultColDef={sortable:!0,filter:!1,suppressHeaderMenuButton:!0,resizable:!0,cellStyle:{display:"flex",alignItems:"center"}};ngOnInit(){this.pageHeaderService.setHeader("Outcomes"),this.loadMetadata()}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions()}async loadMetadata(){try{let[t,e]=await Promise.all([this.financeService.getCategories(),this.financeService.getPaymentTypes()]);this.categories=t||[],this.paymentTypes=e||[]}catch(t){console.error("Failed to load metadata",t)}}onGridReady(){this.loadData()}onSortChanged(t){this.currentSort=t.field,this.currentOrder=t.order,this.currentPage=1,this.loadData()}onPageChanged(t){this.currentPage=t,this.loadData()}onFilterChanged(){this.currentPage=1,this.loadData()}onRowClicked(t){this.selectedExpense=t,this.isDialogOpen=!0}onCellClicked(t){let n=t.event?.target?.closest('[data-action="delete"]');if(n){let i=n.getAttribute("data-id");i&&this.deleteExpense(parseInt(i));return}this.onRowClicked(t.data)}async deleteExpense(t){let n=this.rowData.find(o=>o.id===t)?.name||"this expense";if(confirm(`Are you sure you want to delete "${n}"? This action cannot be undone.`))try{await this.financeService.deleteExpense(t),this.rowData=this.rowData.filter(o=>o.id!==t),this.totalRecords--,this.notificationService.success("Expense deleted",3e3,"Expense deleted",`Deleted "${n}"`),this.cdr.detectChanges()}catch(o){console.error("Failed to delete expense",o),alert("Failed to delete expense: "+(o.message||"Unknown error"))}}onAddOutcome(){this.selectedExpense=null,this.isDialogOpen=!0}onDialogClose(){this.isDialogOpen=!1,this.selectedExpense=null}onManageScheduledExpenses(){this.isScheduledDialogOpen=!0,this.cdr.detectChanges()}onScheduledDialogClose(){this.isScheduledDialogOpen=!1}onScheduledExpenseSaved(t){this.loadData()}onExpenseSaved(t){if(this.selectedExpense){let e=this.rowData.findIndex(n=>n.id===t.id);e!==-1&&(this.rowData[e]=t,this.rowData=[...this.rowData],this.notificationService.success("Expense updated",3e3,"Expense updated",`Updated "${t.name}" (${t.amount} \u20AC)`))}else this.loadData(),this.notificationService.success("Expense created",3e3,"Expense created",`Created "${t.name}" (${t.amount} \u20AC)`)}async loadData(){this.isLoading=!0,this.errorMessage=null;try{let{data:t,count:e}=await this.financeService.getExpenses({page:this.currentPage,pageSize:this.pageSize,sort:this.currentSort,order:this.currentOrder,month:this.selectedMonth||void 0,year:this.selectedYear||void 0,categoryId:this.selectedCategory||void 0,paymentTypeId:this.selectedPaymentType||void 0,search:this.searchQuery});t&&(this.rowData=t,e!==null&&(this.totalRecords=e))}catch(t){console.error("Error loading expenses",t),this.errorMessage=t.message||"Failed to load expenses"}finally{this.isLoading=!1,this.cdr.detectChanges()}}static \u0275fac=function(e){return new(e||s)(b(V),b(T),b(re))};static \u0275cmp=E({type:s,selectors:[["app-outcomes"]],viewQuery:function(e,n){if(e&1&&A(Te,5),e&2){let i;N(i=R())&&(n.headerActionsTemplate=i.first)}},decls:5,vars:22,consts:[["headerActions",""],["emptyStateMessage","No outcomes found matching your criteria.",3,"searchValueChange","selectedMonthChange","selectedYearChange","selectedCategoryChange","selectedPaymentTypeChange","gridReady","sortChanged","pageChanged","filterChanged","cellClicked","columnDefs","defaultColDef","rowData","loading","error","currentPage","pageSize","totalRecords","totalAmount","searchValue","selectedMonth","selectedYear","selectedCategory","selectedPaymentType","categories","paymentTypes","months","years","showFilters"],[3,"closeDialog","expenseSaved","expense","isOpen"],[3,"closeDialog","scheduledExpenseSaved","isOpen"],[1,"flex","items-center","gap-2","px-4","py-2.5","h-10","text-sm","bg-zinc-800","text-white","rounded-lg","hover:bg-zinc-700","transition-colors","border","border-zinc-700",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"hidden","sm:inline"],[1,"flex","items-center","gap-2","px-4","py-2.5","h-10","text-sm","bg-brand","text-black","font-medium","rounded-lg","hover:bg-brand/90","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"]],template:function(e,n){if(e&1){let i=C();f(0,Oe,9,0,"ng-template",null,0,H),a(2,"app-data-table",1),v("searchValueChange",function(m){return c(i),_(n.searchQuery,m)||(n.searchQuery=m),p(m)})("selectedMonthChange",function(m){return c(i),_(n.selectedMonth,m)||(n.selectedMonth=m),p(m)})("selectedYearChange",function(m){return c(i),_(n.selectedYear,m)||(n.selectedYear=m),p(m)})("selectedCategoryChange",function(m){return c(i),_(n.selectedCategory,m)||(n.selectedCategory=m),p(m)})("selectedPaymentTypeChange",function(m){return c(i),_(n.selectedPaymentType,m)||(n.selectedPaymentType=m),p(m)}),h("gridReady",function(){return c(i),p(n.onGridReady())})("sortChanged",function(m){return c(i),p(n.onSortChanged(m))})("pageChanged",function(m){return c(i),p(n.onPageChanged(m))})("filterChanged",function(){return c(i),p(n.onFilterChanged())})("cellClicked",function(m){return c(i),p(n.onCellClicked(m))}),r(),a(3,"app-expense-dialog",2),h("closeDialog",function(){return c(i),p(n.onDialogClose())})("expenseSaved",function(m){return c(i),p(n.onExpenseSaved(m))}),r(),a(4,"app-scheduled-expense-dialog",3),h("closeDialog",function(){return c(i),p(n.onScheduledDialogClose())})("scheduledExpenseSaved",function(m){return c(i),p(n.onScheduledExpenseSaved(m))}),r()}e&2&&(d(2),g("columnDefs",n.columnDefs)("defaultColDef",n.defaultColDef)("rowData",n.rowData)("loading",n.isLoading)("error",n.errorMessage)("currentPage",n.currentPage)("pageSize",n.pageSize)("totalRecords",n.totalRecords)("totalAmount",n.totalAmount),x("searchValue",n.searchQuery)("selectedMonth",n.selectedMonth)("selectedYear",n.selectedYear)("selectedCategory",n.selectedCategory)("selectedPaymentType",n.selectedPaymentType),g("categories",n.categories)("paymentTypes",n.paymentTypes)("months",n.months)("years",n.years)("showFilters",!0),d(),g("expense",n.selectedExpense)("isOpen",n.isDialogOpen),d(),g("isOpen",n.isScheduledDialogOpen))},dependencies:[O,de,oe,k],encapsulation:2})};export{pe as OutcomesComponent};
