import{a as A}from"./chunk-ZB4FMHFC.js";import{a as F,b as ge}from"./chunk-425RWJ2X.js";import{a as B}from"./chunk-SOJVCRDF.js";import{a as ue}from"./chunk-SWEM3K6L.js";import{b as U,d as N,e as de,f as me,g as O,h as pe,r as j}from"./chunk-XYDAMM6N.js";import{Ab as C,Bb as w,Gb as oe,Ha as D,Ib as re,Kb as ae,L as X,La as I,Mb as P,P as Y,Pa as f,Q as R,Rb as se,Va as u,W as c,Wa as o,X as d,Xa as r,Y as b,Ya as _,Z as y,ca as V,cc as W,db as x,dc as T,eb as g,gb as m,hc as le,kb as $,kc as E,lb as ee,mb as te,qc as ce,rb as ie,ub as p,va as Z,vb as S,wb as z,ya as l,yb as ne,zb as v}from"./chunk-TKY7A7V6.js";import{a as q,b as G}from"./chunk-VOSPIT4N.js";var k=class s{constructor(i){this.supabaseService=i}bucket="documents";async getCurrentUserId(){let{data:i}=await this.supabaseService.client.auth.getUser();return i?.user?.id??null}async listCategories(){let i=await this.getCurrentUserId(),e=this.supabaseService.client.from("document_categories").select("*").order("created_at",{ascending:!1});i&&(e=e.eq("user_id",i));let{data:n,error:t}=await e;if(t)throw t;return n??[]}async createCategory(i){let e=await this.getCurrentUserId(),n=G(q({},i),{user_id:e}),{data:t,error:a}=await this.supabaseService.client.from("document_categories").insert([n]).select().single();if(a)throw a;return t}async deleteCategory(i){let e=await this.getCurrentUserId(),n=this.supabaseService.client.from("document_categories").delete().eq("id",i);e&&(n=n.eq("user_id",e));let{error:t}=await n;if(t)throw t}async createDocumentMetadata(i){let e=await this.getCurrentUserId(),n=G(q({},i),{user_id:e});n.category_id!==null&&n.category_id!==void 0?n.category_id=Number(n.category_id):n.category_id=null,console.debug("DocumentsService.createDocumentMetadata: toInsert =",n);let{data:t,error:a}=await this.supabaseService.client.from("documents").insert([n]).select().single();if(a)throw a;return t}async listDocuments(i={}){let e=await this.getCurrentUserId(),n=i.page??1,t=i.pageSize??12,a=i.search??"",h=(n-1)*t,ve=h+t-1,M=this.supabaseService.client.from("documents").select("*, document_categories(id, name)",{count:"exact"}).order("created_at",{ascending:!1});i.categoryId&&(M=M.eq("category_id",Number(i.categoryId))),e&&(M=M.eq("user_id",e)),a&&(M=M.ilike("name",`%${a}%`));let{data:Ce,error:J,count:we}=await M.range(h,ve);if(J)throw J;return{data:Ce??[],count:we??0}}async uploadFile(i,e){let{data:n,error:t}=await this.supabaseService.client.storage.from(this.bucket).upload(e,i,{cacheControl:"3600",upsert:!1});if(t)throw t;return n}async generateSignedDownloadUrl(i,e=300){let{data:n,error:t}=await this.supabaseService.client.storage.from(this.bucket).createSignedUrl(i,e);if(t)throw t;return n}async deleteFileFromStorage(i){let{data:e,error:n}=await this.supabaseService.client.storage.from(this.bucket).remove([i]);if(n)throw n;return e}async deleteDocument(i){let e=await this.getCurrentUserId(),n=this.supabaseService.client.from("documents").delete().eq("id",i);e&&(n=n.eq("user_id",e));let{data:t,error:a}=await n;if(a)throw a;return t}async updateDocument(i,e){let n=await this.getCurrentUserId(),t=this.supabaseService.client.from("documents").update(e).eq("id",i);n&&(t=t.eq("user_id",n));let{data:a,error:h}=await t.select().single();if(h)throw h;return a}static \u0275fac=function(e){return new(e||s)(Y(ce))};static \u0275prov=X({token:s,factory:s.\u0275fac,providedIn:"root"})};function ye(s,i){s&1&&(b(),o(0,"svg",23),_(1,"circle",24)(2,"path",25),r())}function De(s,i){s&1&&(o(0,"div",26),p(1," No categories yet. Create your first category above. "),r())}function Se(s,i){if(s&1&&(o(0,"p",37),p(1),r()),s&2){let e=m().$implicit;l(),z(" ",e.description," ")}}function ke(s,i){if(s&1){let e=x();o(0,"div",29)(1,"div",30)(2,"div",31)(3,"h5",32),p(4),r(),f(5,Se,2,1,"p",33),r(),o(6,"button",34),g("click",function(){let t=c(e).$implicit,a=m(3);return d(a.confirmDelete(t))}),b(),o(7,"svg",35),_(8,"path",36),r()()()()}if(s&2){let e=i.$implicit;l(4),S(e.name),l(),u("ngIf",e.description)}}function Me(s,i){if(s&1&&(o(0,"div",27),f(1,ke,9,2,"div",28),r()),s&2){let e=m(2);l(),u("ngForOf",e.categories)}}function ze(s,i){if(s&1){let e=x();o(0,"div",2),g("click",function(){c(e);let t=m();return d(t.close())}),o(1,"div",3),g("click",function(t){return c(e),d(t.stopPropagation())}),o(2,"div",4)(3,"h3",5),p(4,"Manage Categories"),r(),o(5,"button",6),g("click",function(){c(e);let t=m();return d(t.close())}),b(),o(6,"svg",7),_(7,"path",8),r()()(),y(),o(8,"div",9)(9,"div",10)(10,"h4",11),p(11,"Create New Category"),r(),o(12,"div",12)(13,"div")(14,"label",13),p(15," Category Name "),o(16,"span",14),p(17,"*"),r()(),o(18,"input",15),w("ngModelChange",function(t){c(e);let a=m();return C(a.newCategoryName,t)||(a.newCategoryName=t),d(t)}),r()(),o(19,"div")(20,"label",13),p(21,"Description (Optional)"),r(),o(22,"textarea",16),w("ngModelChange",function(t){c(e);let a=m();return C(a.newCategoryDescription,t)||(a.newCategoryDescription=t),d(t)}),r()(),o(23,"button",17),g("click",function(){c(e);let t=m();return d(t.createCategory())}),f(24,ye,3,0,"svg",18),p(25),r()()(),o(26,"div")(27,"h4",11),p(28,"Existing Categories"),r(),f(29,De,2,0,"div",19)(30,Me,2,1,"div",20),r()(),o(31,"div",21)(32,"button",22),g("click",function(){c(e);let t=m();return d(t.close())}),p(33," Close "),r()()()()}if(s&2){let e=m();l(18),v("ngModel",e.newCategoryName),u("disabled",e.isCreating),l(4),v("ngModel",e.newCategoryDescription),u("disabled",e.isCreating),l(),u("disabled",e.isCreating||!e.newCategoryName.trim()),l(),u("ngIf",e.isCreating),l(),z(" ",e.isCreating?"Creating...":"Create Category"," "),l(4),u("ngIf",e.categories.length===0),l(),u("ngIf",e.categories.length>0)}}var L=class s{constructor(i,e){this.documentsService=i;this.notificationService=e}isOpen=!1;closeDialog=new V;updated=new V;categories=[];newCategoryName="";newCategoryDescription="";isCreating=!1;showDeleteConfirm=!1;categoryToDelete=null;ngOnInit(){this.loadCategories()}async loadCategories(){try{this.categories=await this.documentsService.listCategories()}catch(i){this.notificationService.error(i.message||"Failed to load categories")}}async createCategory(){if(!this.newCategoryName.trim()){this.notificationService.error("Category name is required");return}this.isCreating=!0;try{await this.documentsService.createCategory({name:this.newCategoryName.trim(),description:this.newCategoryDescription.trim()||void 0}),this.notificationService.success("Category created"),this.newCategoryName="",this.newCategoryDescription="",await this.loadCategories(),this.updated.emit()}catch(i){this.notificationService.error(i.message||"Failed to create category")}finally{this.isCreating=!1}}confirmDelete(i){this.categoryToDelete=i,this.showDeleteConfirm=!0}async deleteCategory(){if(this.categoryToDelete)try{await this.documentsService.deleteCategory(this.categoryToDelete.id),this.notificationService.success("Category deleted"),this.showDeleteConfirm=!1,this.categoryToDelete=null,await this.loadCategories(),this.updated.emit()}catch(i){this.notificationService.error(i.message||"Failed to delete category")}}close(){this.closeDialog.emit()}getDeleteMessage(){return this.categoryToDelete?`Are you sure you want to delete the category "${this.categoryToDelete.name}"? Documents in this category will not be deleted, but will become uncategorized.`:""}static \u0275fac=function(e){return new(e||s)(D(k),D(F))};static \u0275cmp=I({type:s,selectors:[["app-manage-categories-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",updated:"updated"},decls:2,vars:4,consts:[["class","fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",3,"click",4,"ngIf"],["title","Delete Category","confirmText","Delete","cancelText","Cancel",3,"confirmed","cancelled","isOpen","message","iconType"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","p-4","backdrop-blur-sm",3,"click"],[1,"bg-background-card","rounded-lg","shadow-2xl","border","border-zinc-800","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","flex","flex-col",3,"click"],[1,"flex","items-center","justify-between","px-6","py-4","border-b","border-zinc-800"],[1,"text-xl","font-semibold","text-white"],["title","Close",1,"text-zinc-400","hover:text-white","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","px-6","py-4","space-y-6"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4"],[1,"text-sm","font-semibold","text-white","mb-3"],[1,"space-y-3"],[1,"block","text-xs","font-medium","text-zinc-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","e.g., Contracts, Invoices",1,"w-full","px-3","py-2","bg-background-card","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm",3,"ngModelChange","ngModel","disabled"],["placeholder","Brief description of this category","rows","2",1,"w-full","px-3","py-2","bg-background-card","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","resize-none",3,"ngModelChange","ngModel","disabled"],[1,"w-full","bg-brand","text-black","px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","text-sm","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center",3,"click","disabled"],["class","animate-spin h-4 w-4 mr-2","fill","none","viewBox","0 0 24 24",4,"ngIf"],["class","text-center py-8 text-zinc-500 text-sm",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"px-6","py-4","border-t","border-zinc-800","flex","justify-end"],[1,"bg-zinc-800","text-white","px-4","py-2","rounded","font-medium","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","py-8","text-zinc-500","text-sm"],[1,"space-y-2"],["class","bg-zinc-950 border border-zinc-800 rounded-lg p-4 hover:border-zinc-700 transition-colors",4,"ngFor","ngForOf"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4","hover:border-zinc-700","transition-colors"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","text-sm"],["class","text-zinc-400 text-xs mt-1",4,"ngIf"],["title","Delete category",1,"ml-3","text-zinc-400","hover:text-red-400","transition-colors","flex-shrink-0",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-zinc-400","text-xs","mt-1"]],template:function(e,n){e&1&&(f(0,ze,34,9,"div",0),o(1,"app-confirmation-dialog",1),g("confirmed",function(){return n.deleteCategory()})("cancelled",function(){return n.showDeleteConfirm=!1}),r()),e&2&&(u("ngIf",n.isOpen),l(),u("isOpen",n.showDeleteConfirm)("message",n.getDeleteMessage())("iconType","warning"))},dependencies:[E,W,T,j,U,N,O,A],encapsulation:2})};function Ve(s,i){s&1&&_(0,"span",20)}function Ie(s,i){if(s&1){let e=x();o(0,"div",1),g("click",function(){c(e);let t=m();return d(t.close())}),o(1,"div",2),g("click",function(t){return c(e),d(t.stopPropagation())}),o(2,"div",3)(3,"h2",4),p(4,"Upload Document"),r(),o(5,"button",5),g("click",function(){c(e);let t=m();return d(t.close())}),b(),o(6,"svg",6),_(7,"path",7),r()()(),y(),o(8,"div",8)(9,"form",9)(10,"div")(11,"label",10),p(12,"File "),o(13,"span",11),p(14,"*"),r()(),o(15,"input",12),g("change",function(t){c(e);let a=m();return d(a.onFileChange(t))}),r()(),o(16,"div")(17,"label",10),p(18,"Category"),r(),o(19,"app-select",13),w("ngModelChange",function(t){c(e);let a=m();return C(a.selectedCategory,t)||(a.selectedCategory=t),d(t)}),g("ngModelChange",function(t){c(e);let a=m();return d(a.onCategoryModelChange(t))}),r()(),o(20,"div")(21,"label",10),p(22,"Name"),r(),o(23,"input",14),w("ngModelChange",function(t){c(e);let a=m();return C(a.name,t)||(a.name=t),d(t)}),r()(),o(24,"div")(25,"label",10),p(26,"Description"),r(),o(27,"textarea",15),w("ngModelChange",function(t){c(e);let a=m();return C(a.description,t)||(a.description=t),d(t)}),r()()()(),o(28,"div",16)(29,"button",17),g("click",function(){c(e);let t=m();return d(t.close())}),p(30,"Cancel"),r(),o(31,"button",18),g("click",function(){c(e);let t=m();return d(t.submit())}),f(32,Ve,1,0,"span",19),p(33),r()()()()}if(s&2){let e=m();l(19),v("ngModel",e.selectedCategory),u("options",e.categoriesOptions),l(4),v("ngModel",e.name),l(4),v("ngModel",e.description),l(2),u("disabled",e.uploading),l(2),u("disabled",e.uploading||!e.file),l(),u("ngIf",e.uploading),l(),z(" ",e.uploading?"Uploading...":"Upload"," ")}}var H=class s{constructor(i,e){this.documentsService=i;this.notificationService=e;this.loadCategories()}isOpen=!1;closeDialog=new V;uploaded=new V;categories=[];categoriesOptions=[];selectedCategory=null;description="";name="";file=null;uploading=!1;async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"Uncategorized"},...this.categories.map(i=>({value:Number(i.id),label:i.name}))]}onCategoryModelChange(i){console.debug("UploadDocumentDialog: ngModelChange selectedCategory =>",i),this.selectedCategory=i!=null?Number(i):null}onFileChange(i){this.file=i.target.files?.[0]??null,this.file&&!this.name&&(this.name=this.file.name)}async submit(){if(this.file){this.uploading=!0;try{let i=`${Date.now()}_${this.file.name}`;await this.documentsService.uploadFile(this.file,i),console.debug("UploadDocumentDialog: selectedCategory (raw) =",this.selectedCategory);let e=this.selectedCategory!==null&&this.selectedCategory!==void 0?Number(this.selectedCategory):null;console.debug("UploadDocumentDialog: categoryId (coerced) =",e);let n=await this.documentsService.createDocumentMetadata({name:this.name,description:this.description,storage_path:i,storage_bucket:"documents",content_type:this.file.type,size:this.file.size,category_id:e});if(n&&n.id)try{await this.documentsService.updateDocument(n.id,{category_id:e})}catch(t){console.debug("UploadDocumentDialog: updateDocument failed",t?.message||t)}this.notificationService.success("Document uploaded"),window.dispatchEvent(new CustomEvent("documentsUpdated")),this.uploaded.emit(),this.closeDialog.emit()}finally{this.uploading=!1}}}close(){this.closeDialog.emit()}static \u0275fac=function(e){return new(e||s)(D(k),D(F))};static \u0275cmp=I({type:s,selectors:[["app-upload-document-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",uploaded:"uploaded"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-background-card","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-lg","w-full","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-background-card/50"],[1,"text-xl","font-semibold","text-white"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6"],[1,"space-y-5"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","file",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"change"],["placeholder","Uncategorized","bgColor","bg-zinc-950","name","category",3,"ngModelChange","ngModel","options"],["name","name",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],[1,"px-6","py-4","border-t","border-zinc-800","bg-background-card/50","flex","items-center","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-medium","text-zinc-300","hover:text-white","bg-transparent","border","border-zinc-700","rounded-md","hover:bg-zinc-800","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","text-sm","font-medium","text-black","bg-brand","rounded-md","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"]],template:function(e,n){e&1&&f(0,Ie,34,8,"div",0),e&2&&u("ngIf",n.isOpen)},dependencies:[E,T,j,pe,U,N,de,O,me,B],styles:[".bg-background-card[_ngcontent-%COMP%]{background-color:var(--bg-card, #0b1220)}.border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};var Te=["headerActions"];function Ee(s,i){if(s&1){let e=x();o(0,"button",18),g("click",function(){c(e);let t=m();return d(t.openManageCategories())}),b(),o(1,"svg",19),_(2,"path",20),r(),y(),o(3,"span",21),p(4,"Manage Categories"),r()(),o(5,"button",22),g("click",function(){c(e);let t=m();return d(t.openUpload())}),b(),o(6,"svg",19),_(7,"path",23),r(),y(),o(8,"span",21),p(9,"Upload"),r()()}}function Ue(s,i){s&1&&(o(0,"div",24),_(1,"div",25),r())}function Ne(s,i){if(s&1&&(o(0,"p",45),p(1),r()),s&2){let e=m().$implicit;l(),S(e.description)}}function Oe(s,i){if(s&1){let e=x();o(0,"div",26),g("click",function(){let t=c(e).$implicit,a=m();return d(a.editDocument(t))}),o(1,"div",27)(2,"div",28)(3,"div",29)(4,"h3",30),p(5),r(),o(6,"p",31),p(7),r(),f(8,Ne,2,1,"p",32),r(),o(9,"div",33)(10,"button",34),g("click",function(t){let a=c(e).$implicit;return m().download(a),d(t.stopPropagation())}),b(),o(11,"svg",35),_(12,"path",36),r()(),y(),o(13,"button",37),g("click",function(t){let a=c(e).$implicit;return m().delete(a),d(t.stopPropagation())}),b(),o(14,"svg",35),_(15,"path",38),r()()()(),y(),o(16,"div",39)(17,"div",40)(18,"span",41),p(19,"Category"),r(),o(20,"span",42),p(21),r()(),o(22,"div",43)(23,"span",41),p(24,"Size"),r(),o(25,"span",44),p(26),r()(),o(27,"div",43)(28,"span",41),p(29,"Uploaded"),r(),o(30,"span",44),p(31),oe(32,"date"),r()()()()()}if(s&2){let e=i.$implicit,n=m();u("title",e.description||""),l(5),S(e.name),l(2),S(e.content_type),l(),u("ngIf",e.description),l(13),S((e.document_categories==null?null:e.document_categories.name)||"Uncategorized"),l(5),S(n.formatFileSize(e.size)),l(5),S(re(32,7,e.created_at,"short"))}}function je(s,i){if(s&1){let e=x();o(0,"div",46)(1,"div",47)(2,"div",48)(3,"button",49),g("click",function(){c(e);let t=m();return d(t.previewUrl=null)}),p(4,"Close"),r()(),o(5,"div",50),_(6,"iframe",51),r()()()}if(s&2){let e=m();l(6),u("src",e.previewUrl,Z)}}function Fe(s,i){if(s&1){let e=x();o(0,"button",63),g("click",function(){c(e);let t=m().$implicit,a=m(2);return d(a.goToPage(t))}),p(1),r()}if(s&2){let e=m().$implicit,n=m(2);ie("bg-brand",n.page===e)("text-black",n.page===e)("font-medium",n.page===e),l(),z(" ",e," ")}}function Pe(s,i){s&1&&(o(0,"span",64),p(1,"..."),r())}function We(s,i){if(s&1&&(o(0,"div",60),f(1,Fe,2,7,"button",61)(2,Pe,2,0,"span",62),r()),s&2){let e=i.$implicit;l(),u("ngIf",e!==-1),l(),u("ngIf",e===-1)}}function Be(s,i){if(s&1){let e=x();o(0,"div",52)(1,"div",53),p(2),r(),o(3,"div",54)(4,"button",55),g("click",function(){c(e);let t=m();return d(t.goToPage(t.page-1))}),b(),o(5,"svg",56),_(6,"path",57),r()(),f(7,We,3,2,"div",58),y(),o(8,"button",55),g("click",function(){c(e);let t=m();return d(t.goToPage(t.page+1))}),b(),o(9,"svg",56),_(10,"path",59),r()()()()}if(s&2){let e=m();l(2),ne(" Showing ",e.startItem()," to ",e.endItem()," of ",e.total," documents "),l(2),u("disabled",e.page===1),l(3),u("ngForOf",e.getPageNumbers()),l(),u("disabled",e.page===e.totalPages())}}function Ae(s,i){if(s&1){let e=x();o(0,"div",65)(1,"div",66)(2,"h2",67),p(3,"Edit Document"),r(),o(4,"div",68)(5,"div")(6,"label",69),p(7,"Name"),r(),o(8,"input",70),w("ngModelChange",function(t){c(e);let a=m();return C(a.editName,t)||(a.editName=t),d(t)}),r()(),o(9,"div")(10,"label",69),p(11,"Description"),r(),o(12,"textarea",71),w("ngModelChange",function(t){c(e);let a=m();return C(a.editDescription,t)||(a.editDescription=t),d(t)}),r()(),o(13,"div")(14,"label",69),p(15,"Category"),r(),o(16,"app-select",72),w("ngModelChange",function(t){c(e);let a=m();return C(a.editCategoryId,t)||(a.editCategoryId=t),d(t)}),r()()(),o(17,"div",73)(18,"button",74),g("click",function(){c(e);let t=m();return d(t.closeEditDialog())}),p(19," Cancel "),r(),o(20,"button",75),g("click",function(){c(e);let t=m();return d(t.saveDocumentChanges())}),p(21," Save Changes "),r()()()()}if(s&2){let e=m();l(8),v("ngModel",e.editName),l(4),v("ngModel",e.editDescription),l(4),v("ngModel",e.editCategoryId),u("options",e.categoriesOptions)}}var xe=class s{constructor(i,e,n){this.documentsService=i;this.notificationService=e;this.cd=n}headerActionsTemplate;pageHeaderService=R(ue);pageHeaderActionsService=R(ge);categories=[];categoriesOptions=[];documents=[];selectedCategory=null;uploading=!1;sub=null;page=1;pageSize=12;total=0;search="";previewUrl=null;Math=Math;totalPages=P(()=>Math.ceil(this.total/this.pageSize));startItem=P(()=>(this.page-1)*this.pageSize+1);endItem=P(()=>Math.min(this.page*this.pageSize,this.total));isConfirmDialogOpen=!1;confirmDialogTitle="";confirmDialogMessage="";pendingDeleteDoc=null;showManageCategoriesDialog=!1;showUploadDialog=!1;showEditDialog=!1;editingDocument=null;editName="";editDescription="";editCategoryId=null;ngOnInit(){this.pageHeaderService.setHeader("Documents"),this.loadCategories(),this.loadDocuments(),window.addEventListener("documentsUpdated",this.handleDocumentsUpdated)}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cd.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions(),this.sub?.unsubscribe(),window.removeEventListener("documentsUpdated",this.handleDocumentsUpdated)}async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"All categories"},...this.categories.map(i=>({value:Number(i.id),label:i.name}))],this.cd.detectChanges()}onCategoryChange(){this.loadDocuments()}async openUpload(){this.showUploadDialog=!0}async download(i){let{signedUrl:e}=await this.documentsService.generateSignedDownloadUrl(i.storage_path,300);window.open(e,"_blank")}async delete(i){this.pendingDeleteDoc=i,this.confirmDialogTitle="Delete Document",this.confirmDialogMessage=`Are you sure you want to delete "${i.name}"? This action cannot be undone.`,this.isConfirmDialogOpen=!0}async confirmDelete(){if(!this.pendingDeleteDoc)return;let i=this.pendingDeleteDoc;this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null;try{await this.documentsService.deleteFileFromStorage(i.storage_path),await this.documentsService.deleteDocument(i.id),this.notificationService.success("Document deleted"),await this.loadDocuments()}catch(e){this.notificationService.error(e.message||"Failed to delete document")}}cancelDelete(){this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null}async loadDocuments(){let i=await this.documentsService.listDocuments({categoryId:this.selectedCategory??void 0,page:this.page,pageSize:this.pageSize,search:this.search});this.documents=i.data,this.total=i.count,this.cd.detectChanges()}handleDocumentsUpdated=async()=>{await this.loadDocuments()};async onSearch(){this.page=1,await this.loadDocuments()}async onPageChange(i){i<1||i>this.totalPages()||(this.page=i,await this.loadDocuments())}goToPage(i){this.onPageChange(i)}getPageNumbers(){let i=this.totalPages(),e=this.page,n=[];if(i<=7)for(let t=1;t<=i;t++)n.push(t);else e<=3?n.push(1,2,3,4,-1,i):e>=i-2?n.push(1,-1,i-3,i-2,i-1,i):n.push(1,-1,e-1,e,e+1,-1,i);return n}formatFileSize(i){if(!i)return"0 B";let e=1024,n=["B","KB","MB","GB"],t=Math.floor(Math.log(i)/Math.log(e));return Math.round(i/Math.pow(e,t)*100)/100+" "+n[t]}openManageCategories(){this.showManageCategoriesDialog=!0}closeManageCategories(){this.showManageCategoriesDialog=!1}async onCategoriesUpdated(){await this.loadCategories(),await this.loadDocuments()}closeUploadDialog(){this.showUploadDialog=!1}async onDocumentUploaded(){await this.loadDocuments()}editDocument(i){this.editingDocument=i,this.editName=i.name,this.editDescription=i.description||"",this.editCategoryId=i.category_id,this.showEditDialog=!0}closeEditDialog(){this.showEditDialog=!1,this.editingDocument=null}async saveDocumentChanges(){if(this.editingDocument)try{await this.documentsService.updateDocument(this.editingDocument.id,{name:this.editName,description:this.editDescription,category_id:this.editCategoryId}),this.notificationService.success("Document updated successfully"),await this.loadDocuments()}catch(i){this.notificationService.error(i.message||"Failed to update document")}finally{this.closeEditDialog()}}static \u0275fac=function(e){return new(e||s)(D(k),D(F),D(se))};static \u0275cmp=I({type:s,selectors:[["app-documents"]],viewQuery:function(e,n){if(e&1&&$(Te,5),e&2){let t;ee(t=te())&&(n.headerActionsTemplate=t.first)}},decls:19,vars:17,consts:[["headerActions",""],[1,"p-4","sm:p-6","space-y-4","sm:space-y-6"],[1,"flex","flex-wrap","items-center","gap-3","bg-background-card/50","p-4","rounded-lg","border","border-zinc-800"],[1,"relative","w-full","sm:w-64"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-zinc-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Search documents...",1,"block","w-full","sm:w-64","pl-10","pr-3","py-2.5","h-10","border","border-zinc-700","rounded-md","leading-5","bg-zinc-950","text-zinc-300","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","transition-colors",3,"ngModelChange","keyup.enter","ngModel"],["placeholder","All categories","bgColor","bg-zinc-950",1,"w-full","sm:w-48",3,"ngModelChange","selectionChange","ngModel","options"],["class","flex items-center justify-center py-6",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],["class","overflow-hidden rounded-lg bg-background-card shadow border border-zinc-800 hover:border-zinc-700 transition-all cursor-pointer group",3,"title","click",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",4,"ngIf"],["class","flex items-center justify-between mt-6 px-4 py-3 bg-background-card/50 rounded-lg border border-zinc-800",4,"ngIf"],[3,"confirmed","cancelled","isOpen","title","message","confirmText","cancelText","isDangerous","iconType"],[3,"closeDialog","updated","isOpen"],[3,"closeDialog","uploaded","isOpen"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",4,"ngIf"],[1,"flex","items-center","justify-center","gap-2","px-2","sm:px-4","py-2.5","h-10","text-sm","bg-zinc-800","text-white","rounded-lg","hover:bg-zinc-700","transition-colors","border","border-zinc-700",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"hidden","sm:inline","whitespace-nowrap"],[1,"flex","items-center","justify-center","gap-2","px-2","sm:px-4","py-2.5","h-10","text-sm","bg-brand","text-black","font-medium","rounded-lg","hover:bg-brand/90","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"flex","items-center","justify-center","py-6"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"overflow-hidden","rounded-lg","bg-background-card","shadow","border","border-zinc-800","hover:border-zinc-700","transition-all","cursor-pointer","group",3,"click","title"],[1,"p-5"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-lg","font-semibold","text-white","truncate","group-hover:text-brand","transition-colors"],[1,"text-xs","text-zinc-500","mt-1"],["class","text-xs text-zinc-400 mt-2 line-clamp-2",4,"ngIf"],[1,"ml-4","flex","space-x-2"],["title","Download",1,"text-zinc-400","hover:text-brand","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["title","Delete",1,"text-zinc-400","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mt-4","pt-4","border-t","border-zinc-800"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mb-2"],[1,"text-zinc-500"],[1,"text-zinc-300","font-medium"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mt-2"],[1,"text-zinc-300"],[1,"text-xs","text-zinc-400","mt-2","line-clamp-2"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/70","backdrop-blur-sm"],[1,"bg-background-card","border","border-zinc-800","rounded-lg","p-4","max-w-4xl","w-full","shadow-2xl"],[1,"flex","justify-end","mb-2"],[1,"text-zinc-400","hover:text-white","transition-colors","px-3","py-1","rounded","hover:bg-zinc-800",3,"click"],[1,"h-[80vh]"],["frameborder","0",1,"w-full","h-full","rounded",3,"src"],[1,"flex","items-center","justify-between","mt-6","px-4","py-3","bg-background-card/50","rounded-lg","border","border-zinc-800"],[1,"text-sm","text-zinc-400"],[1,"flex","items-center","gap-2"],[1,"px-3","py-2","rounded-lg","border","border-zinc-700","hover:bg-zinc-800","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["class","flex items-center",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","items-center"],["class","px-4 py-2 rounded-lg border border-zinc-700 hover:bg-zinc-800 transition-colors min-w-[2.5rem]",3,"bg-brand","text-black","font-medium","click",4,"ngIf"],["class","px-2 text-zinc-500",4,"ngIf"],[1,"px-4","py-2","rounded-lg","border","border-zinc-700","hover:bg-zinc-800","transition-colors","min-w-[2.5rem]",3,"click"],[1,"px-2","text-zinc-500"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm","p-4"],[1,"bg-background-card","border","border-zinc-800","rounded-lg","p-4","sm:p-6","w-full","max-w-lg","shadow-2xl","max-h-[90vh]","overflow-y-auto"],[1,"text-lg","sm:text-xl","font-semibold","text-white","mb-4"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],["type","text",1,"w-full","px-3","py-2","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-300","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","sm:text-base",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-3","py-2","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-300","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","resize-none","text-sm","sm:text-base",3,"ngModelChange","ngModel"],["placeholder","Select category","bgColor","bg-zinc-950",3,"ngModelChange","ngModel","options"],[1,"flex","flex-col-reverse","sm:flex-row","items-center","justify-end","gap-2","sm:space-x-3","sm:gap-0","mt-6"],[1,"w-full","sm:w-auto","px-4","py-2","bg-zinc-800","text-white","rounded-md","hover:bg-zinc-700","transition-colors","text-sm","sm:text-base",3,"click"],[1,"w-full","sm:w-auto","px-4","py-2","bg-brand","text-black","rounded-md","hover:bg-brand/90","transition-colors","font-medium","text-sm","sm:text-base",3,"click"]],template:function(e,n){if(e&1){let t=x();f(0,Ee,10,0,"ng-template",null,0,ae),o(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),b(),o(6,"svg",5),_(7,"path",6),r()(),y(),o(8,"input",7),w("ngModelChange",function(h){return c(t),C(n.search,h)||(n.search=h),d(h)}),g("keyup.enter",function(){return c(t),d(n.onSearch())}),r()(),o(9,"app-select",8),w("ngModelChange",function(h){return c(t),C(n.selectedCategory,h)||(n.selectedCategory=h),d(h)}),g("selectionChange",function(){return c(t),d(n.onCategoryChange())}),r()(),f(10,Ue,2,0,"div",9),o(11,"div",10),f(12,Oe,33,10,"div",11),r(),f(13,je,7,1,"div",12)(14,Be,11,6,"div",13),r(),o(15,"app-confirmation-dialog",14),g("confirmed",function(){return c(t),d(n.confirmDelete())})("cancelled",function(){return c(t),d(n.cancelDelete())}),r(),o(16,"app-manage-categories-dialog",15),g("closeDialog",function(){return c(t),d(n.closeManageCategories())})("updated",function(){return c(t),d(n.onCategoriesUpdated())}),r(),o(17,"app-upload-document-dialog",16),g("closeDialog",function(){return c(t),d(n.closeUploadDialog())})("uploaded",function(){return c(t),d(n.onDocumentUploaded())}),r(),f(18,Ae,22,4,"div",17)}e&2&&(l(8),v("ngModel",n.search),l(),v("ngModel",n.selectedCategory),u("options",n.categoriesOptions),l(),u("ngIf",n.uploading),l(2),u("ngForOf",n.documents),l(),u("ngIf",n.previewUrl),l(),u("ngIf",n.total>n.pageSize),l(),u("isOpen",n.isConfirmDialogOpen)("title",n.confirmDialogTitle)("message",n.confirmDialogMessage)("confirmText","Delete")("cancelText","Cancel")("isDangerous",!0)("iconType","error"),l(),u("isOpen",n.showManageCategoriesDialog),l(),u("isOpen",n.showUploadDialog),l(),u("ngIf",n.showEditDialog))},dependencies:[E,W,T,j,U,N,O,B,A,L,H,le],styles:[".border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};export{xe as DocumentsComponent};
