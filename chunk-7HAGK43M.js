import{a as c,b as O}from"./chunk-L7GRNWJG.js";import{b as I,d as V}from"./chunk-JIVE73B3.js";import"./chunk-UTADPVO5.js";import{a as j}from"./chunk-ERIPXJJI.js";import{a as F}from"./chunk-D3455EOI.js";import{a as A}from"./chunk-SWEM3K6L.js";import{r as N}from"./chunk-XYDAMM6N.js";import{Kb as J,La as x,Mb as C,Pa as h,Q as r,Rb as k,Va as d,W as p,Wa as l,X as f,Xa as o,Ya as _,db as v,dc as M,eb as y,gb as g,ha as n,kb as b,kc as E,lb as T,mb as D,ub as m,vb as S,ya as u}from"./chunk-TKY7A7V6.js";import"./chunk-VOSPIT4N.js";var z=["headerActions"];function H(a,e){if(a&1){let t=v();l(0,"button",4),y("click",function(){p(t);let s=g();return f(s.goBack())}),m(1," \u2190 Back to planner "),o()}}function R(a,e){a&1&&(l(0,"div",5),_(1,"div",6),o())}function G(a,e){a&1&&(l(0,"span",12),m(1,"Saving..."),o())}function W(a,e){if(a&1){let t=v();l(0,"div",7)(1,"div",8)(2,"h2",9),m(3),o(),h(4,G,2,0,"span",10),o(),l(5,"textarea",11),y("input",function(s){p(t);let w=g();return w.freeText.set(s.target.value),f(w.onJournalChange())}),o()()}if(a&2){let t=g();u(3),S(t.formattedDate()),u(),d("ngIf",t.savingJournal()),u(),d("value",t.freeText())}}var P=class a{plannerService=r(O);notificationService=r(j);pageHeaderService=r(A);pageHeaderActionsService=r(F);route=r(I);router=r(V);cdr=r(k);headerActionsTemplate;currentDate=n(c.getToday());dayEntry=n(null);loading=n(!1);savingJournal=n(!1);freeText=n("");wentWell=n("");challenges=n("");takeaway=n("");tagInput=n("");currentTags=n([]);showGuidedJournal=n(!1);formattedDate=C(()=>c.parseDate(this.currentDate()).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));autoSaveTimeout=null;async ngOnInit(){this.route.paramMap.subscribe(e=>{let t=e.get("date");t&&c.isValidDateString(t)?this.currentDate.set(t):this.currentDate.set(c.getToday()),this.loadDayEntry()}),this.pageHeaderService.setHeader("Journal - "+this.formattedDate())}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions(),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout)}async loadDayEntry(){this.loading.set(!0);let e=await this.plannerService.getDayEntry(this.currentDate());e&&(this.dayEntry.set(e),e.journal?(this.freeText.set(e.journal.free_text||""),this.wentWell.set(e.journal.went_well||""),this.challenges.set(e.journal.challenges||""),this.takeaway.set(e.journal.takeaway||""),this.currentTags.set(e.journal.tags||[])):this.resetJournalFields()),this.loading.set(!1)}goBack(){this.router.navigate(["/planner/day",this.currentDate()])}onSearchJournals(){this.notificationService.info("Search journals clicked")}onJournalChange(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveJournal()},1e3)}async saveJournal(){if(!this.dayEntry()||this.savingJournal())return;this.savingJournal.set(!0);let e=await this.plannerService.updateJournal(this.dayEntry().id,{free_text:this.freeText()||null,went_well:this.wentWell()||null,challenges:this.challenges()||null,takeaway:this.takeaway()||null,tags:this.currentTags()});this.savingJournal.set(!1),e||this.notificationService.error("Error saving journal")}addTag(){let e=this.tagInput().trim();if(!e)return;let t=c.normalizeTag(e);this.currentTags().includes(t)?this.tagInput.set(""):(this.currentTags.update(i=>[...i,t]),this.tagInput.set(""),this.saveJournal())}removeTag(e){this.currentTags.update(t=>t.filter(i=>i!==e)),this.saveJournal()}onTagKeyDown(e){e.key==="Enter"&&(e.preventDefault(),this.addTag())}resetJournalFields(){this.freeText.set(""),this.wentWell.set(""),this.challenges.set(""),this.takeaway.set(""),this.currentTags.set([])}toggleGuidedJournal(){this.showGuidedJournal.update(e=>!e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=x({type:a,selectors:[["app-journal-full-view"]],viewQuery:function(t,i){if(t&1&&b(z,5),t&2){let s;T(s=D())&&(i.headerActionsTemplate=s.first)}},decls:5,vars:2,consts:[["headerActions",""],[1,"min-h-screen","bg-background","p-4","md:p-8"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","max-w-5xl mx-auto h-[calc(100vh-8rem)]",4,"ngIf"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-brand"],[1,"max-w-5xl","mx-auto","h-[calc(100vh-8rem)]"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-lg","font-medium","text-zinc-400","capitalize"],["class","text-xs text-zinc-500",4,"ngIf"],["placeholder","Start writing...","autofocus","",1,"w-full","h-full","bg-background","border-none","rounded-lg","px-6","py-4","text-white","placeholder-zinc-600","focus:outline-none","resize-none","text-lg","leading-relaxed",3,"input","value"],[1,"text-xs","text-zinc-500"]],template:function(t,i){t&1&&(l(0,"div",1),h(1,H,2,0,"ng-template",null,0,J)(3,R,2,0,"div",2)(4,W,6,3,"div",3),o()),t&2&&(u(3),d("ngIf",i.loading()),u(),d("ngIf",!i.loading()&&i.dayEntry()))},dependencies:[E,M,N],styles:["textarea[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:3px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#52525b}textarea[_ngcontent-%COMP%]{font-family:Georgia,Times New Roman,serif;line-height:1.8;letter-spacing:.01em}textarea[_ngcontent-%COMP%]::placeholder{font-style:italic;opacity:.3}"]})};export{P as JournalFullViewComponent};
