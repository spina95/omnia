import{a as L}from"./chunk-6SY3UQLD.js";import{a as F}from"./chunk-DN5MZO4F.js";import{a as B}from"./chunk-LCGV56PL.js";import{b as U,d as N,e as re,f as ae,g as O,h as se,q as j}from"./chunk-2ABDYA72.js";import{Bb as ie,Da as I,G as J,Ha as h,K as Q,Lb as P,Mb as V,Na as m,Oa as o,Ob as ne,Pa as r,Q as g,Qa as f,R as u,Rb as E,S as _,T as v,Ua as Y,Va as Z,Wa as y,Wb as oe,Xa as p,Y as T,Za as d,fb as $,gb as c,hb as x,ib as z,kb as w,lb as D,mb as S,oa as X,qb as ee,ra as l,sb as te,za as C}from"./chunk-N2NO2H5W.js";import{a as G,b as A}from"./chunk-VOSPIT4N.js";var k=class s{constructor(n){this.supabaseService=n}bucket="documents";async getCurrentUserId(){let{data:n}=await this.supabaseService.client.auth.getUser();return n?.user?.id??null}async listCategories(){let n=await this.getCurrentUserId(),e=this.supabaseService.client.from("document_categories").select("*").order("created_at",{ascending:!1});n&&(e=e.eq("user_id",n));let{data:t,error:i}=await e;if(i)throw i;return t??[]}async createCategory(n){let e=await this.getCurrentUserId(),t=A(G({},n),{user_id:e}),{data:i,error:a}=await this.supabaseService.client.from("document_categories").insert([t]).select().single();if(a)throw a;return i}async deleteCategory(n){let e=await this.getCurrentUserId(),t=this.supabaseService.client.from("document_categories").delete().eq("id",n);e&&(t=t.eq("user_id",e));let{error:i}=await t;if(i)throw i}async createDocumentMetadata(n){let e=await this.getCurrentUserId(),t=A(G({},n),{user_id:e});t.category_id!==null&&t.category_id!==void 0?t.category_id=Number(t.category_id):t.category_id=null,console.debug("DocumentsService.createDocumentMetadata: toInsert =",t);let{data:i,error:a}=await this.supabaseService.client.from("documents").insert([t]).select().single();if(a)throw a;return i}async listDocuments(n={}){let e=await this.getCurrentUserId(),t=n.page??1,i=n.pageSize??12,a=n.search??"",b=(t-1)*i,ge=b+i-1,M=this.supabaseService.client.from("documents").select("*, document_categories(id, name)",{count:"exact"}).order("created_at",{ascending:!1});n.categoryId&&(M=M.eq("category_id",Number(n.categoryId))),e&&(M=M.eq("user_id",e)),a&&(M=M.ilike("name",`%${a}%`));let{data:ue,error:K,count:fe}=await M.range(b,ge);if(K)throw K;return{data:ue??[],count:fe??0}}async uploadFile(n,e){let{data:t,error:i}=await this.supabaseService.client.storage.from(this.bucket).upload(e,n,{cacheControl:"3600",upsert:!1});if(i)throw i;return t}async generateSignedDownloadUrl(n,e=300){let{data:t,error:i}=await this.supabaseService.client.storage.from(this.bucket).createSignedUrl(n,e);if(i)throw i;return t}async deleteFileFromStorage(n){let{data:e,error:t}=await this.supabaseService.client.storage.from(this.bucket).remove([n]);if(t)throw t;return e}async deleteDocument(n){let e=await this.getCurrentUserId(),t=this.supabaseService.client.from("documents").delete().eq("id",n);e&&(t=t.eq("user_id",e));let{data:i,error:a}=await t;if(a)throw a;return i}async updateDocument(n,e){let t=await this.getCurrentUserId(),i=this.supabaseService.client.from("documents").update(e).eq("id",n);t&&(i=i.eq("user_id",t));let{data:a,error:b}=await i.select().single();if(b)throw b;return a}static \u0275fac=function(e){return new(e||s)(Q(oe))};static \u0275prov=J({token:s,factory:s.\u0275fac,providedIn:"root"})};function _e(s,n){s&1&&(_(),o(0,"svg",23),f(1,"circle",24)(2,"path",25),r())}function he(s,n){s&1&&(o(0,"div",26),c(1," No categories yet. Create your first category above. "),r())}function be(s,n){if(s&1&&(o(0,"p",37),c(1),r()),s&2){let e=d().$implicit;l(),z(" ",e.description," ")}}function ve(s,n){if(s&1){let e=y();o(0,"div",29)(1,"div",30)(2,"div",31)(3,"h5",32),c(4),r(),h(5,be,2,1,"p",33),r(),o(6,"button",34),p("click",function(){let i=g(e).$implicit,a=d(3);return u(a.confirmDelete(i))}),_(),o(7,"svg",35),f(8,"path",36),r()()()()}if(s&2){let e=n.$implicit;l(4),x(e.name),l(),m("ngIf",e.description)}}function xe(s,n){if(s&1&&(o(0,"div",27),h(1,ve,9,2,"div",28),r()),s&2){let e=d(2);l(),m("ngForOf",e.categories)}}function Ce(s,n){if(s&1){let e=y();o(0,"div",2),p("click",function(){g(e);let i=d();return u(i.close())}),o(1,"div",3),p("click",function(i){return g(e),u(i.stopPropagation())}),o(2,"div",4)(3,"h3",5),c(4,"Manage Categories"),r(),o(5,"button",6),p("click",function(){g(e);let i=d();return u(i.close())}),_(),o(6,"svg",7),f(7,"path",8),r()()(),v(),o(8,"div",9)(9,"div",10)(10,"h4",11),c(11,"Create New Category"),r(),o(12,"div",12)(13,"div")(14,"label",13),c(15," Category Name "),o(16,"span",14),c(17,"*"),r()(),o(18,"input",15),S("ngModelChange",function(i){g(e);let a=d();return D(a.newCategoryName,i)||(a.newCategoryName=i),u(i)}),r()(),o(19,"div")(20,"label",13),c(21,"Description (Optional)"),r(),o(22,"textarea",16),S("ngModelChange",function(i){g(e);let a=d();return D(a.newCategoryDescription,i)||(a.newCategoryDescription=i),u(i)}),r()(),o(23,"button",17),p("click",function(){g(e);let i=d();return u(i.createCategory())}),h(24,_e,3,0,"svg",18),c(25),r()()(),o(26,"div")(27,"h4",11),c(28,"Existing Categories"),r(),h(29,he,2,0,"div",19)(30,xe,2,1,"div",20),r()(),o(31,"div",21)(32,"button",22),p("click",function(){g(e);let i=d();return u(i.close())}),c(33," Close "),r()()()()}if(s&2){let e=d();l(18),w("ngModel",e.newCategoryName),m("disabled",e.isCreating),l(4),w("ngModel",e.newCategoryDescription),m("disabled",e.isCreating),l(),m("disabled",e.isCreating||!e.newCategoryName.trim()),l(),m("ngIf",e.isCreating),l(),z(" ",e.isCreating?"Creating...":"Create Category"," "),l(4),m("ngIf",e.categories.length===0),l(),m("ngIf",e.categories.length>0)}}var W=class s{constructor(n,e){this.documentsService=n;this.notificationService=e}isOpen=!1;closeDialog=new T;updated=new T;categories=[];newCategoryName="";newCategoryDescription="";isCreating=!1;showDeleteConfirm=!1;categoryToDelete=null;ngOnInit(){this.loadCategories()}async loadCategories(){try{this.categories=await this.documentsService.listCategories()}catch(n){this.notificationService.error(n.message||"Failed to load categories")}}async createCategory(){if(!this.newCategoryName.trim()){this.notificationService.error("Category name is required");return}this.isCreating=!0;try{await this.documentsService.createCategory({name:this.newCategoryName.trim(),description:this.newCategoryDescription.trim()||void 0}),this.notificationService.success("Category created"),this.newCategoryName="",this.newCategoryDescription="",await this.loadCategories(),this.updated.emit()}catch(n){this.notificationService.error(n.message||"Failed to create category")}finally{this.isCreating=!1}}confirmDelete(n){this.categoryToDelete=n,this.showDeleteConfirm=!0}async deleteCategory(){if(this.categoryToDelete)try{await this.documentsService.deleteCategory(this.categoryToDelete.id),this.notificationService.success("Category deleted"),this.showDeleteConfirm=!1,this.categoryToDelete=null,await this.loadCategories(),this.updated.emit()}catch(n){this.notificationService.error(n.message||"Failed to delete category")}}close(){this.closeDialog.emit()}getDeleteMessage(){return this.categoryToDelete?`Are you sure you want to delete the category "${this.categoryToDelete.name}"? Documents in this category will not be deleted, but will become uncategorized.`:""}static \u0275fac=function(e){return new(e||s)(C(k),C(F))};static \u0275cmp=I({type:s,selectors:[["app-manage-categories-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",updated:"updated"},decls:2,vars:4,consts:[["class","fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",3,"click",4,"ngIf"],["title","Delete Category","confirmText","Delete","cancelText","Cancel",3,"confirmed","cancelled","isOpen","message","iconType"],[1,"fixed","inset-0","bg-black/70","flex","items-center","justify-center","z-50","p-4","backdrop-blur-sm",3,"click"],[1,"bg-zinc-900","rounded-lg","shadow-2xl","border","border-zinc-800","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden","flex","flex-col",3,"click"],[1,"flex","items-center","justify-between","px-6","py-4","border-b","border-zinc-800"],[1,"text-xl","font-semibold","text-white"],["title","Close",1,"text-zinc-400","hover:text-white","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","px-6","py-4","space-y-6"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4"],[1,"text-sm","font-semibold","text-white","mb-3"],[1,"space-y-3"],[1,"block","text-xs","font-medium","text-zinc-400","mb-1"],[1,"text-red-400"],["type","text","placeholder","e.g., Contracts, Invoices",1,"w-full","px-3","py-2","bg-zinc-900","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm",3,"ngModelChange","ngModel","disabled"],["placeholder","Brief description of this category","rows","2",1,"w-full","px-3","py-2","bg-zinc-900","border","border-zinc-700","rounded","text-white","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","resize-none",3,"ngModelChange","ngModel","disabled"],[1,"w-full","bg-brand","text-black","px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","text-sm","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center",3,"click","disabled"],["class","animate-spin h-4 w-4 mr-2","fill","none","viewBox","0 0 24 24",4,"ngIf"],["class","text-center py-8 text-zinc-500 text-sm",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"px-6","py-4","border-t","border-zinc-800","flex","justify-end"],[1,"bg-zinc-800","text-white","px-4","py-2","rounded","font-medium","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","py-8","text-zinc-500","text-sm"],[1,"space-y-2"],["class","bg-zinc-950 border border-zinc-800 rounded-lg p-4 hover:border-zinc-700 transition-colors",4,"ngFor","ngForOf"],[1,"bg-zinc-950","border","border-zinc-800","rounded-lg","p-4","hover:border-zinc-700","transition-colors"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-white","font-medium","text-sm"],["class","text-zinc-400 text-xs mt-1",4,"ngIf"],["title","Delete category",1,"ml-3","text-zinc-400","hover:text-red-400","transition-colors","flex-shrink-0",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-zinc-400","text-xs","mt-1"]],template:function(e,t){e&1&&(h(0,Ce,34,9,"div",0),o(1,"app-confirmation-dialog",1),p("confirmed",function(){return t.deleteCategory()})("cancelled",function(){return t.showDeleteConfirm=!1}),r()),e&2&&(m("ngIf",t.isOpen),l(),m("isOpen",t.showDeleteConfirm)("message",t.getDeleteMessage())("iconType","warning"))},dependencies:[E,P,V,j,U,N,O,L],encapsulation:2})};function ye(s,n){s&1&&f(0,"span",20)}function we(s,n){if(s&1){let e=y();o(0,"div",1),p("click",function(){g(e);let i=d();return u(i.close())}),o(1,"div",2),p("click",function(i){return g(e),u(i.stopPropagation())}),o(2,"div",3)(3,"h2",4),c(4,"Upload Document"),r(),o(5,"button",5),p("click",function(){g(e);let i=d();return u(i.close())}),_(),o(6,"svg",6),f(7,"path",7),r()()(),v(),o(8,"div",8)(9,"form",9)(10,"div")(11,"label",10),c(12,"File "),o(13,"span",11),c(14,"*"),r()(),o(15,"input",12),p("change",function(i){g(e);let a=d();return u(a.onFileChange(i))}),r()(),o(16,"div")(17,"label",10),c(18,"Category"),r(),o(19,"app-select",13),S("ngModelChange",function(i){g(e);let a=d();return D(a.selectedCategory,i)||(a.selectedCategory=i),u(i)}),p("ngModelChange",function(i){g(e);let a=d();return u(a.onCategoryModelChange(i))}),r()(),o(20,"div")(21,"label",10),c(22,"Name"),r(),o(23,"input",14),S("ngModelChange",function(i){g(e);let a=d();return D(a.name,i)||(a.name=i),u(i)}),r()(),o(24,"div")(25,"label",10),c(26,"Description"),r(),o(27,"textarea",15),S("ngModelChange",function(i){g(e);let a=d();return D(a.description,i)||(a.description=i),u(i)}),r()()()(),o(28,"div",16)(29,"button",17),p("click",function(){g(e);let i=d();return u(i.close())}),c(30,"Cancel"),r(),o(31,"button",18),p("click",function(){g(e);let i=d();return u(i.submit())}),h(32,ye,1,0,"span",19),c(33),r()()()()}if(s&2){let e=d();l(19),w("ngModel",e.selectedCategory),m("options",e.categoriesOptions),l(4),w("ngModel",e.name),l(4),w("ngModel",e.description),l(2),m("disabled",e.uploading),l(2),m("disabled",e.uploading||!e.file),l(),m("ngIf",e.uploading),l(),z(" ",e.uploading?"Uploading...":"Upload"," ")}}var q=class s{constructor(n,e){this.documentsService=n;this.notificationService=e;this.loadCategories()}isOpen=!1;closeDialog=new T;uploaded=new T;categories=[];categoriesOptions=[];selectedCategory=null;description="";name="";file=null;uploading=!1;async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"Uncategorized"},...this.categories.map(n=>({value:Number(n.id),label:n.name}))]}onCategoryModelChange(n){console.debug("UploadDocumentDialog: ngModelChange selectedCategory =>",n),this.selectedCategory=n!=null?Number(n):null}onFileChange(n){this.file=n.target.files?.[0]??null,this.file&&!this.name&&(this.name=this.file.name)}async submit(){if(this.file){this.uploading=!0;try{let n=`${Date.now()}_${this.file.name}`;await this.documentsService.uploadFile(this.file,n),console.debug("UploadDocumentDialog: selectedCategory (raw) =",this.selectedCategory);let e=this.selectedCategory!==null&&this.selectedCategory!==void 0?Number(this.selectedCategory):null;console.debug("UploadDocumentDialog: categoryId (coerced) =",e);let t=await this.documentsService.createDocumentMetadata({name:this.name,description:this.description,storage_path:n,storage_bucket:"documents",content_type:this.file.type,size:this.file.size,category_id:e});if(t&&t.id)try{await this.documentsService.updateDocument(t.id,{category_id:e})}catch(i){console.debug("UploadDocumentDialog: updateDocument failed",i?.message||i)}this.notificationService.success("Document uploaded"),window.dispatchEvent(new CustomEvent("documentsUpdated")),this.uploaded.emit(),this.closeDialog.emit()}finally{this.uploading=!1}}}close(){this.closeDialog.emit()}static \u0275fac=function(e){return new(e||s)(C(k),C(F))};static \u0275cmp=I({type:s,selectors:[["app-upload-document-dialog"]],inputs:{isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",uploaded:"uploaded"},decls:1,vars:1,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-zinc-900","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-lg","w-full","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-zinc-900/50"],[1,"text-xl","font-semibold","text-white"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6"],[1,"space-y-5"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","file",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"change"],["placeholder","Uncategorized","bgColor","bg-zinc-950","name","category",3,"ngModelChange","ngModel","options"],["name","name",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand",3,"ngModelChange","ngModel"],[1,"px-6","py-4","border-t","border-zinc-800","bg-zinc-900/50","flex","items-center","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-medium","text-zinc-300","hover:text-white","bg-transparent","border","border-zinc-700","rounded-md","hover:bg-zinc-800","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","text-sm","font-medium","text-black","bg-brand","rounded-md","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"]],template:function(e,t){e&1&&h(0,we,34,8,"div",0),e&2&&m("ngIf",t.isOpen)},dependencies:[E,V,j,se,U,N,re,O,ae,B],styles:[".bg-background-card[_ngcontent-%COMP%]{background-color:var(--bg-card, #0b1220)}.border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};function De(s,n){s&1&&(o(0,"div",23),f(1,"div",24),r())}function Se(s,n){if(s&1){let e=y();o(0,"div",25)(1,"div",26)(2,"div",27)(3,"div",28)(4,"h3",29),c(5),r(),o(6,"p",30),c(7),r()(),o(8,"div",31)(9,"button",32),p("click",function(i){let a=g(e).$implicit;return d().download(a),u(i.stopPropagation())}),_(),o(10,"svg",33),f(11,"path",34),r()(),v(),o(12,"button",35),p("click",function(i){let a=g(e).$implicit;return d().delete(a),u(i.stopPropagation())}),_(),o(13,"svg",33),f(14,"path",36),r()()()(),v(),o(15,"div",37)(16,"div",38)(17,"span",39),c(18,"Category"),r(),o(19,"span",40),c(20),r()(),o(21,"div",41)(22,"span",39),c(23,"Size"),r(),o(24,"span",42),c(25),r()(),o(26,"div",41)(27,"span",39),c(28,"Uploaded"),r(),o(29,"span",42),c(30),ee(31,"date"),r()()()()()}if(s&2){let e=n.$implicit,t=d();m("title",e.description||"No description"),l(5),x(e.name),l(2),x(e.content_type),l(13),x((e.document_categories==null?null:e.document_categories.name)||"Uncategorized"),l(5),x(t.formatFileSize(e.size)),l(5),x(te(31,6,e.created_at,"short"))}}function ke(s,n){if(s&1){let e=y();o(0,"div",43)(1,"div",44)(2,"div",45)(3,"button",46),p("click",function(){g(e);let i=d();return u(i.previewUrl=null)}),c(4,"Close"),r()(),o(5,"div",47),f(6,"iframe",48),r()()()}if(s&2){let e=d();l(6),m("src",e.previewUrl,X)}}function Me(s,n){if(s&1){let e=y();Y(0),o(1,"button",58),p("click",function(){let i=g(e).$implicit,a=d(2);return u(a.onPageChange(i))}),c(2),r(),Z()}if(s&2){let e=n.$implicit,t=d(2);l(),$("bg-brand",t.page===e)("text-black",t.page===e)("border-brand",t.page===e)("font-semibold",t.page===e)("bg-transparent",t.page!==e)("text-zinc-400",t.page!==e)("border-transparent",t.page!==e)("hover:bg-zinc-800",t.page!==e),l(),z(" ",e," ")}}function ze(s,n){if(s&1){let e=y();o(0,"div",49)(1,"div",50),c(2," Showing "),o(3,"span",40),c(4),r(),c(5," to "),o(6,"span",40),c(7),r(),c(8," of "),o(9,"span",40),c(10),r(),c(11," documents "),r(),o(12,"div",51)(13,"button",52),p("click",function(){g(e);let i=d();return u(i.onPageChange(i.page-1))}),_(),o(14,"svg",53),f(15,"path",54),r()(),v(),o(16,"div",51),h(17,Me,3,17,"ng-container",55),r(),o(18,"button",56),p("click",function(){g(e);let i=d();return u(i.onPageChange(i.page+1))}),_(),o(19,"svg",53),f(20,"path",57),r()()()()}if(s&2){let e=d();l(4),x((e.page-1)*e.pageSize+1),l(3),x(e.Math.min(e.page*e.pageSize,e.total)),l(3),x(e.total),l(3),m("disabled",e.page<=1),l(4),m("ngForOf",e.getVisiblePages()),l(),m("disabled",e.page*e.pageSize>=e.total)}}var pe=class s{constructor(n,e,t){this.documentsService=n;this.notificationService=e;this.cd=t}categories=[];categoriesOptions=[];documents=[];selectedCategory=null;uploading=!1;sub=null;page=1;pageSize=12;total=0;search="";previewUrl=null;Math=Math;isConfirmDialogOpen=!1;confirmDialogTitle="";confirmDialogMessage="";pendingDeleteDoc=null;showManageCategoriesDialog=!1;showUploadDialog=!1;ngOnInit(){this.loadCategories(),this.loadDocuments(),window.addEventListener("documentsUpdated",this.handleDocumentsUpdated)}ngOnDestroy(){this.sub?.unsubscribe(),window.removeEventListener("documentsUpdated",this.handleDocumentsUpdated)}async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"All categories"},...this.categories.map(n=>({value:Number(n.id),label:n.name}))],this.cd.detectChanges()}onCategoryChange(){this.loadDocuments()}async openUpload(){this.showUploadDialog=!0}async download(n){let{signedUrl:e}=await this.documentsService.generateSignedDownloadUrl(n.storage_path,300);window.open(e,"_blank")}async delete(n){this.pendingDeleteDoc=n,this.confirmDialogTitle="Delete Document",this.confirmDialogMessage=`Are you sure you want to delete "${n.name}"? This action cannot be undone.`,this.isConfirmDialogOpen=!0}async confirmDelete(){if(!this.pendingDeleteDoc)return;let n=this.pendingDeleteDoc;this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null;try{await this.documentsService.deleteFileFromStorage(n.storage_path),await this.documentsService.deleteDocument(n.id),this.notificationService.success("Document deleted"),await this.loadDocuments()}catch(e){this.notificationService.error(e.message||"Failed to delete document")}}cancelDelete(){this.isConfirmDialogOpen=!1,this.pendingDeleteDoc=null}async loadDocuments(){let n=await this.documentsService.listDocuments({categoryId:this.selectedCategory??void 0,page:this.page,pageSize:this.pageSize,search:this.search});this.documents=n.data,this.total=n.count,this.cd.detectChanges()}handleDocumentsUpdated=async()=>{await this.loadDocuments()};async onSearch(){this.page=1,await this.loadDocuments()}async onPageChange(n){this.page=n,await this.loadDocuments()}getVisiblePages(){let n=Math.ceil(this.total/this.pageSize),e=5,t=[];if(n<=e)for(let i=1;i<=n;i++)t.push(i);else{let i=Math.max(1,this.page-Math.floor(e/2)),a=Math.min(n,i+e-1);for(let b=i;b<=a;b++)t.push(b)}return t}formatFileSize(n){if(!n)return"0 B";let e=1024,t=["B","KB","MB","GB"],i=Math.floor(Math.log(n)/Math.log(e));return Math.round(n/Math.pow(e,i)*100)/100+" "+t[i]}openManageCategories(){this.showManageCategoriesDialog=!0}closeManageCategories(){this.showManageCategoriesDialog=!1}async onCategoriesUpdated(){await this.loadCategories(),await this.loadDocuments()}closeUploadDialog(){this.showUploadDialog=!1}async onDocumentUploaded(){await this.loadDocuments()}static \u0275fac=function(e){return new(e||s)(C(k),C(F),C(ie))};static \u0275cmp=I({type:s,selectors:[["app-documents"]],decls:27,vars:16,consts:[[1,"p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-semibold","text-white","tracking-tight"],[1,"flex","items-center","space-x-3"],[1,"relative"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-zinc-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Search documents...",1,"block","pl-10","pr-3","py-2","border","border-zinc-700","rounded-md","leading-5","bg-zinc-950","text-zinc-300","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","transition-colors","w-64",3,"ngModelChange","keyup.enter","ngModel"],["placeholder","All categories","bgColor","bg-zinc-950",1,"w-48",3,"ngModelChange","selectionChange","ngModel","options"],[1,"bg-zinc-800","text-white","px-4","py-2","rounded","font-medium","hover:bg-zinc-700","transition-colors","flex","items-center","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"bg-brand","text-black","px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","flex","items-center","text-sm",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["class","flex items-center justify-center py-6",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],["class","overflow-hidden rounded-lg bg-zinc-900 shadow border border-zinc-800 hover:border-zinc-700 transition-all cursor-pointer group",3,"title",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",4,"ngIf"],["class","flex items-center justify-between mt-6 px-4 py-3 bg-zinc-900/50 rounded-lg border border-zinc-800",4,"ngIf"],[3,"confirmed","cancelled","isOpen","title","message","confirmText","cancelText","isDangerous","iconType"],[3,"closeDialog","updated","isOpen"],[3,"closeDialog","uploaded","isOpen"],[1,"flex","items-center","justify-center","py-6"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"overflow-hidden","rounded-lg","bg-zinc-900","shadow","border","border-zinc-800","hover:border-zinc-700","transition-all","cursor-pointer","group",3,"title"],[1,"p-5"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-lg","font-semibold","text-white","truncate","group-hover:text-brand","transition-colors"],[1,"text-xs","text-zinc-500","mt-1"],[1,"ml-4","flex","space-x-2"],["title","Download",1,"text-zinc-400","hover:text-brand","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["title","Delete",1,"text-zinc-400","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mt-4","pt-4","border-t","border-zinc-800"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mb-2"],[1,"text-zinc-500"],[1,"text-zinc-300","font-medium"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mt-2"],[1,"text-zinc-300"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/70","backdrop-blur-sm"],[1,"bg-zinc-900","border","border-zinc-800","rounded-lg","p-4","max-w-4xl","w-full","shadow-2xl"],[1,"flex","justify-end","mb-2"],[1,"text-zinc-400","hover:text-white","transition-colors","px-3","py-1","rounded","hover:bg-zinc-800",3,"click"],[1,"h-[80vh]"],["frameborder","0",1,"w-full","h-full","rounded",3,"src"],[1,"flex","items-center","justify-between","mt-6","px-4","py-3","bg-zinc-900/50","rounded-lg","border","border-zinc-800"],[1,"text-sm","text-zinc-400"],[1,"flex","items-center","space-x-1"],["title","Previous Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[4,"ngFor","ngForOf"],["title","Next Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"px-3","py-1","text-xs","rounded-md","border","transition-all",3,"click"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Documents"),r(),o(4,"div",3)(5,"div",4)(6,"div",5),_(),o(7,"svg",6),f(8,"path",7),r()(),v(),o(9,"input",8),S("ngModelChange",function(a){return D(t.search,a)||(t.search=a),a}),p("keyup.enter",function(){return t.onSearch()}),r()(),o(10,"app-select",9),S("ngModelChange",function(a){return D(t.selectedCategory,a)||(t.selectedCategory=a),a}),p("selectionChange",function(){return t.onCategoryChange()}),r(),o(11,"button",10),p("click",function(){return t.openManageCategories()}),_(),o(12,"svg",11),f(13,"path",12),r(),c(14," Manage Categories "),r(),v(),o(15,"button",13),p("click",function(){return t.openUpload()}),_(),o(16,"svg",11),f(17,"path",14),r(),c(18," Upload "),r()()(),h(19,De,2,0,"div",15),v(),o(20,"div",16),h(21,Se,32,9,"div",17),r(),h(22,ke,7,1,"div",18)(23,ze,21,6,"div",19),r(),o(24,"app-confirmation-dialog",20),p("confirmed",function(){return t.confirmDelete()})("cancelled",function(){return t.cancelDelete()}),r(),o(25,"app-manage-categories-dialog",21),p("closeDialog",function(){return t.closeManageCategories()})("updated",function(){return t.onCategoriesUpdated()}),r(),o(26,"app-upload-document-dialog",22),p("closeDialog",function(){return t.closeUploadDialog()})("uploaded",function(){return t.onDocumentUploaded()}),r()),e&2&&(l(9),w("ngModel",t.search),l(),w("ngModel",t.selectedCategory),m("options",t.categoriesOptions),l(9),m("ngIf",t.uploading),l(2),m("ngForOf",t.documents),l(),m("ngIf",t.previewUrl),l(),m("ngIf",t.total>t.pageSize),l(),m("isOpen",t.isConfirmDialogOpen)("title",t.confirmDialogTitle)("message",t.confirmDialogMessage)("confirmText","Delete")("cancelText","Cancel")("isDangerous",!0)("iconType","error"),l(),m("isOpen",t.showManageCategoriesDialog),l(),m("isOpen",t.showUploadDialog))},dependencies:[E,P,V,j,U,N,O,B,L,W,q,ne],styles:[".border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};export{pe as DocumentsComponent};
