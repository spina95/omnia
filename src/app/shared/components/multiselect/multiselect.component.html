<div class="relative w-full">
  <label *ngIf="label" class="block text-sm font-medium text-slate-300 mb-2">
    {{ label }}
  </label>
  <div class="relative">
    <button
      type="button"
      (click)="toggleDropdown()"
      class="w-full bg-dark-blue border border-sidebar-border text-white text-sm rounded-md px-4 py-2.5 h-10 focus:outline-none focus:ring-2 focus:ring-brand flex items-center justify-between hover:border-sidebar-border/80 transition-colors"
    >
      <div class="flex items-center gap-2 flex-wrap flex-1">
        <span *ngIf="selectedIds.length === 0" class="text-slate-400">
          {{ placeholder }}
        </span>
        <span
          *ngIf="selectedIds.length > 0 && selectedIds.length <= 2"
          class="flex items-center gap-2 flex-wrap"
        >
          <span
            *ngFor="let option of getSelectedOptions()"
            class="inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium bg-slate-800 border border-sidebar-border"
            [style.color]="option.color || '#e2e8f0'"
          >
            <span
              *ngIf="option.color"
              class="inline-block h-2 w-2 rounded-full"
              [style.background]="option.color"
            ></span>
            {{ option.name }}
            <button
              type="button"
              (click)="removeOption(option.id, $event)"
              class="ml-1 hover:text-red-400 transition-colors"
            >
              <svg
                class="h-3 w-3"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </span>
        </span>
        <span *ngIf="selectedIds.length > 2" class="text-slate-200">
          {{ selectedIds.length }} selected
        </span>
      </div>
      <svg
        class="h-4 w-4 text-slate-400 flex-shrink-0 ml-2 transition-transform"
        [class.rotate-180]="isOpen"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
      </svg>
    </button>

    <div
      *ngIf="isOpen"
      (click)="$event.stopPropagation()"
      class="absolute z-50 w-full mt-1 bg-dark-blue border border-sidebar-border rounded-md shadow-lg max-h-60 overflow-auto"
    >
      <div class="p-1">
        <div
          *ngFor="let option of options"
          (click)="toggleOption(option.id)"
          class="flex items-center space-x-2 px-3 py-2 rounded-md cursor-pointer hover:bg-brand-hover transition-colors text-sm"
        >
          <input
            type="checkbox"
            [checked]="isSelected(option.id)"
            (change)="toggleOption(option.id)"
            class="rounded border-sidebar-border bg-slate-900 text-brand focus:ring-brand focus:ring-offset-0 focus:ring-offset-slate-900"
            [class.bg-brand]="isSelected(option.id)"
            (click)="$event.stopPropagation()"
          />
          <span class="flex items-center space-x-2 flex-1">
            <span
              *ngIf="option.color"
              class="inline-block h-3 w-3 rounded-full flex-shrink-0"
              [style.background]="option.color"
            ></span>
            <span class="text-slate-200" [style.color]="option.color || '#e2e8f0'">
              {{ option.name }}
            </span>
          </span>
        </div>
        <div *ngIf="options.length === 0" class="px-3 py-2 text-sm text-slate-400 text-center">
          No options available
        </div>
      </div>
    </div>
  </div>
</div>

