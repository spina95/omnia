import{a as l,b as F}from"./chunk-D2HYOXT6.js";import{b as V,d as E}from"./chunk-TMMQKGN7.js";import"./chunk-QPMMAPE7.js";import{a as N}from"./chunk-L3TMYWDF.js";import{a as j}from"./chunk-2GG6C7AX.js";import{a as A}from"./chunk-7PC7RWUX.js";import{r as I}from"./chunk-AM3HY3WI.js";import{Ma as y,Mb as k,Ob as S,Q as i,Qa as w,Tb as C,W as m,Wa as d,X as p,Xa as s,Ya as u,Za as x,eb as h,fb as f,fc as J,ha as n,hb as g,lb as b,mb as T,mc as M,nb as _,vb as D,za as c}from"./chunk-ELVZURTH.js";import"./chunk-VOSPIT4N.js";var P=["headerActions"];function z(r,e){if(r&1){let t=h();s(0,"button",4),f("click",function(){m(t);let o=g();return p(o.goBack())}),D(1," \u2190 Back to planner "),u()}}function H(r,e){r&1&&(s(0,"div",5),x(1,"div",6),u())}function R(r,e){if(r&1){let t=h();s(0,"div",7)(1,"textarea",8),f("input",function(o){m(t);let v=g();return v.freeText.set(o.target.value),p(v.onJournalChange())}),u()()}if(r&2){let t=g();c(),d("value",t.freeText())}}var O=class r{plannerService=i(F);notificationService=i(N);pageHeaderService=i(A);pageHeaderActionsService=i(j);route=i(V);router=i(E);cdr=i(C);headerActionsTemplate;currentDate=n(l.getToday());dayEntry=n(null);loading=n(!1);savingJournal=n(!1);freeText=n("");wentWell=n("");challenges=n("");takeaway=n("");tagInput=n("");currentTags=n([]);showGuidedJournal=n(!1);formattedDate=S(()=>l.parseDate(this.currentDate()).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));autoSaveTimeout=null;async ngOnInit(){this.route.paramMap.subscribe(e=>{let t=e.get("date");t&&l.isValidDateString(t)?this.currentDate.set(t):this.currentDate.set(l.getToday()),this.loadDayEntry()}),this.pageHeaderService.setHeader(this.formattedDate())}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions(),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout)}async loadDayEntry(){this.loading.set(!0);let e=await this.plannerService.getDayEntry(this.currentDate());e&&(this.dayEntry.set(e),e.journal?(this.freeText.set(e.journal.free_text||""),this.wentWell.set(e.journal.went_well||""),this.challenges.set(e.journal.challenges||""),this.takeaway.set(e.journal.takeaway||""),this.currentTags.set(e.journal.tags||[])):this.resetJournalFields()),this.loading.set(!1)}goBack(){this.router.navigate(["/planner/day",this.currentDate()])}onSearchJournals(){this.notificationService.info("Search journals clicked")}onJournalChange(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveJournal()},1e3)}async saveJournal(){if(!this.dayEntry()||this.savingJournal())return;this.savingJournal.set(!0);let e=await this.plannerService.updateJournal(this.dayEntry().id,{free_text:this.freeText()||null,went_well:this.wentWell()||null,challenges:this.challenges()||null,takeaway:this.takeaway()||null,tags:this.currentTags()});this.savingJournal.set(!1),e||this.notificationService.error("Error saving journal")}addTag(){let e=this.tagInput().trim();if(!e)return;let t=l.normalizeTag(e);this.currentTags().includes(t)?this.tagInput.set(""):(this.currentTags.update(a=>[...a,t]),this.tagInput.set(""),this.saveJournal())}removeTag(e){this.currentTags.update(t=>t.filter(a=>a!==e)),this.saveJournal()}onTagKeyDown(e){e.key==="Enter"&&(e.preventDefault(),this.addTag())}resetJournalFields(){this.freeText.set(""),this.wentWell.set(""),this.challenges.set(""),this.takeaway.set(""),this.currentTags.set([])}toggleGuidedJournal(){this.showGuidedJournal.update(e=>!e)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-journal-full-view"]],viewQuery:function(t,a){if(t&1&&b(P,5),t&2){let o;T(o=_())&&(a.headerActionsTemplate=o.first)}},decls:5,vars:2,consts:[["headerActions",""],[1,"min-h-screen","bg-white","dark:bg-background","p-4","md:p-8","transition-colors","duration-200"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","max-w-5xl mx-auto h-[calc(100vh-8rem)]",4,"ngIf"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-brand"],[1,"max-w-5xl","mx-auto","h-[calc(100vh-8rem)]"],["placeholder","Start writing...","autofocus","",1,"w-full","h-full","bg-white","dark:bg-background","border-none","rounded-lg","px-6","py-4","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-600","focus:outline-none","resize-none","text-lg","leading-relaxed","transition-colors","duration-200",3,"input","value"]],template:function(t,a){t&1&&(s(0,"div",1),w(1,z,2,0,"ng-template",null,0,k)(3,H,2,0,"div",2)(4,R,2,1,"div",3),u()),t&2&&(c(3),d("ngIf",a.loading()),c(),d("ngIf",!a.loading()&&a.dayEntry()))},dependencies:[M,J,I],styles:["textarea[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:3px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#52525b}textarea[_ngcontent-%COMP%]{font-family:Georgia,Times New Roman,serif;line-height:1.8;letter-spacing:.01em}textarea[_ngcontent-%COMP%]::placeholder{font-style:italic;opacity:.3}"]})};export{O as JournalFullViewComponent};
