import{a as W}from"./chunk-425RWJ2X.js";import{a as V}from"./chunk-SOJVCRDF.js";import{e as O,f as $,h as H,r as G}from"./chunk-XYDAMM6N.js";import{Ha as _,L as D,La as M,Mb as q,P as E,Pa as T,Va as d,Wa as n,Xa as s,Y as P,Ya as S,Z as z,bc as U,ca as y,dc as j,eb as u,gb as N,ha as p,kc as B,qc as F,ub as c,vb as A,wb as w,ya as a}from"./chunk-TKY7A7V6.js";import{a as h,b as v,c as I}from"./chunk-VOSPIT4N.js";var b=class l{constructor(e){this.supabaseService=e}async getCurrentUserId(){let{data:e}=await this.supabaseService.client.auth.getUser();return e?.user?.id??null}async getLists(e={}){let t=await this.getCurrentUserId();if(!t)return{lists:[],total:0};let{search:i,priority:r,page:o=1,pageSize:g=12}=e,f=(o-1)*g,J=f+g-1,m=this.supabaseService.client.from("todo_lists").select("*, todo_tasks(id, completed)",{count:"exact"}).eq("user_id",t).order("created_at",{ascending:!1});i&&(m=m.or(`title.ilike.%${i}%,description.ilike.%${i}%`)),r&&r!=="all"&&(m=m.eq("priority",r));let{data:K,error:k,count:Q}=await m.range(f,J);return k?(console.error("Error fetching todo lists:",k),{lists:[],total:0}):{lists:(K||[]).map(C=>{let x=C.todo_tasks||[],R=x.filter(ee=>ee.completed).length,X=x.length,L=C,{todo_tasks:se}=L,Z=I(L,["todo_tasks"]);return v(h({},Z),{completedTasksCount:R,totalTasksCount:X})}),total:Q||0}}async getListById(e){let t=await this.getCurrentUserId();if(!t)return null;let{data:i,error:r}=await this.supabaseService.client.from("todo_lists").select("*").eq("id",e).eq("user_id",t).single();return r?(console.error("Error fetching todo list:",r),null):i}async createList(e){let t=await this.getCurrentUserId();if(!t)return null;let{data:i,error:r}=await this.supabaseService.client.from("todo_lists").insert(v(h({},e),{user_id:t})).select().single();return r?(console.error("Error creating todo list:",r),null):i}async updateList(e,t){let i=await this.getCurrentUserId();if(!i)return!1;let{error:r}=await this.supabaseService.client.from("todo_lists").update(t).eq("id",e).eq("user_id",i);return r?(console.error("Error updating todo list:",r),!1):!0}async deleteList(e){let t=await this.getCurrentUserId();if(!t)return!1;let{error:i}=await this.supabaseService.client.from("todo_lists").delete().eq("id",e).eq("user_id",t);return i?(console.error("Error deleting todo list:",i),!1):!0}async getTasks(e){if(!await this.getCurrentUserId())return[];if(!await this.getListById(e))return[];let{data:r,error:o}=await this.supabaseService.client.from("todo_tasks").select("*").eq("list_id",e).order("order_index",{ascending:!0});return o?(console.error("Error fetching tasks:",o),[]):r||[]}async createTask(e){if(!await this.getCurrentUserId()||e.list_id&&!await this.getListById(e.list_id))return null;let{data:i,error:r}=await this.supabaseService.client.from("todo_tasks").insert(e).select().single();return r?(console.error("Error creating task:",r),null):i}async updateTask(e,t){if(!await this.getCurrentUserId())return!1;let{error:r}=await this.supabaseService.client.from("todo_tasks").update(t).eq("id",e);return r?(console.error("Error updating task:",r),!1):!0}async deleteTask(e){if(!await this.getCurrentUserId())return!1;let{error:i}=await this.supabaseService.client.from("todo_tasks").delete().eq("id",e);return i?(console.error("Error deleting task:",i),!1):!0}async toggleTaskCompleted(e,t){return this.updateTask(e,{completed:t})}async reorderTasks(e,t){if(!await this.getCurrentUserId()||!await this.getListById(e))return!1;try{let o=t.map((g,f)=>this.supabaseService.client.from("todo_tasks").update({order_index:f}).eq("id",g).eq("list_id",e));return await Promise.all(o),!0}catch(o){return console.error("Error reordering tasks:",o),!1}}static \u0275fac=function(t){return new(t||l)(E(F))};static \u0275prov=D({token:l,factory:l.\u0275fac,providedIn:"root"})};function re(l,e){if(l&1&&(n(0,"div",20)(1,"span",21),c(2,"Preview:"),s(),n(3,"span",22)(4,"span",23),c(5),s()()()),l&2){let t=N();a(3),d("ngClass",t.getPriorityBgColor(t.priority())),a(),d("ngClass",t.getPriorityColor(t.priority())),a(),w(" ",t.priority()==="high"?"High Priority":t.priority()==="medium"?"Medium Priority":"Low Priority"," ")}}function oe(l,e){l&1&&S(0,"div",24)}var Y=class l{constructor(e,t){this.todosService=e;this.notificationService=t}todoList=null;close=new y;save=new y;title=p("");description=p("");priority=p(null);dueDate=p("");loading=p(!1);isEditMode=q(()=>this.todoList!==null);priorityOptions=[{value:null,label:"No Priority"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}];ngOnInit(){if(this.todoList&&(this.title.set(this.todoList.title),this.description.set(this.todoList.description||""),this.priority.set(this.todoList.priority||null),this.todoList.due_date)){let e=new Date(this.todoList.due_date),t=this.formatDateForInput(e);this.dueDate.set(t)}}formatDateForInput(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}async onSave(){if(!this.title().trim()){this.notificationService.error("Title is required");return}this.loading.set(!0);let e={title:this.title().trim(),description:this.description().trim()||void 0,priority:this.priority(),due_date:this.dueDate()||void 0},t=!1;this.isEditMode()?(t=await this.todosService.updateList(this.todoList.id,e),t&&this.notificationService.success("Todo list updated successfully")):(t=await this.todosService.createList(e)!==null,t&&this.notificationService.success("Todo list created successfully")),this.loading.set(!1),t?(this.save.emit(),this.onClose()):this.notificationService.error("Failed to save todo list")}onClose(){this.close.emit()}onBackdropClick(e){e.target===e.currentTarget&&this.onClose()}getPriorityColor(e){switch(e){case"high":return"text-red-400";case"medium":return"text-yellow-400";case"low":return"text-green-400";default:return"text-zinc-400"}}getPriorityBgColor(e){switch(e){case"high":return"bg-red-500/10 border-red-500/30";case"medium":return"bg-yellow-500/10 border-yellow-500/30";case"low":return"bg-green-500/10 border-green-500/30";default:return"bg-zinc-800/50 border-zinc-700"}}static \u0275fac=function(t){return new(t||l)(_(b),_(W))};static \u0275cmp=M({type:l,selectors:[["app-add-todo-list-dialog"]],inputs:{todoList:"todoList"},outputs:{close:"close",save:"save"},decls:36,vars:11,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-background-card","rounded-lg","border","border-zinc-800","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"flex","items-center","justify-between","p-6","border-b","border-zinc-800"],[1,"text-xl","font-semibold","text-white"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","rounded-lg","hover:bg-zinc-800",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-1","overflow-y-auto","p-6"],[1,"space-y-5",3,"submit"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],["type","text","placeholder","e.g., Shopping List, Work Tasks, etc.",1,"w-full","bg-zinc-950","border","border-zinc-700","rounded-lg","px-4","py-2.5","text-white","placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","focus:border-transparent","transition-all",3,"input","value"],["placeholder","Add a description or notes about this todo list...","rows","3",1,"w-full","bg-zinc-950","border","border-zinc-700","rounded-lg","px-4","py-2.5","text-white","placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","focus:border-transparent","transition-all","resize-none",3,"input","value"],["placeholder","Select priority",3,"valueChange","options","value"],["class","mt-3 flex items-center gap-2",4,"ngIf"],["type","date",1,"w-full","bg-zinc-950","border","border-zinc-700","rounded-lg","px-4","py-2.5","text-white","placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","focus:border-transparent","transition-all",3,"input","value"],[1,"text-zinc-500","text-sm","mt-1"],[1,"flex","items-center","justify-end","gap-3","p-6","border-t","border-zinc-800"],["type","button",1,"px-4","py-2.5","h-10","text-sm","border","border-zinc-700","text-zinc-300","rounded-lg","hover:bg-zinc-800","transition-colors",3,"click","disabled"],["type","submit",1,"flex","items-center","gap-2","px-4","py-2.5","h-10","text-sm","bg-brand","text-black","font-medium","rounded-lg","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"mt-3","flex","items-center","gap-2"],[1,"text-sm","text-zinc-400"],[1,"inline-flex","items-center","px-2.5","py-1","rounded-full","text-xs","font-medium","border",3,"ngClass"],[3,"ngClass"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"]],template:function(t,i){t&1&&(n(0,"div",0),u("click",function(o){return i.onBackdropClick(o)}),n(1,"div",1)(2,"div",2)(3,"h2",3),c(4),s(),n(5,"button",4),u("click",function(){return i.onClose()}),P(),n(6,"svg",5),S(7,"path",6),s()()(),z(),n(8,"div",7)(9,"form",8),u("submit",function(o){return o.preventDefault()}),n(10,"div")(11,"label",9),c(12," Title * "),s(),n(13,"input",10),u("input",function(o){return i.title.set(o.target.value)}),s()(),n(14,"div")(15,"label",9),c(16," Description (Optional) "),s(),n(17,"textarea",11),u("input",function(o){return i.description.set(o.target.value)}),s()(),n(18,"div")(19,"label",9),c(20," Priority "),s(),n(21,"app-select",12),u("valueChange",function(o){return i.priority.set(o)}),s(),T(22,re,6,3,"div",13),s(),n(23,"div")(24,"label",9),c(25," Due Date (Optional) "),s(),n(26,"input",14),u("input",function(o){return i.dueDate.set(o.target.value)}),s(),n(27,"p",15),c(28," Set a deadline for this todo list "),s()()()(),n(29,"div",16)(30,"button",17),u("click",function(){return i.onClose()}),c(31," Cancel "),s(),n(32,"button",18),u("click",function(){return i.onSave()}),T(33,oe,1,0,"div",19),n(34,"span"),c(35),s()()()()()),t&2&&(a(4),w(" ",i.isEditMode()?"Edit Todo List":"Add Todo List"," "),a(9),d("value",i.title()),a(4),d("value",i.description()),a(4),d("options",i.priorityOptions)("value",i.priority()),a(),d("ngIf",i.priority()),a(4),d("value",i.dueDate()),a(4),d("disabled",i.loading()),a(2),d("disabled",i.loading()),a(),d("ngIf",i.loading()),a(2),A(i.loading()?"Saving...":i.isEditMode()?"Update":"Create"))},dependencies:[B,U,j,G,H,O,$,V],encapsulation:2})};export{b as a,Y as b};
