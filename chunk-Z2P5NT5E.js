import{a as _}from"./chunk-3E3XFQVX.js";import{a as b}from"./chunk-TJP2LHAR.js";import{b as C}from"./chunk-5YYQISLI.js";import"./chunk-NZWNQJHF.js";import{Ba as m,Jb as f,La as l,Ma as i,Na as d,Va as c,ib as h,jb as o,kb as g,pa as p,wb as y,xa as s}from"./chunk-E3CE5BF5.js";import"./chunk-VOSPIT4N.js";var D=class u{constructor(t,n){this.financeService=t;this.cdr=n;let e=new Date().getFullYear();for(let r=0;r<5;r++)this.years.push(e-r)}rowData=[];isLoading=!1;errorMessage=null;currentPage=1;pageSize=20;totalRecords=0;currentSort="date";currentOrder="desc";searchQuery="";selectedMonth=null;selectedYear=new Date().getFullYear();selectedCategory=null;selectedPaymentType=null;isDialogOpen=!1;selectedExpense=null;categories=[];paymentTypes=[];months=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}];years=[];columnDefs=[{field:"id",headerName:"ID",width:80,hide:!0},{field:"name",headerName:"Description",flex:1.5,minWidth:200,cellStyle:{fontWeight:"500",display:"flex",alignItems:"center"}},{field:"amount",headerName:"Amount",width:140,type:"rightAligned",valueFormatter:t=>t.value?new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(t.value):"-",cellStyle:{fontWeight:"600",color:"#fff",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"flex-end"}},{field:"date",headerName:"Date",width:130,valueFormatter:t=>t.value?new Date(t.value).toLocaleDateString():"-",cellStyle:{color:"#a1a1aa",display:"flex",alignItems:"center"}},{headerName:"Category",width:150,valueGetter:t=>t.data.expense_categories,cellRenderer:t=>{let n=t.value;if(!n)return"-";let e=n.color||"#71717a";return`
          <span style="background-color: ${e+"33"}; color: ${e}; border-color: ${e}4d;" 
                class="px-2.5 py-0.5 rounded-full border text-xs font-medium inline-flex items-center">
            ${n.name}
          </span>`},cellStyle:{display:"flex",alignItems:"center"}},{headerName:"Account",width:160,valueGetter:t=>t.data.payment_types,cellRenderer:t=>{let n=t.value;if(!n)return"-";let e=n.color||"#71717a";return`
          <span style="background-color: ${e+"33"}; color: ${e}; border-color: ${e}4d;" 
                class="px-2.5 py-0.5 rounded-full border text-xs font-medium inline-flex items-center">
            ${n.name}
          </span>`},cellStyle:{display:"flex",alignItems:"center"}},{headerName:"",width:60,pinned:"right",cellRenderer:t=>`
          <button 
            class="delete-btn p-1.5 rounded hover:bg-red-900/20 text-zinc-500 hover:text-red-400 transition-colors"
            data-action="delete"
            data-id="${t.data.id}"
            title="Delete expense">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>`,cellStyle:{display:"flex",alignItems:"center",justifyContent:"center"},suppressHeaderMenuButton:!0,sortable:!1}];defaultColDef={sortable:!0,filter:!1,suppressHeaderMenuButton:!0,resizable:!0,cellStyle:{display:"flex",alignItems:"center"}};ngOnInit(){this.loadMetadata()}async loadMetadata(){try{let[t,n]=await Promise.all([this.financeService.getCategories(),this.financeService.getPaymentTypes()]);this.categories=t||[],this.paymentTypes=n||[]}catch(t){console.error("Failed to load metadata",t)}}onGridReady(){this.loadData()}onSortChanged(t){this.currentSort=t.field,this.currentOrder=t.order,this.currentPage=1,this.loadData()}onPageChanged(t){this.currentPage=t,this.loadData()}onFilterChanged(){this.currentPage=1,this.loadData()}onRowClicked(t){this.selectedExpense=t,this.isDialogOpen=!0}onCellClicked(t){let e=t.event?.target?.closest('[data-action="delete"]');if(e){let r=e.getAttribute("data-id");r&&this.deleteExpense(parseInt(r));return}this.onRowClicked(t.data)}async deleteExpense(t){let e=this.rowData.find(a=>a.id===t)?.name||"this expense";if(confirm(`Are you sure you want to delete "${e}"? This action cannot be undone.`))try{await this.financeService.deleteExpense(t),this.rowData=this.rowData.filter(a=>a.id!==t),this.totalRecords--,this.cdr.detectChanges()}catch(a){console.error("Failed to delete expense",a),alert("Failed to delete expense: "+(a.message||"Unknown error"))}}onAddOutcome(){this.selectedExpense=null,this.isDialogOpen=!0}onDialogClose(){this.isDialogOpen=!1,this.selectedExpense=null}onExpenseSaved(t){if(this.selectedExpense){let n=this.rowData.findIndex(e=>e.id===t.id);n!==-1&&(this.rowData[n]=t,this.rowData=[...this.rowData])}else this.loadData()}async loadData(){this.isLoading=!0,this.errorMessage=null;try{let{data:t,count:n}=await this.financeService.getExpenses({page:this.currentPage,pageSize:this.pageSize,sort:this.currentSort,order:this.currentOrder,month:this.selectedMonth||void 0,year:this.selectedYear||void 0,categoryId:this.selectedCategory||void 0,paymentTypeId:this.selectedPaymentType||void 0,search:this.searchQuery});t&&(this.rowData=t,n!==null&&(this.totalRecords=n))}catch(t){console.error("Error loading expenses",t),this.errorMessage=t.message||"Failed to load expenses"}finally{this.isLoading=!1,this.cdr.detectChanges()}}static \u0275fac=function(n){return new(n||u)(s(C),s(y))};static \u0275cmp=m({type:u,selectors:[["app-outcomes"]],decls:2,vars:21,consts:[["title","Outcomes","addButtonText","+ New Outcome","emptyStateMessage","No outcomes found matching your criteria.",3,"searchValueChange","selectedMonthChange","selectedYearChange","selectedCategoryChange","selectedPaymentTypeChange","gridReady","sortChanged","pageChanged","filterChanged","cellClicked","addClicked","columnDefs","defaultColDef","rowData","loading","error","currentPage","pageSize","totalRecords","searchValue","selectedMonth","selectedYear","selectedCategory","selectedPaymentType","categories","paymentTypes","months","years","showAddButton","showFilters"],[3,"closeDialog","expenseSaved","expense","isOpen"]],template:function(n,e){n&1&&(i(0,"app-data-table",0),g("searchValueChange",function(a){return o(e.searchQuery,a)||(e.searchQuery=a),a})("selectedMonthChange",function(a){return o(e.selectedMonth,a)||(e.selectedMonth=a),a})("selectedYearChange",function(a){return o(e.selectedYear,a)||(e.selectedYear=a),a})("selectedCategoryChange",function(a){return o(e.selectedCategory,a)||(e.selectedCategory=a),a})("selectedPaymentTypeChange",function(a){return o(e.selectedPaymentType,a)||(e.selectedPaymentType=a),a}),c("gridReady",function(){return e.onGridReady()})("sortChanged",function(a){return e.onSortChanged(a)})("pageChanged",function(a){return e.onPageChanged(a)})("filterChanged",function(){return e.onFilterChanged()})("cellClicked",function(a){return e.onCellClicked(a)})("addClicked",function(){return e.onAddOutcome()}),d(),i(1,"app-expense-dialog",1),c("closeDialog",function(){return e.onDialogClose()})("expenseSaved",function(a){return e.onExpenseSaved(a)}),d()),n&2&&(l("columnDefs",e.columnDefs)("defaultColDef",e.defaultColDef)("rowData",e.rowData)("loading",e.isLoading)("error",e.errorMessage)("currentPage",e.currentPage)("pageSize",e.pageSize)("totalRecords",e.totalRecords),h("searchValue",e.searchQuery)("selectedMonth",e.selectedMonth)("selectedYear",e.selectedYear)("selectedCategory",e.selectedCategory)("selectedPaymentType",e.selectedPaymentType),l("categories",e.categories)("paymentTypes",e.paymentTypes)("months",e.months)("years",e.years)("showAddButton",!0)("showFilters",!0),p(),l("expense",e.selectedExpense)("isOpen",e.isDialogOpen))},dependencies:[f,b,_],encapsulation:2})};export{D as OutcomesComponent};
