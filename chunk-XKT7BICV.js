import{a as G}from"./chunk-6QJJMWVY.js";import{a as H}from"./chunk-JP5UYGYO.js";import{a as q}from"./chunk-VVE27HL2.js";import{a as B}from"./chunk-NIHZNVXE.js";import{b as V,d as z,e as I,f as N,g as F,h as W,i as L,o as j,r as A}from"./chunk-FEREQUKV.js";import{$a as _,Ca as C,Ga as T,Ka as x,Qa as g,Ra as i,S as d,Sa as r,T as m,Ta as b,U as S,V as M,Zb as O,_ as v,_a as D,bb as p,ec as P,ga as E,lb as w,pb as c,qb as k,rb as h,ua as o,ub as f,vb as y,wb as u}from"./chunk-MW6OH7V5.js";function J(s,n){if(s&1&&(i(0,"div",16),c(1),r()),s&2){let e=p(2);o(),h(" ",e.errorMessage," ")}}function K(s,n){s&1&&(i(0,"div",17),b(1,"div",18),r())}function Q(s,n){if(s&1&&(i(0,"div",32)(1,"span",33),c(2),r()()),s&2){let e=p(3);o(),w("background-color",e.getCategoryColor(e.formData.category_id)+"33")("color",e.getCategoryColor(e.formData.category_id))("border-color",e.getCategoryColor(e.formData.category_id)+"4d"),o(),h(" ",e.getCategoryName(e.formData.category_id)," ")}}function R(s,n){if(s&1&&(i(0,"div",32)(1,"span",33),c(2),r()()),s&2){let e=p(3);o(),w("background-color",e.getPaymentTypeColor(e.formData.payment_type_id)+"33")("color",e.getPaymentTypeColor(e.formData.payment_type_id))("border-color",e.getPaymentTypeColor(e.formData.payment_type_id)+"4d"),o(),h(" ",e.getPaymentTypeName(e.formData.payment_type_id)," ")}}function X(s,n){if(s&1){let e=D();i(0,"form",19)(1,"div")(2,"label",20),c(3," Description "),i(4,"span",21),c(5,"*"),r()(),i(6,"input",22),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.name,t)||(l.formData.name=t),m(t)}),r()(),i(7,"div")(8,"label",20),c(9," Amount (\u20AC) "),i(10,"span",21),c(11,"*"),r()(),i(12,"div",23)(13,"span",24),c(14,"\u20AC"),r(),i(15,"input",25),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.amount,t)||(l.formData.amount=t),m(t)}),r()()(),i(16,"div")(17,"label",26),c(18," Date "),i(19,"span",21),c(20,"*"),r()(),i(21,"input",27),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.date,t)||(l.formData.date=t),m(t)}),r()(),i(22,"div")(23,"app-select",28),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.category_id,t)||(l.formData.category_id=t),m(t)}),_("selectionChange",function(){d(e);let t=p(2);return m(t.onCategoryChange())}),r(),x(24,Q,3,7,"div",29),r(),i(25,"div")(26,"app-select",30),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.payment_type_id,t)||(l.formData.payment_type_id=t),m(t)}),_("selectionChange",function(){d(e);let t=p(2);return m(t.onPaymentTypeChange())}),r(),x(27,R,3,7,"div",29),r(),i(28,"div")(29,"app-multiselect",31),u("ngModelChange",function(t){d(e);let l=p(2);return y(l.formData.tag_ids,t)||(l.formData.tag_ids=t),m(t)}),r()()()}if(s&2){let e=p(2);o(6),f("ngModel",e.formData.name),o(9),f("ngModel",e.formData.amount),o(6),f("ngModel",e.formData.date),o(2),g("options",e.categoriesOptions)("label","Category")("placeholder","Select a category..."),f("ngModel",e.formData.category_id),o(),g("ngIf",e.formData.category_id),o(2),g("options",e.paymentTypesOptions)("label","Account")("placeholder","Select an account..."),f("ngModel",e.formData.payment_type_id),o(),g("ngIf",e.formData.payment_type_id),o(2),g("options",e.tagsOptions)("label","Tags")("placeholder","Select tags..."),f("ngModel",e.formData.tag_ids)}}function Y(s,n){s&1&&b(0,"span",34)}function Z(s,n){if(s&1){let e=D();i(0,"div",1),_("click",function(){d(e);let t=p();return m(t.close())}),i(1,"div",2),_("click",function(t){return d(e),m(t.stopPropagation())}),i(2,"div",3)(3,"h2",4),c(4),r(),i(5,"button",5),_("click",function(){d(e);let t=p();return m(t.close())}),S(),i(6,"svg",6),b(7,"path",7),r()()(),M(),i(8,"div",8),x(9,J,2,1,"div",9)(10,K,2,0,"div",10)(11,X,30,17,"form",11),r(),i(12,"div",12)(13,"button",13),_("click",function(){d(e);let t=p();return m(t.close())}),c(14," Cancel "),r(),i(15,"button",14),_("click",function(){d(e);let t=p();return m(t.save())}),x(16,Y,1,0,"span",15),c(17),r()()()()}if(s&2){let e=p();o(4),k(e.expense?"Edit Expense":"Create Expense"),o(5),g("ngIf",e.errorMessage),o(),g("ngIf",e.isLoading),o(),g("ngIf",!e.isLoading),o(2),g("disabled",e.isSaving),o(2),g("disabled",e.isSaving),o(),g("ngIf",e.isSaving),o(),h(" ",e.isSaving?"Saving...":"Save Changes"," ")}}var U=class s{constructor(n,e){this.financeService=n;this.notificationService=e}expense=null;isOpen=!1;closeDialog=new v;expenseSaved=new v;formData={name:"",amount:0,date:"",category_id:null,payment_type_id:null,tag_ids:[]};categories=[];paymentTypes=[];tags=[];categoriesOptions=[];paymentTypesOptions=[];tagsOptions=[];isLoading=!1;isSaving=!1;errorMessage=null;ngOnInit(){this.loadMetadata()}ngOnChanges(){this.isOpen&&(this.expense?this.formData={name:this.expense.name||"",amount:this.expense.amount||0,date:this.expense.date?new Date(this.expense.date).toISOString().split("T")[0]:"",category_id:this.expense.expense_categories?.id||null,payment_type_id:this.expense.payment_types?.id||null,tag_ids:this.expense.expense_tags?.map(n=>n.id)||[]}:(this.formData={name:"",amount:0,date:new Date().toISOString().split("T")[0],category_id:null,payment_type_id:null,tag_ids:[]},this.setDefaultPaymentType()))}setDefaultPaymentType(){if(!this.expense&&this.paymentTypes.length>0){let n=this.paymentTypes.find(e=>e.name.toLowerCase()==="bank");n?this.formData.payment_type_id=n.id:this.paymentTypes.length>0&&(this.formData.payment_type_id=this.paymentTypes[0].id)}}async loadMetadata(){this.isLoading=!0;try{let[n,e,a]=await Promise.all([this.financeService.getCategories(),this.financeService.getPaymentTypes(),this.financeService.getTags()]);if(this.categories=n||[],this.paymentTypes=e||[],this.tags=a||[],this.categoriesOptions=this.categories.map(t=>({value:t.id,label:t.name,description:t.description})),this.paymentTypesOptions=this.paymentTypes.map(t=>({value:t.id,label:t.name})),this.tagsOptions=this.tags.map(t=>({id:t.id,name:t.name,color:t.color})),!this.expense&&this.paymentTypes.length>0){let t=this.paymentTypes.find(l=>l.name.toLowerCase()==="bank");t?this.formData.payment_type_id=t.id:this.paymentTypes.length>0&&(this.formData.payment_type_id=this.paymentTypes[0].id)}}catch(n){console.error("Failed to load metadata",n),this.errorMessage="Failed to load categories and payment types"}finally{this.isLoading=!1}}close(){this.closeDialog.emit(),this.resetForm()}async save(){if(this.validateForm()){this.isSaving=!0,this.errorMessage=null;try{if(this.expense){let n=await this.financeService.updateExpense(this.expense.id,{name:this.formData.name,amount:parseFloat(this.formData.amount),date:this.formData.date,category_id:this.formData.category_id,payment_type_id:this.formData.payment_type_id,tag_ids:this.formData.tag_ids});this.expenseSaved.emit(n),this.notificationService.success("Expense updated",3e3,"Expense updated",`Updated "${n.name}" (${n.amount} \u20AC)`)}else{let n=await this.financeService.createExpense({name:this.formData.name,amount:parseFloat(this.formData.amount),date:this.formData.date,category_id:this.formData.category_id,payment_type_id:this.formData.payment_type_id,tag_ids:this.formData.tag_ids});this.expenseSaved.emit(n),this.notificationService.success("Expense created",3e3,"Expense created",`Created "${n.name}" (${n.amount} \u20AC)`)}this.close()}catch(n){console.error("Failed to save expense",n),this.errorMessage=n.message||"Failed to save expense",this.notificationService.error(this.errorMessage??"Failed to save expense")}finally{this.isSaving=!1}}}validateForm(){return!this.formData.name||this.formData.name.trim()===""?(this.errorMessage="Name is required",!1):!this.formData.amount||this.formData.amount<=0?(this.errorMessage="Amount must be greater than 0",!1):this.formData.date?!0:(this.errorMessage="Date is required",!1)}resetForm(){this.formData={name:"",amount:0,date:"",category_id:null,payment_type_id:null},this.errorMessage=null}getCategoryColor(n){return n&&this.categories.find(a=>a.id===n)?.color||"#71717a"}getPaymentTypeColor(n){return n&&this.paymentTypes.find(a=>a.id===n)?.color||"#71717a"}getCategoryName(n){return n&&this.categories.find(a=>a.id===n)?.name||""}getPaymentTypeName(n){return n&&this.paymentTypes.find(a=>a.id===n)?.name||""}onCategoryChange(){console.log("Category changed:",this.formData.category_id)}onPaymentTypeChange(){console.log("Payment type changed:",this.formData.payment_type_id)}static \u0275fac=function(e){return new(e||s)(C(q),C(H))};static \u0275cmp=T({type:s,selectors:[["app-expense-dialog"]],inputs:{expense:"expense",isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",expenseSaved:"expenseSaved"},features:[E],decls:1,vars:1,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-zinc-900","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-2xl","w-full","max-h-[85vh]","md:max-h-[90vh]","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-zinc-900/50"],[1,"text-xl","font-semibold","text-white"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6","overflow-y-auto","max-h-[calc(90vh-140px)]"],["class","mb-4 p-3 bg-red-900/20 border border-red-900 rounded-md text-red-400 text-sm",4,"ngIf"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","space-y-5",4,"ngIf"],[1,"px-6","py-4","border-t","border-zinc-800","bg-zinc-900/50","flex","items-center","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-medium","text-zinc-300","hover:text-white","bg-transparent","border","border-zinc-700","rounded-md","hover:bg-zinc-800","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","text-sm","font-medium","text-black","bg-brand","rounded-md","hover:bg-brand/90","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full",4,"ngIf"],[1,"mb-4","p-3","bg-red-900/20","border","border-red-900","rounded-md","text-red-400","text-sm"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","h-8","w-8","border-2","border-brand","border-t-transparent","rounded-full"],[1,"space-y-5"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","text","name","name","placeholder","e.g., Grocery shopping",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],[1,"relative"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-zinc-400"],["type","number","name","amount","step","0.01","min","0","placeholder","0.00",1,"w-full","pl-10","pr-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-medium","text-zinc-300","mb-1","md:mb-2"],["type","date","name","date",1,"w-full","px-2","py-1.5","md:px-3","md:py-2","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors","text-xs","md:text-sm",3,"ngModelChange","ngModel"],["name","category_id","bgColor","bg-zinc-950",3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],["class","mt-2",4,"ngIf"],["name","payment_type_id","bgColor","bg-zinc-950",3,"ngModelChange","selectionChange","options","label","placeholder","ngModel"],["name","tag_ids",3,"ngModelChange","options","label","placeholder","ngModel"],[1,"mt-2"],[1,"px-2.5","py-1","rounded-full","border","text-xs","font-medium","inline-flex","items-center"],[1,"animate-spin","h-4","w-4","border-2","border-black","border-t-transparent","rounded-full"]],template:function(e,a){e&1&&x(0,Z,18,8,"div",0),e&2&&g("ngIf",a.isOpen)},dependencies:[P,O,A,W,V,L,z,I,j,F,N,B,G],styles:["@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .2s ease-out}.animate-scale-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scale-in .2s ease-out}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar{width:8px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-track{background:#18181b;border-radius:4px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:4px}[_nghost-%COMP%]     .overflow-y-auto::-webkit-scrollbar-thumb:hover{background:#52525b}"]})};export{U as a};
