import{a as R}from"./chunk-K4IBSADU.js";import{a as A}from"./chunk-DN5MZO4F.js";import{a as W}from"./chunk-LCGV56PL.js";import{b as N,d as L,g as G,q as H}from"./chunk-2ABDYA72.js";import{Bb as P,Da as D,Ha as _,Lb as U,Mb as O,Na as d,Oa as n,Ob as F,Pa as o,Q as h,Qa as u,R as f,Rb as B,S as v,T as x,Ua as M,Va as E,Wa as w,Xa as p,Za as m,fb as V,gb as s,hb as g,ib as I,kb as S,lb as y,mb as k,oa as z,qb as T,ra as a,sb as j,za as C}from"./chunk-N2NO2H5W.js";import"./chunk-VOSPIT4N.js";function $(l,i){l&1&&(n(0,"div",18),u(1,"div",19),o())}function q(l,i){if(l&1){let e=w();n(0,"div",20)(1,"div",21)(2,"div",22)(3,"div",23)(4,"h3",24),s(5),o(),n(6,"p",25),s(7),o()(),n(8,"div",26)(9,"button",27),p("click",function(r){let c=h(e).$implicit;return m().download(c),f(r.stopPropagation())}),v(),n(10,"svg",28),u(11,"path",29),o()(),x(),n(12,"button",30),p("click",function(r){let c=h(e).$implicit;return m().delete(c),f(r.stopPropagation())}),v(),n(13,"svg",28),u(14,"path",31),o()()()(),x(),n(15,"div",32)(16,"div",33)(17,"span",34),s(18,"Category"),o(),n(19,"span",35),s(20),o()(),n(21,"div",36)(22,"span",34),s(23,"Size"),o(),n(24,"span",37),s(25),o()(),n(26,"div",36)(27,"span",34),s(28,"Uploaded"),o(),n(29,"span",37),s(30),T(31,"date"),o()()()()()}if(l&2){let e=i.$implicit,t=m();d("title",e.description||"No description"),a(5),g(e.name),a(2),g(e.content_type),a(13),g((e.document_categories==null?null:e.document_categories.name)||"Uncategorized"),a(5),g(t.formatFileSize(e.size)),a(5),g(j(31,6,e.created_at,"short"))}}function J(l,i){if(l&1){let e=w();n(0,"div",38)(1,"div",39)(2,"div",40)(3,"button",41),p("click",function(){h(e);let r=m();return f(r.previewUrl=null)}),s(4,"Close"),o()(),n(5,"div",42),u(6,"iframe",43),o()()()}if(l&2){let e=m();a(6),d("src",e.previewUrl,z)}}function Q(l,i){if(l&1){let e=w();M(0),n(1,"button",53),p("click",function(){let r=h(e).$implicit,c=m(2);return f(c.onPageChange(r))}),s(2),o(),E()}if(l&2){let e=i.$implicit,t=m(2);a(),V("bg-brand",t.page===e)("text-black",t.page===e)("border-brand",t.page===e)("font-semibold",t.page===e)("bg-transparent",t.page!==e)("text-zinc-400",t.page!==e)("border-transparent",t.page!==e)("hover:bg-zinc-800",t.page!==e),a(),I(" ",e," ")}}function X(l,i){if(l&1){let e=w();n(0,"div",44)(1,"div",45),s(2," Showing "),n(3,"span",35),s(4),o(),s(5," to "),n(6,"span",35),s(7),o(),s(8," of "),n(9,"span",35),s(10),o(),s(11," documents "),o(),n(12,"div",46)(13,"button",47),p("click",function(){h(e);let r=m();return f(r.onPageChange(r.page-1))}),v(),n(14,"svg",48),u(15,"path",49),o()(),x(),n(16,"div",46),_(17,Q,3,17,"ng-container",50),o(),n(18,"button",51),p("click",function(){h(e);let r=m();return f(r.onPageChange(r.page+1))}),v(),n(19,"svg",48),u(20,"path",52),o()()()()}if(l&2){let e=m();a(4),g((e.page-1)*e.pageSize+1),a(3),g(e.Math.min(e.page*e.pageSize,e.total)),a(3),g(e.total),a(3),d("disabled",e.page<=1),a(4),d("ngForOf",e.getVisiblePages()),a(),d("disabled",e.page*e.pageSize>=e.total)}}var K=class l{constructor(i,e,t){this.documentsService=i;this.notificationService=e;this.cd=t}categories=[];categoriesOptions=[];documents=[];selectedCategory=null;uploading=!1;sub=null;page=1;pageSize=12;total=0;search="";previewUrl=null;Math=Math;ngOnInit(){this.loadCategories(),this.loadDocuments(),window.addEventListener("documentsUpdated",this.handleDocumentsUpdated)}ngOnDestroy(){this.sub?.unsubscribe(),window.removeEventListener("documentsUpdated",this.handleDocumentsUpdated)}async loadCategories(){this.categories=await this.documentsService.listCategories(),this.categoriesOptions=[{value:null,label:"All categories"},...this.categories.map(i=>({value:Number(i.id),label:i.name}))],this.cd.detectChanges()}onCategoryChange(){this.loadDocuments()}async openUpload(){window.dispatchEvent(new CustomEvent("openUploadDialog"))}async download(i){let{signedUrl:e}=await this.documentsService.generateSignedDownloadUrl(i.storage_path,300);window.open(e,"_blank")}async delete(i){try{await this.documentsService.deleteFileFromStorage(i.storage_path),await this.documentsService.deleteDocument(i.id),this.notificationService.success("Document deleted"),await this.loadDocuments()}catch(e){this.notificationService.error(e.message||"Failed to delete document")}}async loadDocuments(){let i=await this.documentsService.listDocuments({categoryId:this.selectedCategory??void 0,page:this.page,pageSize:this.pageSize,search:this.search});this.documents=i.data,this.total=i.count,this.cd.detectChanges()}handleDocumentsUpdated=async()=>{await this.loadDocuments()};async onSearch(){this.page=1,await this.loadDocuments()}async onPageChange(i){this.page=i,await this.loadDocuments()}getVisiblePages(){let i=Math.ceil(this.total/this.pageSize),e=5,t=[];if(i<=e)for(let r=1;r<=i;r++)t.push(r);else{let r=Math.max(1,this.page-Math.floor(e/2)),c=Math.min(i,r+e-1);for(let b=r;b<=c;b++)t.push(b)}return t}formatFileSize(i){if(!i)return"0 B";let e=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(i)/Math.log(e));return Math.round(i/Math.pow(e,r)*100)/100+" "+t[r]}static \u0275fac=function(e){return new(e||l)(C(R),C(A),C(P))};static \u0275cmp=D({type:l,selectors:[["app-documents"]],decls:20,vars:7,consts:[[1,"p-6","space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-semibold","text-white","tracking-tight"],[1,"flex","items-center","space-x-3"],[1,"relative"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-zinc-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["placeholder","Search documents...",1,"block","pl-10","pr-3","py-2","border","border-zinc-700","rounded-md","leading-5","bg-zinc-950","text-zinc-300","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","text-sm","transition-colors","w-64",3,"ngModelChange","keyup.enter","ngModel"],["placeholder","All categories","bgColor","bg-zinc-950",1,"w-48",3,"ngModelChange","selectionChange","ngModel","options"],[1,"bg-brand","text-black","px-4","py-2","rounded","font-medium","hover:bg-brand/90","transition-colors","flex","items-center","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["class","flex items-center justify-center py-6",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],["class","overflow-hidden rounded-lg bg-zinc-900 shadow border border-zinc-800 hover:border-zinc-700 transition-all cursor-pointer group",3,"title",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",4,"ngIf"],["class","flex items-center justify-between mt-6 px-4 py-3 bg-zinc-900/50 rounded-lg border border-zinc-800",4,"ngIf"],[1,"flex","items-center","justify-center","py-6"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"overflow-hidden","rounded-lg","bg-zinc-900","shadow","border","border-zinc-800","hover:border-zinc-700","transition-all","cursor-pointer","group",3,"title"],[1,"p-5"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"text-lg","font-semibold","text-white","truncate","group-hover:text-brand","transition-colors"],[1,"text-xs","text-zinc-500","mt-1"],[1,"ml-4","flex","space-x-2"],["title","Download",1,"text-zinc-400","hover:text-brand","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"],["title","Delete",1,"text-zinc-400","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mt-4","pt-4","border-t","border-zinc-800"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mb-2"],[1,"text-zinc-500"],[1,"text-zinc-300","font-medium"],[1,"flex","items-center","justify-between","text-sm","text-zinc-400","mt-2"],[1,"text-zinc-300"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/70","backdrop-blur-sm"],[1,"bg-zinc-900","border","border-zinc-800","rounded-lg","p-4","max-w-4xl","w-full","shadow-2xl"],[1,"flex","justify-end","mb-2"],[1,"text-zinc-400","hover:text-white","transition-colors","px-3","py-1","rounded","hover:bg-zinc-800",3,"click"],[1,"h-[80vh]"],["frameborder","0",1,"w-full","h-full","rounded",3,"src"],[1,"flex","items-center","justify-between","mt-6","px-4","py-3","bg-zinc-900/50","rounded-lg","border","border-zinc-800"],[1,"text-sm","text-zinc-400"],[1,"flex","items-center","space-x-1"],["title","Previous Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[4,"ngFor","ngForOf"],["title","Next Page",1,"p-1.5","rounded-md","border","border-zinc-800","text-zinc-400","hover:bg-zinc-800","hover:text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"px-3","py-1","text-xs","rounded-md","border","transition-all",3,"click"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Documents"),o(),n(4,"div",3)(5,"div",4)(6,"div",5),v(),n(7,"svg",6),u(8,"path",7),o()(),x(),n(9,"input",8),k("ngModelChange",function(c){return y(t.search,c)||(t.search=c),c}),p("keyup.enter",function(){return t.onSearch()}),o()(),n(10,"app-select",9),k("ngModelChange",function(c){return y(t.selectedCategory,c)||(t.selectedCategory=c),c}),p("selectionChange",function(){return t.onCategoryChange()}),o(),n(11,"button",10),p("click",function(){return t.openUpload()}),v(),n(12,"svg",11),u(13,"path",12),o(),s(14," Upload "),o()()(),_(15,$,2,0,"div",13),x(),n(16,"div",14),_(17,q,32,9,"div",15),o(),_(18,J,7,1,"div",16)(19,X,21,6,"div",17),o()),e&2&&(a(9),S("ngModel",t.search),a(),S("ngModel",t.selectedCategory),d("options",t.categoriesOptions),a(5),d("ngIf",t.uploading),a(2),d("ngForOf",t.documents),a(),d("ngIf",t.previewUrl),a(),d("ngIf",t.total>t.pageSize))},dependencies:[B,U,O,H,N,L,G,W,F],styles:[".border-sidebar-border[_ngcontent-%COMP%]{border-color:#ffffff0a}"]})};export{K as DocumentsComponent};
