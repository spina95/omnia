import{a as ie,b as re,c as ae,d as oe,f as se}from"./chunk-XEBZIC75.js";import{a as M,b as L}from"./chunk-EODEEVHI.js";import{b as U,d as O,e as X}from"./chunk-S7RT4Y2X.js";import"./chunk-3U37DZ2B.js";import{a as ee}from"./chunk-RBJIUBH4.js";import{a as ne}from"./chunk-FGWKY6PU.js";import{a as te}from"./chunk-2Y3G6OLQ.js";import{r as Z}from"./chunk-UI2YVUNN.js";import{$a as c,Ab as u,Bb as C,Cb as z,Kb as J,Lb as q,Ma as N,Q as k,Qa as h,Rb as Q,Tb as S,W as m,X as g,Y as x,Yb as K,Z as y,ab as n,bb as o,ca as $,cb as _,ha as v,jb as f,jc as j,kb as p,kc as P,mb as d,qb as B,rb as R,rc as F,sb as Y,xb as V,za as l}from"./chunk-5B5UU655.js";import{a as D,b as T}from"./chunk-VOSPIT4N.js";function xe(a,t){if(a&1&&(n(0,"div",20),u(1),o()),a&2){let e=t.$implicit;l(),z(" ",e," ")}}function ve(a,t){if(a&1&&_(0,"div",23),a&2){let e=d().$implicit;V("bg-brand",!e.isToday)("bg-black",e.isToday)}}function he(a,t){if(a&1){let e=f();n(0,"button",21),p("click",function(){let r=m(e).$implicit,s=d();return g(s.selectDay(r))}),u(1),h(2,ve,1,4,"div",22),o()}if(a&2){let e=t.$implicit;V("text-zinc-600",!e.isCurrentMonth)("text-zinc-300",e.isCurrentMonth&&!e.isToday)("text-white",e.isCurrentMonth)("bg-brand",e.isToday)("text-black",e.isToday)("hover:bg-zinc-800",e.isCurrentMonth&&!e.isToday)("cursor-not-allowed",!e.isCurrentMonth),c("disabled",!e.isCurrentMonth),l(),z(" ",e.day," "),l(),c("ngIf",e.hasEntries)}}var G=class a{close=new $;router=k(O);plannerService=k(L);currentMonth=v(new Date);daysWithEntries=v(new Set);loading=v(!0);weekDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];monthYear=S(()=>{let t=this.currentMonth();return`${["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]} ${t.getFullYear()}`});calendarDays=S(()=>{let t=this.currentMonth(),e=t.getFullYear(),i=t.getMonth(),s=new Date(e,i,1).getDay(),de=new Date(e,i+1,0).getDate(),ce=s,ue=new Date(e,i,0).getDate(),I=[],H=this.daysWithEntries(),W=new Date;W.setHours(0,0,0,0);for(let b=ce-1;b>=0;b--){let w=ue-b,E=new Date(e,i-1,w);I.push({date:E,dateString:this.formatDate(E),day:w,month:i-1,year:i===0?e-1:e,isCurrentMonth:!1,isToday:!1,hasEntries:H.has(this.formatDate(E))})}for(let b=1;b<=de;b++){let w=new Date(e,i,b),E=this.formatDate(w);I.push({date:w,dateString:E,day:b,month:i,year:e,isCurrentMonth:!0,isToday:w.getTime()===W.getTime(),hasEntries:H.has(E)})}let pe=42-I.length;for(let b=1;b<=pe;b++){let w=new Date(e,i+1,b);I.push({date:w,dateString:this.formatDate(w),day:b,month:i+1,year:i===11?e+1:e,isCurrentMonth:!1,isToday:!1,hasEntries:H.has(this.formatDate(w))})}return I});async ngOnInit(){await this.loadEntriesForMonth()}formatDate(t){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${r}`}async loadEntriesForMonth(){this.loading.set(!0);let t=this.currentMonth();try{let e=await this.plannerService.getDaysWithEntries(t.getFullYear(),t.getMonth()+1);this.daysWithEntries.set(new Set(e))}catch(e){console.error("Error loading entries:",e)}finally{this.loading.set(!1)}}async previousMonth(){let t=this.currentMonth();this.currentMonth.set(new Date(t.getFullYear(),t.getMonth()-1,1)),await this.loadEntriesForMonth()}async nextMonth(){let t=this.currentMonth();this.currentMonth.set(new Date(t.getFullYear(),t.getMonth()+1,1)),await this.loadEntriesForMonth()}selectDay(t){t.isCurrentMonth&&(this.close.emit(),this.router.navigate(["/planner/day",t.dateString]))}closeDialog(){this.close.emit()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=N({type:a,selectors:[["app-calendar-dialog"]],outputs:{close:"close"},decls:27,vars:3,consts:[[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","p-4","z-50",3,"click"],[1,"bg-background-card","border","border-zinc-800","rounded-lg","p-6","max-w-md","w-full",3,"click"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-lg","font-semibold","text-white"],[1,"p-1","text-zinc-500","hover:text-white","rounded","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-center","justify-between","mb-4"],[1,"p-2","text-zinc-400","hover:text-white","hover:bg-zinc-800","rounded-md","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"text-base","font-medium","text-white"],["stroke-linecap","round","stroke-linejoin","round","d","M9 5l7 7-7 7"],[1,"mb-4"],[1,"grid","grid-cols-7","gap-1","mb-2"],["class","text-center text-xs font-medium text-zinc-500 py-2",4,"ngFor","ngForOf"],[1,"grid","grid-cols-7","gap-1"],["class","relative aspect-square flex items-center justify-center rounded-md text-sm transition-all",3,"disabled","text-zinc-600","text-zinc-300","text-white","bg-brand","text-black","hover:bg-zinc-800","cursor-not-allowed","click",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-center","gap-4","text-xs","text-zinc-400","pt-4","border-t","border-zinc-800"],[1,"flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full","bg-brand"],[1,"text-center","text-xs","font-medium","text-zinc-500","py-2"],[1,"relative","aspect-square","flex","items-center","justify-center","rounded-md","text-sm","transition-all",3,"click","disabled"],["class","absolute bottom-1 left-1/2 -translate-x-1/2 w-1.5 h-1.5 rounded-full",3,"bg-brand","bg-black",4,"ngIf"],[1,"absolute","bottom-1","left-1/2","-translate-x-1/2","w-1.5","h-1.5","rounded-full"]],template:function(e,i){e&1&&(n(0,"div",0),p("click",function(){return i.closeDialog()}),n(1,"div",1),p("click",function(s){return s.stopPropagation()}),n(2,"div",2)(3,"h3",3),u(4,"Select a day"),o(),n(5,"button",4),p("click",function(){return i.closeDialog()}),x(),n(6,"svg",5),_(7,"path",6),o()()(),y(),n(8,"div",7)(9,"button",8),p("click",function(){return i.previousMonth()}),x(),n(10,"svg",5),_(11,"path",9),o()(),y(),n(12,"h4",10),u(13),o(),n(14,"button",8),p("click",function(){return i.nextMonth()}),x(),n(15,"svg",5),_(16,"path",11),o()()(),y(),n(17,"div",12)(18,"div",13),h(19,xe,2,1,"div",14),o(),n(20,"div",15),h(21,he,3,17,"button",16),o()(),n(22,"div",17)(23,"div",18),_(24,"div",19),n(25,"span"),u(26,"Has entries"),o()()()()()),e&2&&(l(13),C(i.monthYear()),l(6),c("ngForOf",i.weekDays),l(2),c("ngForOf",i.calendarDays()))},dependencies:[F,j,P],styles:["[_nghost-%COMP%]{display:block}"]})};var fe=["headerActions"],ye=()=>["/planner/search"],be=a=>["/planner/journal",a],ke=()=>["/planner/mood-calendar"];function we(a,t){if(a&1){let e=f();n(0,"app-calendar-dialog",5),p("close",function(){m(e);let r=d();return g(r.closeCalendarDialog())}),o()}}function De(a,t){if(a&1){let e=f();n(0,"div",6)(1,"button",7),p("click",function(){m(e);let r=d();return g(r.openCalendarDialog())}),x(),n(2,"svg",8),_(3,"path",9),o(),y(),n(4,"span",10),u(5,"Select date"),o()(),n(6,"button",11),p("click",function(){m(e);let r=d();return g(r.goToToday())}),u(7," Oggi "),o(),n(8,"button",12),x(),n(9,"svg",8),_(10,"circle",13)(11,"path",14),o(),y(),n(12,"span",10),u(13,"Search journals"),o()()()}a&2&&(l(8),c("routerLink",J(1,ye)))}function Te(a,t){a&1&&(n(0,"div",15),_(1,"div",16),o())}function Ce(a,t){if(a&1){let e=f();n(0,"button",64),p("click",function(){m(e);let r=d(2);return g(r.goToPreviousDay())}),x(),n(1,"svg",65),_(2,"path",66),o()()}}function Se(a,t){a&1&&_(0,"div",67)}function Ve(a,t){if(a&1){let e=f();n(0,"button",68),p("click",function(){m(e);let r=d(2);return g(r.goToNextDay())}),x(),n(1,"svg",65),_(2,"path",57),o()()}}function Ee(a,t){a&1&&_(0,"div",67)}function ze(a,t){a&1&&(x(),n(0,"svg",82),_(1,"path",83),o())}function Me(a,t){a&1&&(n(0,"span",87),u(1," Postponed "),o())}function Ie(a,t){if(a&1&&(n(0,"div",84)(1,"span",85),u(2),o(),h(3,Me,2,0,"span",86),o()),a&2){let e=d().$implicit;l(),V("line-through",e.status==="done")("text-zinc-500",e.status==="done")("text-zinc-900",e.status!=="done")("dark:text-white",e.status!=="done"),l(),z(" ",e.text," "),l(),c("ngIf",e.status==="postponed")}}function Ne(a,t){if(a&1){let e=f();n(0,"div",88)(1,"input",89),p("input",function(r){m(e);let s=d(3);return g(s.editingTaskText.set(r.target.value))})("keydown.enter",function(){m(e);let r=d().$implicit,s=d(2);return g(s.saveEditTask(r))})("keydown.escape",function(){m(e);let r=d(3);return g(r.cancelEditTask())}),o()()}if(a&2){let e=d(3);l(),c("value",e.editingTaskText())}}function je(a,t){if(a&1){let e=f();n(0,"button",90),p("click",function(){m(e);let r=d().$implicit,s=d(2);return g(s.startEditTask(r))}),x(),n(1,"svg",8),_(2,"path",91),o()()}}function Pe(a,t){if(a&1){let e=f();n(0,"button",92),p("click",function(){m(e);let r=d().$implicit,s=d(2);return g(s.saveEditTask(r))}),x(),n(1,"svg",8),_(2,"path",83),o()()}}function Fe(a,t){if(a&1){let e=f();n(0,"button",93),p("click",function(){m(e);let r=d(3);return g(r.cancelEditTask())}),x(),n(1,"svg",8),_(2,"path",94),o()()}}function Oe(a,t){if(a&1){let e=f();n(0,"button",95),p("click",function(){m(e);let r=d().$implicit,s=d(2);return g(s.markAsPostponed(r))}),x(),n(1,"svg",8),_(2,"path",96),o()()}}function Le(a,t){if(a&1){let e=f();n(0,"button",97),p("click",function(){m(e);let r=d().$implicit,s=d(2);return g(s.deleteTask(r))}),x(),n(1,"svg",8),_(2,"path",98),o()()}}function Ge(a,t){if(a&1){let e=f();n(0,"div",69)(1,"div",70),x(),n(2,"svg",65),_(3,"path",71),o()(),y(),n(4,"button",72),p("click",function(){let r=m(e).$implicit,s=d(2);return g(s.toggleTaskStatus(r))}),h(5,ze,2,0,"svg",73),o(),h(6,Ie,4,10,"div",74)(7,Ne,2,1,"div",75),n(8,"div",76),h(9,je,3,0,"button",77)(10,Pe,3,0,"button",78)(11,Fe,3,0,"button",79)(12,Oe,3,0,"button",80)(13,Le,3,0,"button",81),o()()}if(a&2){let e=t.$implicit,i=d(2);l(4),V("border-brand",e.status==="done")("bg-brand",e.status==="done")("border-zinc-600",e.status!=="done"),l(),c("ngIf",e.status==="done"),l(),c("ngIf",i.editingTaskId()!==e.id),l(),c("ngIf",i.editingTaskId()===e.id),l(2),c("ngIf",i.editingTaskId()!==e.id),l(),c("ngIf",i.editingTaskId()===e.id),l(),c("ngIf",i.editingTaskId()===e.id),l(),c("ngIf",i.editingTaskId()!==e.id&&e.status==="todo"),l(),c("ngIf",i.editingTaskId()!==e.id)}}function He(a,t){a&1&&(n(0,"div",99),x(),n(1,"svg",100),_(2,"path",28),o(),y(),n(3,"p"),u(4,"No tasks for today"),o()())}function Je(a,t){if(a&1&&(n(0,"span",105),u(1," Postponed: "),n(2,"span",108),u(3),o()()),a&2){let e=d(3);l(3),C(e.postponedTasks().length)}}function Ae(a,t){if(a&1&&(n(0,"div",101)(1,"div",102)(2,"span",103),u(3," To do: "),n(4,"span",104),u(5),o()(),n(6,"span",105),u(7," Completed: "),n(8,"span",106),u(9),o()(),h(10,Je,4,1,"span",107),o()()),a&2){let e=d(2);l(5),C(e.todoTasks().length),l(4),C(e.doneTasks().length),l(),c("ngIf",e.postponedTasks().length>0)}}function We(a,t){a&1&&(n(0,"span",109),u(1,"Saving..."),o())}function $e(a,t){if(a&1){let e=f();n(0,"button",110),p("click",function(){let r=m(e).$implicit,s=d(2);return g(s.selectMood(r.value))}),n(1,"span",111),u(2),o(),n(3,"span",10),u(4),o()()}if(a&2){let e=t.$implicit,i=d(2);V("bg-brand",i.selectedMood()===e.value)("text-black",i.selectedMood()===e.value)("bg-zinc-200",i.selectedMood()!==e.value)("dark:bg-zinc-800",i.selectedMood()!==e.value)("text-zinc-900",i.selectedMood()!==e.value)("dark:text-zinc-300",i.selectedMood()!==e.value),c("title",e.label),l(2),C(e.emoji),l(2),C(e.label)}}function Be(a,t){if(a&1){let e=f();n(0,"button",112),p("click",function(){m(e);let r=d(2);return g(r.selectMood(null))}),u(1," Clear "),o()}}function Re(a,t){if(a&1){let e=f();n(0,"div",113)(1,"div")(2,"label",114),u(3," What went well? "),o(),n(4,"textarea",115),p("input",function(r){m(e);let s=d(2);return s.wentWell.set(r.target.value),g(s.onJournalChange())}),o()(),n(5,"div")(6,"label",114),u(7," Challenges and difficulties "),o(),n(8,"textarea",116),p("input",function(r){m(e);let s=d(2);return s.challenges.set(r.target.value),g(s.onJournalChange())}),o()(),n(9,"div")(10,"label",114),u(11," What I am grateful for "),o(),n(12,"textarea",117),p("input",function(r){m(e);let s=d(2);return s.takeaway.set(r.target.value),g(s.onJournalChange())}),o()()()}if(a&2){let e=d(2);l(4),c("value",e.wentWell()),l(4),c("value",e.challenges()),l(4),c("value",e.takeaway())}}function Ye(a,t){if(a&1){let e=f();n(0,"span",118),u(1),n(2,"button",119),p("click",function(){let r=m(e).$implicit,s=d(2);return g(s.removeTag(r))}),x(),n(3,"svg",120),_(4,"path",94),o()()()}if(a&2){let e=t.$implicit;l(),z(" ",e," ")}}function qe(a,t){if(a&1){let e=f();n(0,"div",17)(1,"div",18)(2,"div",19),h(3,Ce,3,0,"button",20)(4,Se,1,0,"div",21),n(5,"div",22)(6,"h2",23),u(7),o()(),h(8,Ve,3,0,"button",24)(9,Ee,1,0,"div",21),o()(),n(10,"div",25)(11,"h3",26),x(),n(12,"svg",27),_(13,"path",28),o(),u(14," Planner "),o(),y(),n(15,"div",29)(16,"div",30)(17,"input",31),p("input",function(r){m(e);let s=d();return g(s.newTaskText.set(r.target.value))})("keydown.enter",function(){m(e);let r=d();return g(r.addTask())}),o(),n(18,"button",32),p("click",function(){m(e);let r=d();return g(r.addTask())}),u(19," Add "),o()()(),n(20,"div",33),p("cdkDropListDropped",function(r){m(e);let s=d();return g(s.onTaskDrop(r))}),h(21,Ge,14,14,"div",34)(22,He,5,0,"div",35),o(),h(23,Ae,11,3,"div",36),o(),n(24,"div",25)(25,"div",37)(26,"h3",38),x(),n(27,"svg",27),_(28,"path",39),o(),u(29," Journal "),o(),y(),n(30,"div",40),h(31,We,2,0,"span",41),n(32,"button",42),x(),n(33,"svg",8),_(34,"path",43),o(),y(),n(35,"span",10),u(36,"Full-screen"),o(),n(37,"span",44),u(38,"Expand"),o()()()(),n(39,"div",45)(40,"label",46),u(41," Free thoughts and notes "),o(),n(42,"textarea",47),p("input",function(r){m(e);let s=d();return s.freeText.set(r.target.value),g(s.onJournalChange())}),o()(),n(43,"div",45)(44,"div",48)(45,"h4",49),u(46,"How are you feeling today?"),o(),n(47,"a",50),x(),n(48,"svg",51),_(49,"path",9),o(),y(),n(50,"span",10),u(51,"Calendar"),o()()(),n(52,"div",52),h(53,$e,5,15,"button",53)(54,Be,2,0,"button",54),o()(),n(55,"div",45)(56,"button",55),p("click",function(){m(e);let r=d();return g(r.toggleGuidedJournal())}),x(),n(57,"svg",56),_(58,"path",57),o(),u(59," Guided journal (optional) "),o(),h(60,Re,13,3,"div",58),o(),y(),n(61,"div")(62,"label",59),u(63," Tag "),o(),n(64,"div",60),h(65,Ye,5,1,"span",61),o(),n(66,"div",30)(67,"input",62),p("input",function(r){m(e);let s=d();return g(s.tagInput.set(r.target.value))})("keydown",function(r){m(e);let s=d();return g(s.onTagKeyDown(r))}),o(),n(68,"button",63),p("click",function(){m(e);let r=d();return g(r.addTag())}),u(69," Add "),o()()()()()}if(a&2){let e=d();l(3),c("ngIf",e.hasPreviousEntry()),l(),c("ngIf",!e.hasPreviousEntry()),l(3),C(e.formattedDate()),l(),c("ngIf",e.hasNextEntry()),l(),c("ngIf",!e.hasNextEntry()),l(8),c("value",e.newTaskText()),l(),c("disabled",!e.newTaskText().trim()),l(3),c("ngForOf",e.tasks()),l(),c("ngIf",e.tasks().length===0),l(),c("ngIf",e.tasks().length>0),l(8),c("ngIf",e.savingJournal()),l(),c("routerLink",q(22,be,e.currentDate())),l(10),c("value",e.freeText()),l(5),c("routerLink",J(24,ke)),l(6),c("ngForOf",e.moods),l(),c("ngIf",e.selectedMood()),l(3),V("rotate-90",e.showGuidedJournal()),l(3),c("ngIf",e.showGuidedJournal()),l(5),c("ngForOf",e.currentTags()),l(2),c("value",e.tagInput()),l(),c("disabled",!e.tagInput().trim())}}var le=class a{plannerService=k(L);notificationService=k(ee);pageHeaderService=k(te);pageHeaderActionsService=k(ne);route=k(U);router=k(O);cdr=k(K);headerActionsTemplate;showCalendarDialog=v(!1);currentDate=v(M.getToday());dayEntry=v(null);loading=v(!1);savingJournal=v(!1);newTaskText=v("");editingTaskId=v(null);editingTaskText=v("");freeText=v("");wentWell=v("");challenges=v("");takeaway=v("");selectedMood=v(null);tagInput=v("");currentTags=v([]);showGuidedJournal=v(!1);hasPreviousEntry=v(!1);hasNextEntry=v(!1);tasks=S(()=>{let t=this.dayEntry();return!t||!t.tasks?[]:[...t.tasks].sort((e,i)=>e.task_order-i.task_order)});todoTasks=S(()=>this.tasks().filter(t=>t.status==="todo"));doneTasks=S(()=>this.tasks().filter(t=>t.status==="done"));postponedTasks=S(()=>this.tasks().filter(t=>t.status==="postponed"));formattedDate=S(()=>M.parseDate(this.currentDate()).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));moods=[{value:"great",emoji:"\u{1F60A}",label:"Great"},{value:"good",emoji:"\u{1F642}",label:"Good"},{value:"neutral",emoji:"\u{1F610}",label:"Neutral"},{value:"bad",emoji:"\u{1F614}",label:"Bad"},{value:"tired",emoji:"\u{1F634}",label:"Tired"},{value:"angry",emoji:"\u{1F620}",label:"Angry"},{value:"stressed",emoji:"\u{1F630}",label:"Stressed"}];autoSaveTimeout=null;async ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("date");e&&M.isValidDateString(e)?this.currentDate.set(e):this.currentDate.set(M.getToday()),this.loadDayEntry()}),this.pageHeaderService.setHeader("Planner & Journal")}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions(),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout)}async loadDayEntry(){this.loading.set(!0);let t=await this.plannerService.getDayEntry(this.currentDate());t&&(this.dayEntry.set(t),t.journal?(this.freeText.set(t.journal.free_text||""),this.wentWell.set(t.journal.went_well||""),this.challenges.set(t.journal.challenges||""),this.takeaway.set(t.journal.takeaway||""),this.currentTags.set(t.journal.tags||[])):this.resetJournalFields(),this.selectedMood.set(t.mood)),await this.checkNavigationAvailability(),this.loading.set(!1)}async checkNavigationAvailability(){let t=await this.plannerService.getNearestDayWithEntries(this.currentDate(),"previous",1);this.hasPreviousEntry.set(!!t);let e=await this.plannerService.getNearestDayWithEntries(this.currentDate(),"next",1);this.hasNextEntry.set(!!e)}async goToPreviousDay(){let t=await this.plannerService.getNearestDayWithEntries(this.currentDate(),"previous");t?this.router.navigate(["/planner/day",t]):this.notificationService.info("No previous entries found")}async goToNextDay(){let t=await this.plannerService.getNearestDayWithEntries(this.currentDate(),"next");t?this.router.navigate(["/planner/day",t]):this.notificationService.info("No next entries found")}goToToday(){this.router.navigate(["/planner/today"])}openCalendarDialog(){this.showCalendarDialog.set(!0)}closeCalendarDialog(){this.showCalendarDialog.set(!1)}async addTask(){let t=this.newTaskText().trim();if(!t||!this.dayEntry())return;let e=this.dayEntry(),i=await this.plannerService.createTask(e.id,{text:t,status:"todo",task_order:this.tasks().length});i?(this.dayEntry.update(r=>r&&T(D({},r),{tasks:[...r.tasks||[],i]})),this.newTaskText.set("")):this.notificationService.error("Error creating task")}async toggleTaskStatus(t){let e=t.status==="todo"?"done":"todo";await this.plannerService.updateTask(t.id,{status:e})?this.dayEntry.update(r=>!r||!r.tasks?r:T(D({},r),{tasks:r.tasks.map(s=>s.id===t.id?T(D({},s),{status:e}):s)})):this.notificationService.error("Error updating task")}async markAsPostponed(t){await this.plannerService.updateTask(t.id,{status:"postponed"})?this.dayEntry.update(i=>!i||!i.tasks?i:T(D({},i),{tasks:i.tasks.map(r=>r.id===t.id?T(D({},r),{status:"postponed"}):r)})):this.notificationService.error("Error updating task")}startEditTask(t){this.editingTaskId.set(t.id),this.editingTaskText.set(t.text)}cancelEditTask(){this.editingTaskId.set(null),this.editingTaskText.set("")}async saveEditTask(t){let e=this.editingTaskText().trim();if(!e)return;await this.plannerService.updateTask(t.id,{text:e})?(this.dayEntry.update(r=>!r||!r.tasks?r:T(D({},r),{tasks:r.tasks.map(s=>s.id===t.id?T(D({},s),{text:e}):s)})),this.editingTaskId.set(null),this.editingTaskText.set("")):this.notificationService.error("Error updating task")}async deleteTask(t){if(!confirm("Eliminare questo task?"))return;await this.plannerService.deleteTask(t.id)?this.dayEntry.update(i=>!i||!i.tasks?i:T(D({},i),{tasks:i.tasks.filter(r=>r.id!==t.id)})):this.notificationService.error("Error deleting task")}async onTaskDrop(t){let e=this.tasks();ie(e,t.previousIndex,t.currentIndex);let i=e.map((s,A)=>({id:s.id,task_order:A}));await this.plannerService.updateTaskOrders(i)?this.dayEntry.update(s=>s&&T(D({},s),{tasks:e})):(this.notificationService.error("Error reordering tasks"),this.loadDayEntry())}async selectMood(t){if(!this.dayEntry())return;this.selectedMood.set(t),await this.plannerService.updateDayEntry(this.dayEntry().id,{mood:t})||this.notificationService.error("Error saving mood")}onJournalChange(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveJournal()},1e3)}async saveJournal(){if(!this.dayEntry()||this.savingJournal())return;this.savingJournal.set(!0);let t=await this.plannerService.updateJournal(this.dayEntry().id,{free_text:this.freeText()||null,went_well:this.wentWell()||null,challenges:this.challenges()||null,takeaway:this.takeaway()||null,tags:this.currentTags()});this.savingJournal.set(!1),t||this.notificationService.error("Error saving journal")}addTag(){let t=this.tagInput().trim();if(!t)return;let e=M.normalizeTag(t);this.currentTags().includes(e)?this.tagInput.set(""):(this.currentTags.update(i=>[...i,e]),this.tagInput.set(""),this.saveJournal())}removeTag(t){this.currentTags.update(e=>e.filter(i=>i!==t)),this.saveJournal()}onTagKeyDown(t){t.key==="Enter"&&(t.preventDefault(),this.addTag())}resetJournalFields(){this.freeText.set(""),this.wentWell.set(""),this.challenges.set(""),this.takeaway.set(""),this.currentTags.set([])}toggleGuidedJournal(){this.showGuidedJournal.update(t=>!t)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=N({type:a,selectors:[["app-day-view"]],viewQuery:function(e,i){if(e&1&&B(fe,5),e&2){let r;R(r=Y())&&(i.headerActionsTemplate=r.first)}},decls:6,vars:3,consts:[["headerActions",""],[1,"max-w-7xl","mx-auto","p-3","sm:p-4","space-y-4","sm:space-y-6"],[3,"close",4,"ngIf"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","space-y-6",4,"ngIf"],[3,"close"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm","font-medium","flex","items-center","gap-1.5",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"hidden","sm:inline"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],[1,"px-3","py-1.5","bg-brand","text-black","rounded-md","hover:bg-brand/90","transition-colors","text-sm","font-medium","flex","items-center","gap-1.5",3,"routerLink"],["cx","11","cy","11","r","8"],["stroke-linecap","round","stroke-linejoin","round","d","m21 21-4.35-4.35"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-brand"],[1,"space-y-6"],[1,"bg-white","dark:bg-background-card","border","border-zinc-300","dark:border-zinc-800","rounded-lg","p-4","transition-colors","duration-200"],[1,"flex","items-center","justify-between","gap-4"],["class","p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-md transition-colors","title","Previous day with entries",3,"click",4,"ngIf"],["class","p-2 w-9 h-9",4,"ngIf"],[1,"flex-1","text-center"],[1,"text-xl","font-semibold","text-zinc-900","dark:text-white","capitalize","transition-colors","duration-200"],["class","p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-md transition-colors","title","Next day with entries",3,"click",4,"ngIf"],[1,"bg-white","dark:bg-background-card","border","border-zinc-300","dark:border-zinc-800","rounded-lg","p-4","sm:p-6","transition-colors","duration-200"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","mb-4","flex","items-center","gap-2","transition-colors","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-brand"],["stroke-linecap","round","stroke-linejoin","round","d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"mb-4"],[1,"flex","gap-2"],["type","text","placeholder","Add a task...",1,"flex-1","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-md","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","transition-colors","duration-200",3,"input","keydown.enter","value"],[1,"px-4","py-2","bg-brand","text-black","rounded-md","hover:bg-brand/90","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["cdkDropList","",1,"space-y-2",3,"cdkDropListDropped"],["cdkDrag","","class","flex items-center gap-3 p-3 bg-white dark:bg-background border border-zinc-300 dark:border-zinc-800 rounded-md hover:border-zinc-400 dark:hover:border-zinc-700 transition-colors duration-200 group",4,"ngFor","ngForOf"],["class","text-center py-8 text-zinc-500",4,"ngIf"],["class","mt-4 pt-4 border-t border-zinc-300 dark:border-zinc-800 flex items-center justify-between text-sm transition-colors duration-200",4,"ngIf"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","flex","items-center","gap-2","transition-colors","duration-200"],["stroke-linecap","round","stroke-linejoin","round","d","M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"],[1,"flex","items-center","gap-3"],["class","text-xs text-zinc-500 dark:text-zinc-500 transition-colors duration-200",4,"ngIf"],["title","Open full-screen journal",1,"px-3","py-1.5","bg-brand","text-black","rounded-md","hover:bg-brand/90","transition-colors","text-sm","font-medium","flex","items-center","gap-1.5",3,"routerLink"],["stroke-linecap","round","stroke-linejoin","round","d","M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"],[1,"sm:hidden"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-zinc-700","dark:text-zinc-300","mb-2","transition-colors","duration-200"],["rows","6","placeholder","Write your thoughts, ideas, reflections...",1,"w-full","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-lg","px-4","py-3","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","resize-none","transition-colors","duration-200",3,"input","value"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-medium","text-zinc-700","dark:text-zinc-300","transition-colors","duration-200"],["title","View Mood Calendar",1,"px-3","py-1.5","bg-brand","hover:bg-brand/80","text-black","rounded-md","transition-colors","text-xs","font-medium","flex","items-center","gap-1.5",3,"routerLink"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-3.5","w-3.5"],[1,"flex","flex-wrap","items-center","gap-2"],["class","px-4 py-2 rounded-md hover:opacity-80 transition-all duration-200 text-sm flex items-center gap-2",3,"bg-brand","text-black","bg-zinc-200","dark:bg-zinc-800","text-zinc-900","dark:text-zinc-300","title","click",4,"ngFor","ngForOf"],["class","px-3 py-2 text-zinc-500 hover:text-zinc-300 transition-colors text-sm",3,"click",4,"ngIf"],[1,"flex","items-center","gap-2","text-sm","font-medium","text-zinc-300","hover:text-white","transition-colors","mb-3",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","d","M9 5l7 7-7 7"],["class","space-y-4 pl-6",4,"ngIf"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"flex","flex-wrap","gap-2","mb-3"],["class","inline-flex items-center gap-1.5 px-3 py-1 rounded-md text-sm font-medium bg-brand/10 text-brand border border-brand/20",4,"ngFor","ngForOf"],["type","text","placeholder","Add tag...",1,"flex-1","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-md","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","text-sm","transition-colors","duration-200",3,"input","keydown","value"],[1,"px-4","py-2","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["title","Previous day with entries",1,"p-2","text-zinc-400","hover:text-white","hover:bg-zinc-800","rounded-md","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"p-2","w-9","h-9"],["title","Next day with entries",1,"p-2","text-zinc-400","hover:text-white","hover:bg-zinc-800","rounded-md","transition-colors",3,"click"],["cdkDrag","",1,"flex","items-center","gap-3","p-3","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-800","rounded-md","hover:border-zinc-400","dark:hover:border-zinc-700","transition-colors","duration-200","group"],["cdkDragHandle","",1,"cursor-move","text-zinc-600","hover:text-zinc-400"],["stroke-linecap","round","stroke-linejoin","round","d","M4 8h16M4 16h16"],[1,"flex-shrink-0","w-5","h-5","rounded","border-2","flex","items-center","justify-center","transition-colors",3,"click"],["class","h-3 w-3 text-black","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",4,"ngIf"],["class","flex-1",4,"ngIf"],["class","flex-1 flex gap-2",4,"ngIf"],[1,"flex","items-center","gap-1","opacity-0","group-hover:opacity-100","transition-opacity"],["class","p-1 text-zinc-500 hover:text-white rounded transition-colors","title","Edit",3,"click",4,"ngIf"],["class","p-1 text-green-500 hover:text-green-400 rounded transition-colors","title","Save",3,"click",4,"ngIf"],["class","p-1 text-zinc-500 hover:text-white rounded transition-colors","title","Cancel",3,"click",4,"ngIf"],["class","p-1 text-zinc-500 hover:text-amber-500 rounded transition-colors","title","Postpone",3,"click",4,"ngIf"],["class","p-1 text-zinc-500 hover:text-red-500 rounded transition-colors","title","Delete",3,"click",4,"ngIf"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"h-3","w-3","text-black"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],[1,"flex-1"],[1,"break-words","transition-colors","duration-200"],["class","ml-2 text-xs text-amber-500 bg-amber-500/10 px-2 py-0.5 rounded",4,"ngIf"],[1,"ml-2","text-xs","text-amber-500","bg-amber-500/10","px-2","py-0.5","rounded"],[1,"flex-1","flex","gap-2"],["type","text","autofocus","",1,"flex-1","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded","px-2","py-1","text-sm","text-zinc-900","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-brand","transition-colors","duration-200",3,"input","keydown.enter","keydown.escape","value"],["title","Edit",1,"p-1","text-zinc-500","hover:text-white","rounded","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Save",1,"p-1","text-green-500","hover:text-green-400","rounded","transition-colors",3,"click"],["title","Cancel",1,"p-1","text-zinc-500","hover:text-white","rounded","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["title","Postpone",1,"p-1","text-zinc-500","hover:text-amber-500","rounded","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["title","Delete",1,"p-1","text-zinc-500","hover:text-red-500","rounded","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-center","py-8","text-zinc-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-2","opacity-50"],[1,"mt-4","pt-4","border-t","border-zinc-300","dark:border-zinc-800","flex","items-center","justify-between","text-sm","transition-colors","duration-200"],[1,"flex","gap-4"],[1,"text-zinc-500","dark:text-zinc-400","transition-colors","duration-200"],[1,"text-zinc-900","dark:text-white","font-medium","transition-colors","duration-200"],[1,"text-zinc-400"],[1,"text-green-500","font-medium"],["class","text-zinc-400",4,"ngIf"],[1,"text-amber-500","font-medium"],[1,"text-xs","text-zinc-500","dark:text-zinc-500","transition-colors","duration-200"],[1,"px-4","py-2","rounded-md","hover:opacity-80","transition-all","duration-200","text-sm","flex","items-center","gap-2",3,"click","title"],[1,"text-lg"],[1,"px-3","py-2","text-zinc-500","hover:text-zinc-300","transition-colors","text-sm",3,"click"],[1,"space-y-4","pl-6"],[1,"block","text-sm","font-medium","text-zinc-400","mb-2"],["rows","3","placeholder","The positive things today...",1,"w-full","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-lg","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","resize-none","text-sm","transition-colors","duration-200",3,"input","value"],["rows","3","placeholder","The difficulties encountered...",1,"w-full","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-lg","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","resize-none","text-sm","transition-colors","duration-200",3,"input","value"],["rows","3","placeholder","Things I appreciate today...",1,"w-full","bg-white","dark:bg-background","border","border-zinc-300","dark:border-zinc-700","rounded-lg","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","resize-none","text-sm","transition-colors","duration-200",3,"input","value"],[1,"inline-flex","items-center","gap-1.5","px-3","py-1","rounded-md","text-sm","font-medium","bg-brand/10","text-brand","border","border-brand/20"],[1,"hover:text-brand/70","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-3","w-3"]],template:function(e,i){e&1&&(n(0,"div",1),h(1,we,1,0,"app-calendar-dialog",2)(2,De,14,2,"ng-template",null,0,Q)(4,Te,2,0,"div",3)(5,qe,70,25,"div",4),o()),e&2&&(l(),c("ngIf",i.showCalendarDialog()),l(3),c("ngIf",i.loading()),l(),c("ngIf",!i.loading()&&i.dayEntry()))},dependencies:[F,j,P,Z,se,oe,ae,re,X,G],styles:["textarea[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#18181b;border-radius:4px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:4px}textarea[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#52525b}.cdk-drag-preview[_ngcontent-%COMP%]{opacity:.8;box-shadow:0 5px 15px #0000004d}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};export{le as DayViewComponent};
