import{a as C,b as B}from"./chunk-EODEEVHI.js";import{d as F}from"./chunk-S7RT4Y2X.js";import"./chunk-3U37DZ2B.js";import{a as Q}from"./chunk-FGWKY6PU.js";import{a as j}from"./chunk-2Y3G6OLQ.js";import{r as H}from"./chunk-UI2YVUNN.js";import{$a as c,Ab as s,Bb as T,Cb as b,Db as k,Eb as P,Ma as V,Q as w,Qa as m,Rb as D,Tb as v,W as p,X as g,Y as f,Yb as N,Z as y,ab as n,bb as r,cb as x,ha as u,jb as _,jc as A,kb as h,kc as R,mb as d,qb as z,rb as I,rc as O,sb as E,xb as M,za as a}from"./chunk-5B5UU655.js";import"./chunk-VOSPIT4N.js";var G=["headerActions"];function q(t,i){if(t&1){let e=_();n(0,"button",17),h("click",function(){p(e);let l=d();return g(l.goBack())}),s(1," \u2190 Back to planner "),r()}}function J(t,i){if(t&1){let e=_();n(0,"button",18),h("click",function(){p(e);let l=d();return g(l.clearSelectedTags())}),s(1," Clear selection "),r()}}function K(t,i){if(t&1){let e=_();n(0,"button",19),h("click",function(){p(e);let l=d();return g(l.toggleSearchMode())}),s(1),r()}if(t&2){let e=d();a(),b(" Mode: ",e.searchMode()," ")}}function U(t,i){if(t&1){let e=_();n(0,"button",26),h("click",function(){let l=p(e).$implicit,S=d(2);return g(S.toggleTag(l))}),s(1),f(),n(2,"svg",27),x(3,"path",28),r()()}if(t&2){let e=i.$implicit;a(),b(" ",e," ")}}function W(t,i){t&1&&(n(0,"span"),s(1," Show days containing "),n(2,"strong"),s(3,"all"),r(),s(4," selected tags "),r())}function X(t,i){t&1&&(n(0,"span"),s(1," Show days containing "),n(2,"strong"),s(3,"at least one"),r(),s(4," of the selected tags "),r())}function Y(t,i){if(t&1&&(n(0,"div",20)(1,"p",21),s(2,"Selected tags:"),r(),n(3,"div",22),m(4,U,4,1,"button",23),r(),n(5,"p",24),m(6,W,5,0,"span",25)(7,X,5,0,"span",25),r()()),t&2){let e=d();a(4),c("ngForOf",e.selectedTags()),a(2),c("ngIf",e.searchMode()==="AND"),a(),c("ngIf",e.searchMode()==="OR")}}function Z(t,i){t&1&&(n(0,"div",29),x(1,"div",30),r())}function ee(t,i){if(t&1){let e=_();n(0,"button",35),h("click",function(){let l=p(e).$implicit,S=d(3);return g(S.toggleTag(l.tag))}),n(1,"span"),s(2),r(),n(3,"span",36),s(4),r()()}if(t&2){let e=i.$implicit,o=d(3);M("bg-brand",o.selectedTags().includes(e.tag))("text-black",o.selectedTags().includes(e.tag))("border-brand",o.selectedTags().includes(e.tag))("bg-zinc-800",!o.selectedTags().includes(e.tag))("text-zinc-300",!o.selectedTags().includes(e.tag))("border-zinc-700",!o.selectedTags().includes(e.tag)),a(2),T(e.tag),a(2),b("(",e.count,")")}}function te(t,i){if(t&1&&(n(0,"div",22),m(1,ee,5,14,"button",34),r()),t&2){let e=d(2);a(),c("ngForOf",e.filteredTags())}}function ne(t,i){t&1&&(n(0,"div",37),f(),n(1,"svg",38),x(2,"path",6),r(),y(),n(3,"p"),s(4,"No tags available"),r(),n(5,"p",39),s(6,"Add tags to your journals to get started"),r()())}function ie(t,i){if(t&1&&(n(0,"div",37)(1,"p"),s(2),r()()),t&2){let e=d(2);a(2),b('No tags found for "',e.tagSearchQuery(),'"')}}function re(t,i){if(t&1&&(n(0,"div",31),m(1,te,2,1,"div",32)(2,ne,7,0,"div",33)(3,ie,3,1,"div",33),r()),t&2){let e=d();a(),c("ngIf",e.filteredTags().length>0),a(),c("ngIf",e.filteredTags().length===0&&!e.tagSearchQuery()),a(),c("ngIf",e.filteredTags().length===0&&e.tagSearchQuery())}}function ae(t,i){if(t&1&&(n(0,"span",46),s(1),r()),t&2){let e=d(2);a(),k(" (",e.total()," ",e.total()===1?"day":"days",") ")}}function oe(t,i){t&1&&(n(0,"div",47),x(1,"div",48),r())}function se(t,i){if(t&1&&(n(0,"p",63),s(1),r()),t&2){let e=d().$implicit;a(),b(" ",e.excerpt," ")}}function ce(t,i){if(t&1&&(n(0,"span",64),s(1),r()),t&2){let e=i.$implicit;a(),b(" ",e," ")}}function le(t,i){if(t&1){let e=_();n(0,"button",51),h("click",function(){let l=p(e).$implicit,S=d(3);return g(S.goToDay(l))}),n(1,"div",52)(2,"div",53)(3,"div",54),f(),n(4,"svg",55),x(5,"path",56),r(),y(),n(6,"h4",57),s(7),r()(),m(8,se,2,1,"p",58),n(9,"div",59),m(10,ce,2,1,"span",60),r()(),f(),n(11,"svg",61),x(12,"path",62),r()()()}if(t&2){let e=i.$implicit,o=d(3);a(7),T(o.formatDate(e.dayEntry.entry_date)),a(),c("ngIf",e.excerpt),a(2),c("ngForOf",e.matchedTags)}}function de(t,i){if(t&1&&(n(0,"div",49),m(1,le,13,3,"button",50),r()),t&2){let e=d(2);a(),c("ngForOf",e.searchResults())}}function me(t,i){t&1&&(n(0,"div",65),f(),n(1,"svg",38),x(2,"path",66),r(),y(),n(3,"p"),s(4,"No days found with these tags"),r()())}function pe(t,i){if(t&1){let e=_();n(0,"div",67)(1,"div",68)(2,"div",69),s(3),r(),n(4,"div",70)(5,"button",71),h("click",function(){p(e);let l=d(2);return g(l.previousPage())}),s(6," \u2190 Previous "),r(),n(7,"span",72),s(8),r(),n(9,"button",71),h("click",function(){p(e);let l=d(2);return g(l.nextPage())}),s(10," Next \u2192 "),r()()()()}if(t&2){let e=d(2);a(3),P(" Showing ",e.startItem(),"-",e.endItem()," of ",e.total()," "),a(2),c("disabled",e.currentPage()===1),a(3),k(" Page ",e.currentPage()," of ",e.totalPages()," "),a(),c("disabled",e.currentPage()>=e.totalPages())}}function ge(t,i){if(t&1&&(n(0,"div",2)(1,"div",3)(2,"h3",40),s(3," Results "),m(4,ae,2,2,"span",41),r()(),m(5,oe,2,0,"div",42)(6,de,2,1,"div",43)(7,me,5,0,"div",44)(8,pe,11,7,"div",45),r()),t&2){let e=d();a(4),c("ngIf",!e.loading()),a(),c("ngIf",e.loading()),a(),c("ngIf",!e.loading()&&e.searchResults().length>0),a(),c("ngIf",!e.loading()&&e.searchResults().length===0),a(),c("ngIf",!e.loading()&&e.searchResults().length>0&&e.totalPages()>1)}}function ue(t,i){t&1&&(n(0,"div",73),f(),n(1,"svg",74),x(2,"path",66),r(),y(),n(3,"h3",75),s(4,"Select one or more tags"),r(),n(5,"p",76),s(6," Click on the tags above to search through your days "),r()())}var L=class t{plannerService=w(B);pageHeaderService=w(j);pageHeaderActionsService=w(Q);router=w(F);cdr=w(N);headerActionsTemplate;allTags=u([]);selectedTags=u([]);searchMode=u("OR");searchResults=u([]);loading=u(!1);loadingTags=u(!1);currentPage=u(1);pageSize=12;total=u(0);tagSearchQuery=u("");totalPages=v(()=>Math.ceil(this.total()/this.pageSize));startItem=v(()=>(this.currentPage()-1)*this.pageSize+1);endItem=v(()=>Math.min(this.currentPage()*this.pageSize,this.total()));filteredTags=v(()=>{let i=this.tagSearchQuery().toLowerCase().trim();return i?this.allTags().filter(e=>e.tag.toLowerCase().includes(i)):this.allTags()});topTags=v(()=>this.allTags().slice(0,20));hasSelectedTags=v(()=>this.selectedTags().length>0);async ngOnInit(){this.pageHeaderService.setHeader("Search"),await this.loadAllTags()}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cdr.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions()}async loadAllTags(){this.loadingTags.set(!0);let i=await this.plannerService.getAllTags();this.allTags.set(i),this.loadingTags.set(!1)}toggleTag(i){let e=C.normalizeTag(i),o=this.selectedTags();o.includes(e)?this.selectedTags.set(o.filter(l=>l!==e)):this.selectedTags.set([...o,e]),this.selectedTags().length>0?(this.currentPage.set(1),this.search()):(this.searchResults.set([]),this.total.set(0))}clearSelectedTags(){this.selectedTags.set([]),this.searchResults.set([]),this.total.set(0),this.currentPage.set(1)}toggleSearchMode(){this.searchMode.update(i=>i==="AND"?"OR":"AND"),this.hasSelectedTags()&&(this.currentPage.set(1),this.search())}async search(){if(this.selectedTags().length===0)return;this.loading.set(!0);let{results:i,total:e}=await this.plannerService.searchByTags({tags:this.selectedTags(),mode:this.searchMode(),page:this.currentPage(),pageSize:this.pageSize});this.searchResults.set(i),this.total.set(e),this.loading.set(!1)}goToDay(i){this.router.navigate(["/planner/day",i.dayEntry.entry_date])}nextPage(){this.currentPage()<this.totalPages()&&(this.currentPage.update(i=>i+1),this.search())}previousPage(){this.currentPage()>1&&(this.currentPage.update(i=>i-1),this.search())}formatDate(i){return C.parseDate(i).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}goBack(){this.router.navigate(["/planner/today"])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=V({type:t,selectors:[["app-search-view"]],viewQuery:function(e,o){if(e&1&&z(G,5),e&2){let l;I(l=E())&&(o.headerActionsTemplate=l.first)}},decls:19,vars:8,consts:[["headerActions",""],[1,"max-w-7xl","mx-auto","p-3","sm:p-4","space-y-4","sm:space-y-6"],[1,"bg-white","dark:bg-background-card","border","border-zinc-300","dark:border-zinc-800","rounded-lg","p-4","sm:p-6","transition-colors","duration-200"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","flex","items-center","gap-2","transition-colors","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-brand"],["stroke-linecap","round","stroke-linejoin","round","d","M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"],[1,"flex","items-center","gap-3"],["class","text-sm text-zinc-400 hover:text-white transition-colors",3,"click",4,"ngIf"],["class","px-3 py-1.5 bg-zinc-800 text-zinc-300 rounded-md hover:bg-zinc-700 transition-colors text-sm font-medium",3,"click",4,"ngIf"],[1,"mb-4"],["type","text","placeholder","Search tags...",1,"w-full","bg-white","dark:bg-zinc-950","border","border-zinc-300","dark:border-zinc-700","rounded-md","px-4","py-2","text-zinc-900","dark:text-white","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:ring-2","focus:ring-brand","transition-colors","duration-200",3,"input","value"],["class","mb-4 pb-4 border-b border-zinc-800",4,"ngIf"],["class","flex items-center justify-center py-8",4,"ngIf"],["class","space-y-3",4,"ngIf"],["class","bg-white dark:bg-background-card border border-zinc-300 dark:border-zinc-800 rounded-lg p-4 sm:p-6 transition-colors duration-200",4,"ngIf"],["class","bg-white dark:bg-background-card border border-zinc-300 dark:border-zinc-800 rounded-lg p-12 text-center transition-colors duration-200",4,"ngIf"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm",3,"click"],[1,"text-sm","text-zinc-400","hover:text-white","transition-colors",3,"click"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","text-sm","font-medium",3,"click"],[1,"mb-4","pb-4","border-b","border-zinc-800"],[1,"text-sm","text-zinc-400","mb-2"],[1,"flex","flex-wrap","gap-2"],["class","inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-brand text-black border border-brand hover:bg-brand/90 transition-colors",3,"click",4,"ngFor","ngForOf"],[1,"text-xs","text-zinc-500","mt-2"],[4,"ngIf"],[1,"inline-flex","items-center","gap-1.5","px-3","py-1.5","rounded-md","text-sm","font-medium","bg-brand","text-black","border","border-brand","hover:bg-brand/90","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-3","w-3"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-center","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-brand"],[1,"space-y-3"],["class","flex flex-wrap gap-2",4,"ngIf"],["class","text-center py-8 text-zinc-500",4,"ngIf"],["class","inline-flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium border hover:opacity-80 transition-all",3,"bg-brand","text-black","border-brand","bg-zinc-800","text-zinc-300","border-zinc-700","click",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-md","text-sm","font-medium","border","hover:opacity-80","transition-all",3,"click"],[1,"text-xs","opacity-70"],[1,"text-center","py-8","text-zinc-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-12","w-12","mx-auto","mb-2","opacity-50"],[1,"text-sm","mt-1"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","transition-colors","duration-200"],["class","text-sm text-zinc-400 font-normal ml-2",4,"ngIf"],["class","flex items-center justify-center py-12",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","text-center py-12 text-zinc-500",4,"ngIf"],["class","mt-6 pt-6 border-t border-zinc-800",4,"ngIf"],[1,"text-sm","text-zinc-400","font-normal","ml-2"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-brand"],[1,"space-y-4"],["class","w-full text-left p-4 bg-zinc-900 border border-zinc-800 rounded-lg hover:border-brand/50 transition-all group",3,"click",4,"ngFor","ngForOf"],[1,"w-full","text-left","p-4","bg-zinc-900","border","border-zinc-800","rounded-lg","hover:border-brand/50","transition-all","group",3,"click"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-2"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4","text-brand","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"text-zinc-900","dark:text-white","font-medium","capitalize","transition-colors","duration-200"],["class","text-zinc-400 text-sm mb-3 line-clamp-3",4,"ngIf"],[1,"flex","flex-wrap","gap-1.5"],["class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-brand/10 text-brand border border-brand/20",4,"ngFor","ngForOf"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-5","w-5","text-zinc-600","group-hover:text-brand","transition-colors","flex-shrink-0","mt-1"],["stroke-linecap","round","stroke-linejoin","round","d","M9 5l7 7-7 7"],[1,"text-zinc-400","text-sm","mb-3","line-clamp-3"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-brand/10","text-brand","border","border-brand/20"],[1,"text-center","py-12","text-zinc-500"],["stroke-linecap","round","stroke-linejoin","round","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"mt-6","pt-6","border-t","border-zinc-800"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-zinc-400"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-zinc-800","text-zinc-300","rounded-md","hover:bg-zinc-700","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","text-sm",3,"click","disabled"],[1,"px-3","py-1.5","text-sm","text-zinc-400"],[1,"bg-white","dark:bg-background-card","border","border-zinc-300","dark:border-zinc-800","rounded-lg","p-12","text-center","transition-colors","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-16","w-16","mx-auto","mb-4","text-zinc-700"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","mb-2","transition-colors","duration-200"],[1,"text-zinc-400"]],template:function(e,o){if(e&1){let l=_();n(0,"div",1),m(1,q,2,0,"ng-template",null,0,D),n(3,"div",2)(4,"div",3)(5,"h3",4),f(),n(6,"svg",5),x(7,"path",6),r(),s(8," Available tags "),r(),y(),n(9,"div",7),m(10,J,2,0,"button",8)(11,K,2,1,"button",9),r()(),n(12,"div",10)(13,"input",11),h("input",function($){return p(l),g(o.tagSearchQuery.set($.target.value))}),r()(),m(14,Y,8,3,"div",12)(15,Z,2,0,"div",13)(16,re,4,3,"div",14),r(),m(17,ge,9,5,"div",15)(18,ue,7,0,"div",16),r()}e&2&&(a(10),c("ngIf",o.hasSelectedTags()),a(),c("ngIf",o.hasSelectedTags()),a(2),c("value",o.tagSearchQuery()),a(),c("ngIf",o.hasSelectedTags()),a(),c("ngIf",o.loadingTags()),a(),c("ngIf",!o.loadingTags()),a(),c("ngIf",o.hasSelectedTags()),a(),c("ngIf",!o.hasSelectedTags()&&!o.loadingTags()))},dependencies:[O,A,R,H],styles:[".line-clamp-3[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}"]})};export{L as SearchViewComponent};
