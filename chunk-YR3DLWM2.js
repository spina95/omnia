import{a as F}from"./chunk-33ELOFNQ.js";import{a as le,b as ce}from"./chunk-S55UVCW6.js";import"./chunk-QPMMAPE7.js";import{a as de}from"./chunk-5OAFGI6S.js";import"./chunk-V2ZT7OKQ.js";import{a as me}from"./chunk-JSLY3FHF.js";import{a as O}from"./chunk-L3TMYWDF.js";import{a as se}from"./chunk-2GG6C7AX.js";import{a as oe}from"./chunk-OKJ7GLF5.js";import{a as re}from"./chunk-7PC7RWUX.js";import{b as K,d as X,e as Z,f as ee,g as te,h as ie,i as ne,o as ae,r as L}from"./chunk-AM3HY3WI.js";import{Ab as S,Bb as k,Cb as D,Fb as Q,Ma as V,Mb as B,Ob as M,Q as b,Qa as v,Tb as Y,Va as R,W as p,Wa as m,X as u,Xa as n,Y as _,Ya as a,Z as y,Za as f,ca as H,eb as C,ec as J,fb as h,fc as N,ha as g,hb as d,la as q,lb as U,mb as W,mc as z,nb as j,qb as $,sb as E,ub as T,vb as c,wb as I,xb as x,za as l}from"./chunk-ELVZURTH.js";import{a as P,b as G}from"./chunk-VOSPIT4N.js";function he(s,t){if(s&1){let e=C();n(0,"button",32),h("click",function(){let i=p(e).$implicit,r=d(3);return u(r.selectTickerSuggestion(i))}),c(1),a()}if(s&2){let e=t.$implicit;l(),x(" ",e," ")}}function ve(s,t){if(s&1&&(n(0,"div",30),v(1,he,2,1,"button",31),a()),s&2){let e=d(2);l(),m("ngForOf",e.getFilteredSuggestions())}}function _e(s,t){s&1&&(n(0,"div",33),_(),n(1,"svg",34),f(2,"circle",35)(3,"path",36),a(),c(4," Validating ticker... "),a())}function xe(s,t){if(s&1&&(n(0,"div",12),c(1),a()),s&2){let e=d(2);l(),x(" ",e.tickerValidationError()," ")}}function be(s,t){if(s&1&&(n(0,"div",37),c(1),a()),s&2){let e=d(2);l(),x(" \u2713 Valid ticker (",e.exchangeName(),") ")}}function ye(s,t){if(s&1){let e=C();n(0,"button",38),h("click",function(){p(e);let i=d(2);return u(i.validateTicker())}),c(1," Verify ticker online "),a()}}function Ce(s,t){s&1&&(_(),n(0,"svg",39),f(1,"circle",35)(2,"path",36),a())}function we(s,t){if(s&1){let e=C();n(0,"div",1),h("click",function(){p(e);let i=d();return u(i.close())}),n(1,"div",2),h("click",function(i){return p(e),u(i.stopPropagation())}),n(2,"div",3)(3,"h2",4),c(4),a(),n(5,"button",5),h("click",function(){p(e);let i=d();return u(i.close())}),_(),n(6,"svg",6),f(7,"path",7),a()()(),y(),n(8,"div",8)(9,"form",9)(10,"div",10)(11,"label",11),c(12," Ticker Symbol "),n(13,"span",12),c(14,"*"),a()(),n(15,"input",13),D("ngModelChange",function(i){p(e);let r=d();return k(r.formData.ticker,i)||(r.formData.ticker=i),u(i)}),h("input",function(i){p(e);let r=d();return u(r.onTickerInput(i))})("blur",function(){p(e);let i=d();return u(i.onTickerBlur())}),a(),v(16,ve,2,1,"div",14),n(17,"div",15),v(18,_e,5,0,"div",16)(19,xe,2,1,"div",17)(20,be,2,1,"div",18)(21,ye,2,0,"button",19),a()(),n(22,"div")(23,"label",11),c(24," Transaction Type "),n(25,"span",12),c(26,"*"),a()(),n(27,"app-select",20),D("valueChange",function(i){p(e);let r=d();return k(r.formData.transaction_type,i)||(r.formData.transaction_type=i),u(i)}),a()(),n(28,"div")(29,"label",11),c(30," Quantity "),n(31,"span",12),c(32,"*"),a()(),n(33,"input",21),D("ngModelChange",function(i){p(e);let r=d();return k(r.formData.quantity,i)||(r.formData.quantity=i),u(i)}),a()(),n(34,"div")(35,"label",11),c(36," Price per Share (\u20AC) "),n(37,"span",12),c(38,"*"),a()(),n(39,"input",22),D("ngModelChange",function(i){p(e);let r=d();return k(r.formData.purchase_price,i)||(r.formData.purchase_price=i),u(i)}),a(),n(40,"p",23),c(41),a()(),n(42,"div")(43,"label",11),c(44," Transaction Date "),n(45,"span",12),c(46,"*"),a()(),n(47,"input",24),D("ngModelChange",function(i){p(e);let r=d();return k(r.formData.transaction_date,i)||(r.formData.transaction_date=i),u(i)}),a()(),n(48,"div")(49,"label",11),c(50," Notes "),a(),n(51,"textarea",25),D("ngModelChange",function(i){p(e);let r=d();return k(r.formData.notes,i)||(r.formData.notes=i),u(i)}),a()()()(),n(52,"div",26)(53,"button",27),h("click",function(){p(e);let i=d();return u(i.close())}),c(54," Cancel "),a(),n(55,"button",28),h("click",function(){p(e);let i=d();return u(i.save())}),v(56,Ce,3,0,"svg",29),n(57,"span"),c(58),a()()()()()}if(s&2){let e=d();l(4),I(e.dialogTitle),l(11),E("border-red-500",e.tickerValidationError())("border-green-500",e.exchangeName()&&!e.tickerValidationError()),S("ngModel",e.formData.ticker),l(),m("ngIf",e.showSuggestions()&&e.getFilteredSuggestions().length>0),l(2),m("ngIf",e.isValidatingTicker()),l(),m("ngIf",e.tickerValidationError()),l(),m("ngIf",e.exchangeName()&&!e.tickerValidationError()),l(),m("ngIf",e.formData.ticker&&!e.isValidatingTicker()),l(6),m("options",e.transactionTypeOptions),S("value",e.formData.transaction_type),l(6),S("ngModel",e.formData.quantity),l(6),S("ngModel",e.formData.purchase_price),l(2),x(" Total: \u20AC",(e.formData.quantity*e.formData.purchase_price).toFixed(2)," "),l(6),S("ngModel",e.formData.transaction_date),l(4),S("ngModel",e.formData.notes),l(2),m("disabled",e.isSaving()),l(2),m("disabled",e.isSaving()||e.isValidatingTicker()||!!e.tickerValidationError()),l(),m("ngIf",e.isSaving()),l(2),I(e.isSaving()?"Saving...":e.isEditMode?"Update":"Add Transaction")}}var A=class s{transaction=null;isOpen=!1;closeDialog=new H;transactionSaved=new H;investmentsService=b(F);notificationService=b(O);formData={ticker:"",quantity:0,purchase_price:0,transaction_date:new Date().toISOString().split("T")[0],transaction_type:"BUY",notes:""};transactionTypeOptions=[{value:"BUY",label:"Buy"},{value:"SELL",label:"Sell"}];isSaving=g(!1);isValidatingTicker=g(!1);tickerValidationError=g(null);exchangeName=g(null);tickerSuggestions=g([]);showSuggestions=g(!1);ngOnInit(){this.loadTickerSuggestions()}ngOnChanges(){this.isOpen&&(this.transaction?this.formData={ticker:this.transaction.ticker||"",quantity:this.transaction.quantity||0,purchase_price:this.transaction.purchase_price||0,transaction_date:this.transaction.transaction_date?new Date(this.transaction.transaction_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],transaction_type:this.transaction.transaction_type||"BUY",notes:this.transaction.notes||""}:this.formData={ticker:"",quantity:0,purchase_price:0,transaction_date:new Date().toISOString().split("T")[0],transaction_type:"BUY",notes:""},this.tickerValidationError.set(null),this.exchangeName.set(null))}async loadTickerSuggestions(){let t=await this.investmentsService.getUniqueTickers();this.tickerSuggestions.set(t)}onTickerInput(t){let e=t.target.value.toUpperCase();this.formData.ticker=e,this.tickerValidationError.set(null),this.exchangeName.set(null),this.showSuggestions.set(e.length>0)}selectTickerSuggestion(t){this.formData.ticker=t,this.showSuggestions.set(!1)}onTickerBlur(){setTimeout(()=>{this.showSuggestions.set(!1)},200)}async validateTicker(){if(!this.formData.ticker){this.tickerValidationError.set("Ticker is required");return}this.isValidatingTicker.set(!0),this.tickerValidationError.set(null),this.exchangeName.set(null);try{let t=await this.investmentsService.validateTicker(this.formData.ticker);t.valid?this.exchangeName.set(t.exchangeName||null):(this.tickerValidationError.set(t.error||"Invalid ticker"),this.exchangeName.set(null))}catch(t){console.error("Error validating ticker:",t),this.tickerValidationError.set("Failed to validate ticker"),this.exchangeName.set(null)}finally{this.isValidatingTicker.set(!1)}}getFilteredSuggestions(){let t=this.formData.ticker.toUpperCase();return t?this.tickerSuggestions().filter(e=>e.toUpperCase().includes(t)):[]}close(){this.closeDialog.emit(),this.resetForm()}resetForm(){this.formData={ticker:"",quantity:0,purchase_price:0,transaction_date:new Date().toISOString().split("T")[0],transaction_type:"BUY",notes:""},this.tickerValidationError.set(null),this.exchangeName.set(null),this.showSuggestions.set(!1)}validateForm(){return this.formData.ticker?!this.formData.quantity||this.formData.quantity<=0?(this.notificationService.error("Quantity must be greater than 0"),!1):!this.formData.purchase_price||this.formData.purchase_price<0?(this.notificationService.error("Price must be 0 or greater"),!1):this.formData.transaction_date?!0:(this.notificationService.error("Transaction date is required"),!1):(this.notificationService.error("Ticker is required"),!1)}async save(){if(this.validateForm()){this.isSaving.set(!0);try{let t={ticker:this.formData.ticker.toUpperCase(),quantity:this.formData.quantity,purchase_price:this.formData.purchase_price,transaction_date:this.formData.transaction_date,transaction_type:this.formData.transaction_type,notes:this.formData.notes||void 0};this.transaction?(await this.investmentsService.updateTransaction(this.transaction.id,t),this.notificationService.success("Transaction updated successfully")):(await this.investmentsService.createTransaction(t),this.notificationService.success("Transaction added successfully")),this.transactionSaved.emit(),this.close()}catch(t){console.error("Error saving transaction:",t),this.notificationService.error(t.message||"Failed to save transaction")}finally{this.isSaving.set(!1)}}}get isEditMode(){return!!this.transaction}get dialogTitle(){return this.isEditMode?"Edit Transaction":"Add Transaction"}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=V({type:s,selectors:[["app-investment-dialog"]],inputs:{transaction:"transaction",isOpen:"isOpen"},outputs:{closeDialog:"closeDialog",transactionSaved:"transactionSaved"},features:[q],decls:1,vars:1,consts:[["class","fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4","animate-fade-in",3,"click"],[1,"bg-zinc-900","rounded-lg","border","border-zinc-800","shadow-2xl","max-w-2xl","w-full","max-h-[85vh]","md:max-h-[90vh]","overflow-hidden","animate-scale-in",3,"click"],[1,"px-6","py-4","border-b","border-zinc-800","flex","items-center","justify-between","bg-zinc-900/50"],[1,"text-xl","font-semibold","text-zinc-900","dark:text-white","transition-colors","duration-200"],[1,"text-zinc-400","hover:text-white","transition-colors","p-1","hover:bg-zinc-800","rounded",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-6","overflow-y-auto","max-h-[calc(90vh-140px)]"],[1,"space-y-5"],[1,"relative"],[1,"block","text-sm","font-medium","text-zinc-300","mb-2"],[1,"text-red-400"],["type","text","name","ticker","placeholder","e.g., AAPL, MSFT, NVDA",1,"w-full","px-4","py-2.5","bg-white","dark:bg-zinc-950","border","border-zinc-300","dark:border-zinc-700","rounded-md","text-zinc-900","dark:text-zinc-200","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors","duration-200","uppercase",3,"ngModelChange","input","blur","ngModel"],["class","absolute z-10 w-full mt-1 bg-zinc-800 border border-zinc-700 rounded-md shadow-lg max-h-48 overflow-y-auto",4,"ngIf"],[1,"mt-1","text-sm"],["class","flex items-center text-zinc-400",4,"ngIf"],["class","text-red-400",4,"ngIf"],["class","text-green-400",4,"ngIf"],["type","button","class","mt-1 text-xs text-blue-400 hover:text-blue-300",3,"click",4,"ngIf"],["placeholder","Select transaction type",3,"valueChange","options","value"],["type","number","name","quantity","placeholder","0.00","step","0.01","min","0",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],["type","number","name","purchase_price","placeholder","0.00","step","0.01","min","0",1,"w-full","px-4","py-2.5","bg-zinc-950","border","border-zinc-700","rounded-md","text-zinc-200","placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors",3,"ngModelChange","ngModel"],[1,"text-xs","text-zinc-500","mt-1"],["type","date","name","transaction_date",1,"w-full","px-4","py-2.5","bg-white","dark:bg-zinc-950","border","border-zinc-300","dark:border-zinc-700","rounded-md","text-zinc-900","dark:text-zinc-200","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors","duration-200",3,"ngModelChange","ngModel"],["name","notes","rows","3","placeholder","Additional notes about this transaction...",1,"w-full","px-4","py-2.5","bg-white","dark:bg-zinc-950","border","border-zinc-300","dark:border-zinc-700","rounded-md","text-zinc-900","dark:text-zinc-200","placeholder-zinc-400","dark:placeholder-zinc-500","focus:outline-none","focus:border-brand","focus:ring-1","focus:ring-brand","transition-colors","duration-200","resize-none",3,"ngModelChange","ngModel"],[1,"px-6","py-4","border-t","border-zinc-800","flex","justify-end","gap-3","bg-zinc-900/50"],["type","button",1,"px-4","py-2","text-zinc-300","hover:text-white","border","border-zinc-700","hover:bg-zinc-800","rounded-md","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"px-6","py-2","bg-green-600","hover:bg-green-700","text-white","rounded-md","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["class","animate-spin h-4 w-4","fill","none","viewBox","0 0 24 24","stroke","currentColor",4,"ngIf"],[1,"absolute","z-10","w-full","mt-1","bg-zinc-800","border","border-zinc-700","rounded-md","shadow-lg","max-h-48","overflow-y-auto"],["type","button","class","w-full px-4 py-2 text-left text-zinc-200 hover:bg-zinc-700 transition-colors",3,"click",4,"ngFor","ngForOf"],["type","button",1,"w-full","px-4","py-2","text-left","text-zinc-200","hover:bg-zinc-700","transition-colors",3,"click"],[1,"flex","items-center","text-zinc-400"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","mr-2"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-green-400"],["type","button",1,"mt-1","text-xs","text-blue-400","hover:text-blue-300",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"animate-spin","h-4","w-4"]],template:function(e,o){e&1&&v(0,we,59,22,"div",0),e&2&&m("ngIf",o.isOpen)},dependencies:[z,J,N,L,ie,K,ne,X,Z,ae,te,ee,oe],encapsulation:2})};var Se=["headerActions"],ke=()=>[];function De(s,t){if(s&1){let e=C();n(0,"div",7)(1,"button",8),h("click",function(){p(e);let i=d();return u(i.refreshPrices())}),_(),n(2,"svg",9),f(3,"path",10),a(),y(),n(4,"span",11),c(5),a()(),n(6,"button",12),h("click",function(){p(e);let i=d();return u(i.openAddDialog())}),_(),n(7,"svg",9),f(8,"path",13),a(),y(),n(9,"span",11),c(10,"Add Transaction"),a()()()}if(s&2){let e=d();l(),m("disabled",e.isRefreshing()),l(),E("animate-spin",e.isRefreshing()),l(3),I(e.isRefreshing()?"Updating...":"Update Prices")}}function Te(s,t){s&1&&(n(0,"div",14),f(1,"div",15),a())}function Ie(s,t){if(s&1&&(n(0,"div",40),c(1),a()),s&2){let e=d(2);l(),x(" Last updated: ",e.lastUpdated().toLocaleString("it-IT")," ")}}function Ve(s,t){if(s&1&&(n(0,"div"),f(1,"apx-chart",41),a()),s&2){let e=d(2);l(),m("series",e.compositionChartOptions.series)("chart",e.compositionChartOptions.chart)("labels",e.compositionChartOptions.labels)("colors",e.compositionChartOptions.colors)("legend",e.compositionChartOptions.legend)("dataLabels",e.compositionChartOptions.dataLabels)("tooltip",e.compositionChartOptions.tooltip)}}function Ee(s,t){if(s&1&&(n(0,"div"),f(1,"apx-chart",42),a()),s&2){let e=d(2);l(),m("series",e.geographicalChartOptions.series)("chart",e.geographicalChartOptions.chart)("colors",e.geographicalChartOptions.colors)("legend",e.geographicalChartOptions.legend)("dataLabels",e.geographicalChartOptions.dataLabels)("tooltip",e.geographicalChartOptions.tooltip)}}function Me(s,t){if(s&1){let e=C();n(0,"div")(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20),_(),n(6,"svg",21),f(7,"path",22),a()(),y(),n(8,"div",23)(9,"dl")(10,"dt",24),c(11,"Total Portfolio Value"),a(),n(12,"dd")(13,"div",25),c(14),a()()()()(),v(15,Ie,2,1,"div",26),a()(),n(16,"div",17)(17,"div",18)(18,"div",19)(19,"div",20),_(),n(20,"svg",27),f(21,"path",28),a()(),y(),n(22,"div",23)(23,"dl")(24,"dt",24),c(25,"Total Gain/Loss"),a(),n(26,"dd")(27,"div",29),c(28),a()()()()()()(),n(29,"div",17)(30,"div",18)(31,"div",19)(32,"div",20),_(),n(33,"svg",27),f(34,"path",30),a()(),y(),n(35,"div",23)(36,"dl")(37,"dt",24),c(38,"Return on Investment"),a(),n(39,"dd")(40,"div",29),c(41),a()()()()()()()(),n(42,"div",31)(43,"div",17)(44,"div",18)(45,"h3",32),c(46,"Portfolio Composition"),a(),v(47,Ve,2,7,"div",33),a()(),n(48,"div",17)(49,"div",18)(50,"h3",32),c(51,"Geographical Allocation"),a(),v(52,Ee,2,6,"div",33),a()()(),n(53,"div",34)(54,"h3",25),c(55,"Current Holdings"),a(),n(56,"div",35),f(57,"app-data-table",36),a()(),n(58,"div",37)(59,"h3",25),c(60,"Transaction History"),a(),n(61,"div",38)(62,"app-data-table",39),h("cellClicked",function(i){p(e);let r=d();return u(r.onCellClicked(i))}),a()()()()}if(s&2){let e,o,i,r=d(),w=$(6);l(14),x(" ",r.formatCurrency(r.totalValue())," "),l(),m("ngIf",r.lastUpdated()),l(5),T(r.totalGainLoss()>=0?"text-green-500":"text-red-500"),l(),R("d",r.totalGainLoss()>=0?"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6":"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"),l(6),T(r.getGainLossColor(r.totalGainLoss())),l(),x(" ",r.formatCurrency(r.totalGainLoss())," "),l(5),T(r.totalGainLossPercent()>=0?"text-green-500":"text-red-500"),l(7),T(r.getGainLossColor(r.totalGainLossPercent())),l(),x(" ",r.formatPercent(r.totalGainLossPercent())," "),l(6),m("ngIf",(((e=r.portfolioSummary())==null||e.holdings==null?null:e.holdings.length)??0)>0)("ngIfElse",w),l(5),m("ngIf",r.geographicalAllocation().length>0)("ngIfElse",w),l(5),m("columnDefs",r.portfolioColumnDefs)("rowData",((o=r.portfolioSummary())==null?null:o.holdings)||Q(30,ke))("loading",r.isLoading())("showPagination",!1)("showFilters",!1)("totalRecords",((i=r.portfolioSummary())==null||i.holdings==null?null:i.holdings.length)||0),l(5),m("columnDefs",r.transactionsColumnDefs)("rowData",r.transactions())("loading",r.isLoading())("showPagination",!0)("showFilters",!1)("pageSize",20)("totalRecords",r.transactions().length)}}function Ne(s,t){s&1&&(n(0,"div",43),_(),n(1,"svg",44),f(2,"path",30),a(),y(),n(3,"p",45),c(4,"No investment data yet"),a(),n(5,"p",46),c(6,"Start tracking your investments by adding a transaction"),a()())}function ze(s,t){if(s&1){let e=C();n(0,"app-confirmation-dialog",47),h("confirm",function(){p(e);let i=d();return u(i.confirmDelete())})("cancel",function(){p(e);let i=d();return u(i.cancelDelete())}),a()}if(s&2){let e=d();m("isOpen",e.isConfirmDialogOpen)("title",e.confirmDialogTitle)("message",e.confirmDialogMessage)}}function Le(s,t){if(s&1){let e=C();n(0,"app-investment-dialog",48),h("closeDialog",function(){p(e);let i=d();return u(i.onDialogClose())})("transactionSaved",function(){p(e);let i=d();return u(i.onDialogClose())}),a()}if(s&2){let e=d();m("isOpen",e.showInvestmentDialog())("transaction",e.editingTransaction())}}var pe=class s{headerActionsTemplate;investmentsService=b(F);notificationService=b(O);pageHeaderService=b(re);pageHeaderActionsService=b(se);cd=b(Y);portfolioSummary=g(null);geographicalAllocation=g([]);transactions=g([]);isLoading=g(!0);isRefreshing=g(!1);lastUpdated=g(null);totalValue=M(()=>this.portfolioSummary()?.totalValue??0);totalGainLoss=M(()=>this.portfolioSummary()?.totalGainLoss??0);totalGainLossPercent=M(()=>this.portfolioSummary()?.totalGainLossPercent??0);showInvestmentDialog=g(!1);editingTransaction=g(null);isConfirmDialogOpen=!1;confirmDialogTitle="";confirmDialogMessage="";pendingDeleteTransaction=null;portfolioColumnDefs=[{field:"ticker",headerName:"Ticker",sortable:!0,filter:!0,width:120},{field:"totalQuantity",headerName:"Quantity",sortable:!0,width:120,valueFormatter:t=>t.value?.toFixed(2)??"0"},{field:"averageCost",headerName:"Avg Cost",sortable:!0,width:120,valueFormatter:t=>`\u20AC${t.value?.toFixed(2)??"0"}`},{field:"currentPrice",headerName:"Current Price",sortable:!0,width:140,valueFormatter:t=>`\u20AC${t.value?.toFixed(2)??"0"}`},{field:"currentValue",headerName:"Value",sortable:!0,width:130,valueFormatter:t=>`\u20AC${t.value?.toFixed(2)??"0"}`},{field:"gainLoss",headerName:"Gain/Loss",sortable:!0,width:140,cellStyle:t=>t.value>=0?{color:"#22c55e"}:{color:"#ef4444"},valueFormatter:t=>{let e=t.value??0;return`\u20AC${e>=0?"+":""}${e.toFixed(2)}`}},{field:"gainLossPercent",headerName:"Gain/Loss %",sortable:!0,width:140,cellStyle:t=>t.value>=0?{color:"#22c55e"}:{color:"#ef4444"},valueFormatter:t=>{let e=t.value??0;return`${e>=0?"+":""}${e.toFixed(2)}%`}},{field:"country",headerName:"Country",sortable:!0,filter:!0,width:120}];transactionsColumnDefs=[{field:"transaction_date",headerName:"Date",sortable:!0,width:120,valueFormatter:t=>t.value?new Date(t.value).toLocaleDateString("it-IT"):""},{field:"ticker",headerName:"Ticker",sortable:!0,filter:!0,width:120},{field:"transaction_type",headerName:"Type",sortable:!0,filter:!0,width:100,cellStyle:t=>t.value==="BUY"?{color:"#22c55e"}:{color:"#ef4444"}},{field:"quantity",headerName:"Quantity",sortable:!0,width:120,valueFormatter:t=>t.value?.toFixed(2)??"0"},{field:"purchase_price",headerName:"Price",sortable:!0,width:120,valueFormatter:t=>`\u20AC${t.value?.toFixed(2)??"0"}`},{headerName:"Total",sortable:!0,width:130,valueGetter:t=>{let e=t.data?.quantity??0,o=t.data?.purchase_price??0;return e*o},valueFormatter:t=>`\u20AC${t.value?.toFixed(2)??"0"}`},{field:"notes",headerName:"Notes",filter:!0,flex:1,minWidth:150},{headerName:"Actions",width:120,cellRenderer:t=>{let e=document.createElement("div");e.className="flex gap-2";let o=document.createElement("button");o.innerHTML=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>`,o.className="text-blue-400 hover:text-blue-300",o.onclick=()=>this.editTransaction(t.data);let i=document.createElement("button");return i.innerHTML=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>`,i.className="text-red-400 hover:text-red-300",i.onclick=()=>this.deleteTransaction(t.data),e.appendChild(o),e.appendChild(i),e}}];compositionChartOptions={chart:{type:"donut",height:350,background:"transparent",foreColor:"#e5e7eb"},labels:[],series:[],colors:["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"],legend:{position:"bottom",labels:{colors:"#e5e7eb"}},dataLabels:{enabled:!0,formatter:t=>`${t.toFixed(1)}%`},tooltip:{theme:"dark",y:{formatter:t=>`\u20AC${t.toFixed(2)}`}}};geographicalChartOptions={chart:{type:"treemap",height:350,background:"transparent",foreColor:"#e5e7eb",toolbar:{show:!1}},series:[],colors:["#22c55e"],legend:{show:!1},dataLabels:{enabled:!0,style:{fontSize:"14px",colors:["#ffffff"]},formatter:(t,e)=>[t,`${e.value.toFixed(1)}%`]},tooltip:{theme:"dark",y:{formatter:(t,e)=>{let o=e.w.config.series[0].data[e.dataPointIndex].x;return`\u20AC${this.geographicalAllocation().find(r=>r.country===o)?.value.toFixed(2)??"0"}`}}}};ngOnInit(){this.pageHeaderService.setHeader("Investments"),this.loadData()}ngAfterViewInit(){this.pageHeaderActionsService.setActions(this.headerActionsTemplate),this.cd.detectChanges()}ngOnDestroy(){this.pageHeaderActionsService.clearActions()}async loadData(t=!1){try{this.isLoading.set(!0),console.log("\u{1F504} Loading investment data...");let[e,o,i]=await Promise.all([this.investmentsService.getPortfolioSummary(t),this.investmentsService.getGeographicalAllocation(t),this.investmentsService.getTransactions({pageSize:1e3})]);console.log("\u2705 Data loaded:",{portfolioSummary:e,geographicalAllocation:o,transactions:i.data}),this.portfolioSummary.set(e),this.geographicalAllocation.set(o),this.transactions.set(i.data),console.log("\u{1F4CA} Signals updated:",{portfolioHoldings:this.portfolioSummary()?.holdings?.length,portfolioFirstHolding:this.portfolioSummary()?.holdings?.[0],transactions:this.transactions().length,transactionFirst:this.transactions()?.[0],geoAllocation:this.geographicalAllocation().length}),this.cd.detectChanges(),this.updateCharts(),t&&this.lastUpdated.set(new Date)}catch(e){console.error("\u274C Error loading investments data:",e),this.notificationService.error("Failed to load investments data")}finally{this.isLoading.set(!1)}}async refreshPrices(){try{this.isRefreshing.set(!0);let t=this.portfolioSummary();if(!t||t.holdings.length===0){this.notificationService.info("No holdings to refresh");return}let e=t.holdings.map(r=>r.ticker);this.notificationService.info(`Updating prices for ${e.length} ticker(s)...`);let o=0,i=0;for(let r of e)try{await this.investmentsService.refreshPrice(r),o++,await new Promise(w=>setTimeout(w,500))}catch(w){if(console.error(`Failed to refresh ${r}:`,w),i++,w.message?.includes("429")||w.message?.includes("Too Many Requests")){this.notificationService.error("Rate limit reached. Please try again later or enter prices manually.");break}}await this.loadData(!0),o>0?this.notificationService.success(`${o} price(s) updated successfully${i>0?`, ${i} failed`:""}`):i>0&&this.notificationService.error("Failed to update prices. Try entering them manually.")}catch(t){console.error("Error refreshing prices:",t),this.notificationService.error("Failed to refresh prices")}finally{this.isRefreshing.set(!1)}}updateCharts(){let t=this.portfolioSummary(),e=this.geographicalAllocation();t&&t.holdings.length>0&&(this.compositionChartOptions=G(P({},this.compositionChartOptions),{labels:t.holdings.map(o=>o.ticker),series:t.holdings.map(o=>o.currentValue)}),e.length>0&&(this.geographicalChartOptions=G(P({},this.geographicalChartOptions),{series:[{data:e.map(o=>({x:o.country,y:o.percentage}))}]})))}openAddDialog(){this.editingTransaction.set(null),this.showInvestmentDialog.set(!0)}editTransaction(t){this.editingTransaction.set(t),this.showInvestmentDialog.set(!0)}onCellClicked(t){console.log("Cell clicked:",t)}deleteTransaction(t){this.pendingDeleteTransaction=t,this.confirmDialogTitle="Delete Transaction",this.confirmDialogMessage=`Are you sure you want to delete this ${t.transaction_type} transaction for ${t.ticker}?`,this.isConfirmDialogOpen=!0}async confirmDelete(){if(this.pendingDeleteTransaction)try{await this.investmentsService.deleteTransaction(this.pendingDeleteTransaction.id),this.notificationService.success("Transaction deleted successfully"),await this.loadData()}catch(t){console.error("Error deleting transaction:",t),this.notificationService.error("Failed to delete transaction")}finally{this.isConfirmDialogOpen=!1,this.pendingDeleteTransaction=null}}cancelDelete(){this.isConfirmDialogOpen=!1,this.pendingDeleteTransaction=null}onDialogClose(){this.showInvestmentDialog.set(!1),this.editingTransaction.set(null),this.loadData()}formatCurrency(t){return`\u20AC${t.toFixed(2)}`}formatPercent(t){return`${t>=0?"+":""}${t.toFixed(2)}%`}getGainLossColor(t){return t>=0?"text-green-500":"text-red-500"}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=V({type:s,selectors:[["app-investments"]],viewQuery:function(e,o){if(e&1&&U(Se,5),e&2){let i;W(i=j())&&(o.headerActionsTemplate=i.first)}},decls:9,vars:4,consts:[["headerActions",""],["noData",""],[1,"container","mx-auto","p-3","sm:p-6","space-y-4","sm:space-y-6"],["class","flex items-center justify-center h-64",4,"ngIf"],[4,"ngIf"],[3,"isOpen","title","message","confirm","cancel",4,"ngIf"],[3,"isOpen","transaction","closeDialog","transactionSaved",4,"ngIf"],[1,"flex","gap-2"],[1,"flex","items-center","justify-center","gap-2","px-2","sm:px-4","py-2.5","h-10","text-sm","bg-zinc-800","text-white","rounded-lg","hover:bg-zinc-700","transition-colors","border","border-zinc-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"hidden","sm:inline","whitespace-nowrap"],[1,"flex","items-center","justify-center","gap-2","px-2","sm:px-4","py-2.5","h-10","text-sm","bg-brand","text-black","font-medium","rounded-lg","hover:bg-brand/90","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"flex","items-center","justify-center","h-64"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-green-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-5","mb-6"],[1,"overflow-hidden","rounded-lg","bg-white","dark:bg-background-card","shadow","border","border-zinc-300","dark:border-sidebar-border","transition-colors","duration-200"],[1,"p-5"],[1,"flex","items-center"],[1,"flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"ml-5","w-0","flex-1"],[1,"truncate","text-sm","font-medium","text-zinc-500","dark:text-slate-400","transition-colors","duration-200"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","transition-colors","duration-200"],["class","text-xs text-slate-500 mt-3",4,"ngIf"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"text-lg","font-semibold"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-5","mb-6"],[1,"text-lg","font-semibold","text-zinc-900","dark:text-white","mb-4","transition-colors","duration-200"],[4,"ngIf","ngIfElse"],[1,"mb-12",2,"height","40rem"],[2,"height","10px","display","block","position","relative"],["emptyStateMessage","No holdings yet. Add your first investment transaction to get started.",3,"columnDefs","rowData","loading","showPagination","showFilters","totalRecords"],[1,"mb-16"],[2,"height","600px","display","block","position","relative"],["emptyStateMessage","No transactions yet. Add your first investment to get started.",3,"cellClicked","columnDefs","rowData","loading","showPagination","showFilters","pageSize","totalRecords"],[1,"text-xs","text-slate-500","mt-3"],[3,"series","chart","labels","colors","legend","dataLabels","tooltip"],[3,"series","chart","colors","legend","dataLabels","tooltip"],[1,"text-center","py-12","text-gray-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","text-gray-600"],[1,"text-lg","font-medium","mb-2"],[1,"text-sm"],[3,"confirm","cancel","isOpen","title","message"],[3,"closeDialog","transactionSaved","isOpen","transaction"]],template:function(e,o){e&1&&(n(0,"div",2),v(1,De,11,4,"ng-template",null,0,B)(3,Te,2,0,"div",3)(4,Me,63,31,"div",4)(5,Ne,7,0,"ng-template",null,1,B),a(),v(7,ze,1,3,"app-confirmation-dialog",5)(8,Le,1,2,"app-investment-dialog",6)),e&2&&(l(3),m("ngIf",o.isLoading()),l(),m("ngIf",!o.isLoading()),l(3),m("ngIf",o.isConfirmDialogOpen),l(),m("ngIf",o.showInvestmentDialog()))},dependencies:[z,N,L,ce,le,de,me,A],encapsulation:2})};export{pe as InvestmentsComponent};
